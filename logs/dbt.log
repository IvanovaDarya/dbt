2022-05-30 15:49:02.892680 (MainThread): Running with dbt=0.19.0
2022-05-30 15:49:03.018214 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.deps.DepsTask'>, debug=False, defer=None, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='deps', single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='deps', write_json=True)
2022-05-30 15:49:03.025775 (MainThread): Tracking: do not track
2022-05-30 15:49:03.033469 (MainThread): Set downloads directory='/tmp/dbt-downloads-bgmel9v0'
2022-05-30 15:49:03.034592 (MainThread): Executing "git clone --depth 1 https://github.com/kzzzr/dbtvault.git 8f67def39d1e3209f86c5b38b1f63392"
2022-05-30 15:49:04.770954 (MainThread): STDOUT: "b''"
2022-05-30 15:49:04.771523 (MainThread): STDERR: "b"Cloning into '8f67def39d1e3209f86c5b38b1f63392'...\n""
2022-05-30 15:49:04.772280 (MainThread): Pulling new dependency 8f67def39d1e3209f86c5b38b1f63392.
2022-05-30 15:49:04.772636 (MainThread): Executing "git rev-parse HEAD"
2022-05-30 15:49:04.776657 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-30 15:49:04.777170 (MainThread): STDERR: "b''"
2022-05-30 15:49:04.777460 (MainThread):   Checking out branch master.
2022-05-30 15:49:04.777691 (MainThread): Executing "git remote set-branches origin master"
2022-05-30 15:49:04.783510 (MainThread): STDOUT: "b''"
2022-05-30 15:49:04.784005 (MainThread): STDERR: "b''"
2022-05-30 15:49:04.784371 (MainThread): Executing "git fetch --tags --depth 1 origin master"
2022-05-30 15:49:06.160268 (MainThread): STDOUT: "b''"
2022-05-30 15:49:06.160899 (MainThread): STDERR: "b'From https://github.com/kzzzr/dbtvault\n * branch            master     -> FETCH_HEAD\n * [new tag]         v0.1-pre   -> v0.1-pre\n * [new tag]         v0.2-pre   -> v0.2-pre\n * [new tag]         v0.2.1-pre -> v0.2.1-pre\n * [new tag]         v0.2.2-pre -> v0.2.2-pre\n * [new tag]         v0.2.3-pre -> v0.2.3-pre\n * [new tag]         v0.2.4-pre -> v0.2.4-pre\n * [new tag]         v0.3-pre   -> v0.3-pre\n * [new tag]         v0.3.1-pre -> v0.3.1-pre\n * [new tag]         v0.3.2-pre -> v0.3.2-pre\n * [new tag]         v0.3.3-pre -> v0.3.3-pre\n * [new tag]         v0.4       -> v0.4\n * [new tag]         v0.4.1     -> v0.4.1\n * [new tag]         v0.5       -> v0.5\n * [new tag]         v0.6       -> v0.6\n * [new tag]         v0.6-b1    -> v0.6-b1\n * [new tag]         v0.6-b2    -> v0.6-b2\n * [new tag]         v0.6.1     -> v0.6.1\n * [new tag]         v0.6.2     -> v0.6.2\n * [new tag]         v0.7.0     -> v0.7.0\n * [new tag]         v0.7.1     -> v0.7.1\n * [new tag]         v0.7.2     -> v0.7.2\n * [new tag]         v0.7.3     -> v0.7.3\n'"
2022-05-30 15:49:06.161616 (MainThread): Executing "git tag --list"
2022-05-30 15:49:06.167166 (MainThread): STDOUT: "b'v0.1-pre\nv0.2-pre\nv0.2.1-pre\nv0.2.2-pre\nv0.2.3-pre\nv0.2.4-pre\nv0.3-pre\nv0.3.1-pre\nv0.3.2-pre\nv0.3.3-pre\nv0.4\nv0.4.1\nv0.5\nv0.6\nv0.6-b1\nv0.6-b2\nv0.6.1\nv0.6.2\nv0.7.0\nv0.7.1\nv0.7.2\nv0.7.3\n'"
2022-05-30 15:49:06.167743 (MainThread): STDERR: "b''"
2022-05-30 15:49:06.168079 (MainThread): Executing "git reset --hard origin/master"
2022-05-30 15:49:06.177763 (MainThread): STDOUT: "b'HEAD is now at 47e0261 adapt for postgresql/greenplum\n'"
2022-05-30 15:49:06.178304 (MainThread): STDERR: "b''"
2022-05-30 15:49:06.178814 (MainThread): Executing "git rev-parse HEAD"
2022-05-30 15:49:06.183780 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-30 15:49:06.184362 (MainThread): STDERR: "b''"
2022-05-30 15:49:06.184742 (MainThread):   Checked out at 47e0261.
2022-05-30 15:49:06.185132 (MainThread): WARNING: The git package "https://github.com/kzzzr/dbtvault.git" is not pinned.
	This can introduce breaking changes into your project without warning!

See https://docs.getdbt.com/docs/package-management#section-specifying-package-versions
2022-05-30 15:49:06.207021 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/index.json
2022-05-30 15:49:06.336119 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/index.json 200
2022-05-30 15:49:06.337236 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2022-05-30 15:49:06.524186 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2022-05-30 15:49:06.545737 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.4.json
2022-05-30 15:49:06.736132 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.4.json 200
2022-05-30 15:49:06.743699 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2022-05-30 15:49:06.821262 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2022-05-30 15:49:06.841186 (MainThread): Executing "git clone --depth 1 https://github.com/kzzzr/dbtvault.git 8f67def39d1e3209f86c5b38b1f63392"
2022-05-30 15:49:06.845843 (MainThread): STDOUT: "b''"
2022-05-30 15:49:06.846334 (MainThread): STDERR: "b"fatal: destination path '8f67def39d1e3209f86c5b38b1f63392' already exists and is not an empty directory.\n""
2022-05-30 15:49:06.846597 (MainThread): command return code=128
2022-05-30 15:49:06.847186 (MainThread): Updating existing dependency 8f67def39d1e3209f86c5b38b1f63392.
2022-05-30 15:49:06.847421 (MainThread): Executing "git rev-parse HEAD"
2022-05-30 15:49:06.850943 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-30 15:49:06.851432 (MainThread): STDERR: "b''"
2022-05-30 15:49:06.851710 (MainThread):   Checking out branch master.
2022-05-30 15:49:06.851932 (MainThread): Executing "git remote set-branches origin master"
2022-05-30 15:49:06.856633 (MainThread): STDOUT: "b''"
2022-05-30 15:49:06.857133 (MainThread): STDERR: "b''"
2022-05-30 15:49:06.857404 (MainThread): Executing "git fetch --tags --depth 1 origin master"
2022-05-30 15:49:07.628343 (MainThread): STDOUT: "b''"
2022-05-30 15:49:07.629000 (MainThread): STDERR: "b'From https://github.com/kzzzr/dbtvault\n * branch            master     -> FETCH_HEAD\n'"
2022-05-30 15:49:07.629383 (MainThread): Executing "git tag --list"
2022-05-30 15:49:07.633768 (MainThread): STDOUT: "b'v0.1-pre\nv0.2-pre\nv0.2.1-pre\nv0.2.2-pre\nv0.2.3-pre\nv0.2.4-pre\nv0.3-pre\nv0.3.1-pre\nv0.3.2-pre\nv0.3.3-pre\nv0.4\nv0.4.1\nv0.5\nv0.6\nv0.6-b1\nv0.6-b2\nv0.6.1\nv0.6.2\nv0.7.0\nv0.7.1\nv0.7.2\nv0.7.3\n'"
2022-05-30 15:49:07.634255 (MainThread): STDERR: "b''"
2022-05-30 15:49:07.634527 (MainThread): Executing "git reset --hard origin/master"
2022-05-30 15:49:07.640835 (MainThread): STDOUT: "b'HEAD is now at 47e0261 adapt for postgresql/greenplum\n'"
2022-05-30 15:49:07.641294 (MainThread): STDERR: "b''"
2022-05-30 15:49:07.641584 (MainThread): Executing "git rev-parse HEAD"
2022-05-30 15:49:07.645422 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-30 15:49:07.645906 (MainThread): STDERR: "b''"
2022-05-30 15:49:07.646172 (MainThread):   Already at 47e0261, nothing to do.
2022-05-30 15:49:07.646460 (MainThread): WARNING: The git package "https://github.com/kzzzr/dbtvault.git" is not pinned.
	This can introduce breaking changes into your project without warning!

See https://docs.getdbt.com/docs/package-management#section-specifying-package-versions
2022-05-30 15:49:07.663645 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.4.json
2022-05-30 15:49:07.758576 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.4.json 200
2022-05-30 15:49:07.760466 (MainThread): Installing https://github.com/kzzzr/dbtvault.git@master
2022-05-30 15:49:07.763212 (MainThread): Executing "git clone --depth 1 https://github.com/kzzzr/dbtvault.git 8f67def39d1e3209f86c5b38b1f63392"
2022-05-30 15:49:07.766995 (MainThread): STDOUT: "b''"
2022-05-30 15:49:07.767514 (MainThread): STDERR: "b"fatal: destination path '8f67def39d1e3209f86c5b38b1f63392' already exists and is not an empty directory.\n""
2022-05-30 15:49:07.767799 (MainThread): command return code=128
2022-05-30 15:49:07.768156 (MainThread): Updating existing dependency 8f67def39d1e3209f86c5b38b1f63392.
2022-05-30 15:49:07.768422 (MainThread): Executing "git rev-parse HEAD"
2022-05-30 15:49:07.772832 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-30 15:49:07.773355 (MainThread): STDERR: "b''"
2022-05-30 15:49:07.773625 (MainThread):   Checking out branch master.
2022-05-30 15:49:07.773827 (MainThread): Executing "git remote set-branches origin master"
2022-05-30 15:49:07.780927 (MainThread): STDOUT: "b''"
2022-05-30 15:49:07.781446 (MainThread): STDERR: "b''"
2022-05-30 15:49:07.781736 (MainThread): Executing "git fetch --tags --depth 1 origin master"
2022-05-30 15:49:08.520478 (MainThread): STDOUT: "b''"
2022-05-30 15:49:08.520988 (MainThread): STDERR: "b'From https://github.com/kzzzr/dbtvault\n * branch            master     -> FETCH_HEAD\n'"
2022-05-30 15:49:08.521275 (MainThread): Executing "git tag --list"
2022-05-30 15:49:08.525265 (MainThread): STDOUT: "b'v0.1-pre\nv0.2-pre\nv0.2.1-pre\nv0.2.2-pre\nv0.2.3-pre\nv0.2.4-pre\nv0.3-pre\nv0.3.1-pre\nv0.3.2-pre\nv0.3.3-pre\nv0.4\nv0.4.1\nv0.5\nv0.6\nv0.6-b1\nv0.6-b2\nv0.6.1\nv0.6.2\nv0.7.0\nv0.7.1\nv0.7.2\nv0.7.3\n'"
2022-05-30 15:49:08.525773 (MainThread): STDERR: "b''"
2022-05-30 15:49:08.526040 (MainThread): Executing "git reset --hard origin/master"
2022-05-30 15:49:08.532768 (MainThread): STDOUT: "b'HEAD is now at 47e0261 adapt for postgresql/greenplum\n'"
2022-05-30 15:49:08.533272 (MainThread): STDERR: "b''"
2022-05-30 15:49:08.533553 (MainThread): Executing "git rev-parse HEAD"
2022-05-30 15:49:08.537889 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-30 15:49:08.538377 (MainThread): STDERR: "b''"
2022-05-30 15:49:08.538652 (MainThread):   Already at 47e0261, nothing to do.
2022-05-30 15:49:13.175157 (MainThread):   Installed from revision master

2022-05-30 15:49:13.175974 (MainThread): Installing fishtown-analytics/dbt_utils@0.6.4
2022-05-30 15:49:17.485370 (MainThread):   Installed from version 0.6.4

2022-05-30 15:49:17.486574 (MainThread): Flushing usage events
2022-05-31 16:59:49.467405 (MainThread): Running with dbt=0.19.0
2022-05-31 16:59:49.613941 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.deps.DepsTask'>, debug=False, defer=None, log_cache_events=False, log_format='default', partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='deps', single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, use_cache=True, use_colors=None, vars='{}', warn_error=False, which='deps', write_json=True)
2022-05-31 16:59:49.622646 (MainThread): Tracking: do not track
2022-05-31 16:59:49.634066 (MainThread): Set downloads directory='/tmp/dbt-downloads-6oouoxgb'
2022-05-31 16:59:49.635259 (MainThread): Executing "git clone --depth 1 https://github.com/kzzzr/dbtvault.git 8f67def39d1e3209f86c5b38b1f63392"
2022-05-31 16:59:54.039403 (MainThread): STDOUT: "b''"
2022-05-31 16:59:54.040002 (MainThread): STDERR: "b"Cloning into '8f67def39d1e3209f86c5b38b1f63392'...\n""
2022-05-31 16:59:54.040652 (MainThread): Pulling new dependency 8f67def39d1e3209f86c5b38b1f63392.
2022-05-31 16:59:54.040987 (MainThread): Executing "git rev-parse HEAD"
2022-05-31 16:59:54.046447 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-31 16:59:54.047045 (MainThread): STDERR: "b''"
2022-05-31 16:59:54.047399 (MainThread):   Checking out branch master.
2022-05-31 16:59:54.047733 (MainThread): Executing "git remote set-branches origin master"
2022-05-31 16:59:54.055175 (MainThread): STDOUT: "b''"
2022-05-31 16:59:54.055744 (MainThread): STDERR: "b''"
2022-05-31 16:59:54.056100 (MainThread): Executing "git fetch --tags --depth 1 origin master"
2022-05-31 17:00:17.268950 (MainThread): STDOUT: "b''"
2022-05-31 17:00:17.269626 (MainThread): STDERR: "b'From https://github.com/kzzzr/dbtvault\n * branch            master     -> FETCH_HEAD\n * [new tag]         v0.1-pre   -> v0.1-pre\n * [new tag]         v0.2-pre   -> v0.2-pre\n * [new tag]         v0.2.1-pre -> v0.2.1-pre\n * [new tag]         v0.2.2-pre -> v0.2.2-pre\n * [new tag]         v0.2.3-pre -> v0.2.3-pre\n * [new tag]         v0.2.4-pre -> v0.2.4-pre\n * [new tag]         v0.3-pre   -> v0.3-pre\n * [new tag]         v0.3.1-pre -> v0.3.1-pre\n * [new tag]         v0.3.2-pre -> v0.3.2-pre\n * [new tag]         v0.3.3-pre -> v0.3.3-pre\n * [new tag]         v0.4       -> v0.4\n * [new tag]         v0.4.1     -> v0.4.1\n * [new tag]         v0.5       -> v0.5\n * [new tag]         v0.6       -> v0.6\n * [new tag]         v0.6-b1    -> v0.6-b1\n * [new tag]         v0.6-b2    -> v0.6-b2\n * [new tag]         v0.6.1     -> v0.6.1\n * [new tag]         v0.6.2     -> v0.6.2\n * [new tag]         v0.7.0     -> v0.7.0\n * [new tag]         v0.7.1     -> v0.7.1\n * [new tag]         v0.7.2     -> v0.7.2\n * [new tag]         v0.7.3     -> v0.7.3\n'"
2022-05-31 17:00:17.270001 (MainThread): Executing "git tag --list"
2022-05-31 17:00:17.276868 (MainThread): STDOUT: "b'v0.1-pre\nv0.2-pre\nv0.2.1-pre\nv0.2.2-pre\nv0.2.3-pre\nv0.2.4-pre\nv0.3-pre\nv0.3.1-pre\nv0.3.2-pre\nv0.3.3-pre\nv0.4\nv0.4.1\nv0.5\nv0.6\nv0.6-b1\nv0.6-b2\nv0.6.1\nv0.6.2\nv0.7.0\nv0.7.1\nv0.7.2\nv0.7.3\n'"
2022-05-31 17:00:17.277487 (MainThread): STDERR: "b''"
2022-05-31 17:00:17.277868 (MainThread): Executing "git reset --hard origin/master"
2022-05-31 17:00:17.295872 (MainThread): STDOUT: "b'HEAD is now at 47e0261 adapt for postgresql/greenplum\n'"
2022-05-31 17:00:17.296430 (MainThread): STDERR: "b''"
2022-05-31 17:00:17.296830 (MainThread): Executing "git rev-parse HEAD"
2022-05-31 17:00:17.306321 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-31 17:00:17.306917 (MainThread): STDERR: "b''"
2022-05-31 17:00:17.307299 (MainThread):   Checked out at 47e0261.
2022-05-31 17:00:17.307679 (MainThread): WARNING: The git package "https://github.com/kzzzr/dbtvault.git" is not pinned.
	This can introduce breaking changes into your project without warning!

See https://docs.getdbt.com/docs/package-management#section-specifying-package-versions
2022-05-31 17:00:17.327096 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/index.json
2022-05-31 17:00:17.909585 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/index.json 200
2022-05-31 17:00:17.911411 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2022-05-31 17:00:18.094120 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2022-05-31 17:00:18.120545 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.4.json
2022-05-31 17:00:18.358795 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.4.json 200
2022-05-31 17:00:18.367842 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json
2022-05-31 17:00:18.581067 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils.json 200
2022-05-31 17:00:18.604974 (MainThread): Executing "git clone --depth 1 https://github.com/kzzzr/dbtvault.git 8f67def39d1e3209f86c5b38b1f63392"
2022-05-31 17:00:18.609815 (MainThread): STDOUT: "b''"
2022-05-31 17:00:18.610359 (MainThread): STDERR: "b"fatal: destination path '8f67def39d1e3209f86c5b38b1f63392' already exists and is not an empty directory.\n""
2022-05-31 17:00:18.610635 (MainThread): command return code=128
2022-05-31 17:00:18.611275 (MainThread): Updating existing dependency 8f67def39d1e3209f86c5b38b1f63392.
2022-05-31 17:00:18.611555 (MainThread): Executing "git rev-parse HEAD"
2022-05-31 17:00:18.615658 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-31 17:00:18.616255 (MainThread): STDERR: "b''"
2022-05-31 17:00:18.616572 (MainThread):   Checking out branch master.
2022-05-31 17:00:18.616819 (MainThread): Executing "git remote set-branches origin master"
2022-05-31 17:00:18.625214 (MainThread): STDOUT: "b''"
2022-05-31 17:00:18.625797 (MainThread): STDERR: "b''"
2022-05-31 17:00:18.626143 (MainThread): Executing "git fetch --tags --depth 1 origin master"
2022-05-31 17:00:21.086705 (MainThread): STDOUT: "b''"
2022-05-31 17:00:21.087534 (MainThread): STDERR: "b'From https://github.com/kzzzr/dbtvault\n * branch            master     -> FETCH_HEAD\n'"
2022-05-31 17:00:21.088193 (MainThread): Executing "git tag --list"
2022-05-31 17:00:21.093936 (MainThread): STDOUT: "b'v0.1-pre\nv0.2-pre\nv0.2.1-pre\nv0.2.2-pre\nv0.2.3-pre\nv0.2.4-pre\nv0.3-pre\nv0.3.1-pre\nv0.3.2-pre\nv0.3.3-pre\nv0.4\nv0.4.1\nv0.5\nv0.6\nv0.6-b1\nv0.6-b2\nv0.6.1\nv0.6.2\nv0.7.0\nv0.7.1\nv0.7.2\nv0.7.3\n'"
2022-05-31 17:00:21.094832 (MainThread): STDERR: "b''"
2022-05-31 17:00:21.095435 (MainThread): Executing "git reset --hard origin/master"
2022-05-31 17:00:21.106992 (MainThread): STDOUT: "b'HEAD is now at 47e0261 adapt for postgresql/greenplum\n'"
2022-05-31 17:00:21.107481 (MainThread): STDERR: "b''"
2022-05-31 17:00:21.107794 (MainThread): Executing "git rev-parse HEAD"
2022-05-31 17:00:21.115018 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-31 17:00:21.115548 (MainThread): STDERR: "b''"
2022-05-31 17:00:21.115937 (MainThread):   Already at 47e0261, nothing to do.
2022-05-31 17:00:21.116293 (MainThread): WARNING: The git package "https://github.com/kzzzr/dbtvault.git" is not pinned.
	This can introduce breaking changes into your project without warning!

See https://docs.getdbt.com/docs/package-management#section-specifying-package-versions
2022-05-31 17:00:21.131742 (MainThread): Making package registry request: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.4.json
2022-05-31 17:00:21.645382 (MainThread): Response from registry: GET https://hub.getdbt.com/api/v1/fishtown-analytics/dbt_utils/0.6.4.json 200
2022-05-31 17:00:21.648305 (MainThread): Installing https://github.com/kzzzr/dbtvault.git@master
2022-05-31 17:00:22.298160 (MainThread): Executing "git clone --depth 1 https://github.com/kzzzr/dbtvault.git 8f67def39d1e3209f86c5b38b1f63392"
2022-05-31 17:00:22.302517 (MainThread): STDOUT: "b''"
2022-05-31 17:00:22.303174 (MainThread): STDERR: "b"fatal: destination path '8f67def39d1e3209f86c5b38b1f63392' already exists and is not an empty directory.\n""
2022-05-31 17:00:22.303531 (MainThread): command return code=128
2022-05-31 17:00:22.303977 (MainThread): Updating existing dependency 8f67def39d1e3209f86c5b38b1f63392.
2022-05-31 17:00:22.304278 (MainThread): Executing "git rev-parse HEAD"
2022-05-31 17:00:22.309015 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-31 17:00:22.309676 (MainThread): STDERR: "b''"
2022-05-31 17:00:22.310088 (MainThread):   Checking out branch master.
2022-05-31 17:00:22.310384 (MainThread): Executing "git remote set-branches origin master"
2022-05-31 17:00:22.317042 (MainThread): STDOUT: "b''"
2022-05-31 17:00:22.317594 (MainThread): STDERR: "b''"
2022-05-31 17:00:22.317994 (MainThread): Executing "git fetch --tags --depth 1 origin master"
2022-05-31 17:00:23.328202 (MainThread): STDOUT: "b''"
2022-05-31 17:00:23.328806 (MainThread): STDERR: "b'From https://github.com/kzzzr/dbtvault\n * branch            master     -> FETCH_HEAD\n'"
2022-05-31 17:00:23.329118 (MainThread): Executing "git tag --list"
2022-05-31 17:00:23.334312 (MainThread): STDOUT: "b'v0.1-pre\nv0.2-pre\nv0.2.1-pre\nv0.2.2-pre\nv0.2.3-pre\nv0.2.4-pre\nv0.3-pre\nv0.3.1-pre\nv0.3.2-pre\nv0.3.3-pre\nv0.4\nv0.4.1\nv0.5\nv0.6\nv0.6-b1\nv0.6-b2\nv0.6.1\nv0.6.2\nv0.7.0\nv0.7.1\nv0.7.2\nv0.7.3\n'"
2022-05-31 17:00:23.334918 (MainThread): STDERR: "b''"
2022-05-31 17:00:23.335286 (MainThread): Executing "git reset --hard origin/master"
2022-05-31 17:00:23.344844 (MainThread): STDOUT: "b'HEAD is now at 47e0261 adapt for postgresql/greenplum\n'"
2022-05-31 17:00:23.345394 (MainThread): STDERR: "b''"
2022-05-31 17:00:23.345804 (MainThread): Executing "git rev-parse HEAD"
2022-05-31 17:00:23.350572 (MainThread): STDOUT: "b'47e0261cea67c3284ea409c86dacdc31b1175a39\n'"
2022-05-31 17:00:23.351191 (MainThread): STDERR: "b''"
2022-05-31 17:00:23.351543 (MainThread):   Already at 47e0261, nothing to do.
2022-05-31 17:00:28.595848 (MainThread):   Installed from revision master

2022-05-31 17:00:28.596573 (MainThread): Installing fishtown-analytics/dbt_utils@0.6.4
2022-05-31 17:00:33.267748 (MainThread):   Installed from version 0.6.4

2022-05-31 17:00:33.269382 (MainThread): Flushing usage events
2022-05-31 17:07:05.537528 (MainThread): Running with dbt=0.19.0
2022-05-31 17:07:05.683416 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=False, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-05-31 17:07:05.688207 (MainThread): Tracking: do not track
2022-05-31 17:07:05.813441 (MainThread): Parsing macros/adapters.sql
2022-05-31 17:07:05.848606 (MainThread): Parsing macros/catalog.sql
2022-05-31 17:07:05.853548 (MainThread): Parsing macros/relations.sql
2022-05-31 17:07:05.855982 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-05-31 17:07:05.863516 (MainThread): Parsing macros/core.sql
2022-05-31 17:07:05.871789 (MainThread): Parsing macros/adapters/common.sql
2022-05-31 17:07:05.924973 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-05-31 17:07:05.928377 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-05-31 17:07:05.931149 (MainThread): Parsing macros/etc/datetime.sql
2022-05-31 17:07:05.942985 (MainThread): Parsing macros/etc/is_incremental.sql
2022-05-31 17:07:05.945760 (MainThread): Parsing macros/etc/query.sql
2022-05-31 17:07:05.947642 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-05-31 17:07:05.949310 (MainThread): Parsing macros/materializations/helpers.sql
2022-05-31 17:07:05.961876 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-05-31 17:07:05.989587 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-05-31 17:07:05.992726 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-05-31 17:07:06.031735 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-05-31 17:07:06.058633 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-05-31 17:07:06.069733 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-05-31 17:07:06.072812 (MainThread): Parsing macros/materializations/common/merge.sql
2022-05-31 17:07:06.091792 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-05-31 17:07:06.099167 (MainThread): Parsing macros/materializations/view/view.sql
2022-05-31 17:07:06.108443 (MainThread): Parsing macros/materializations/table/table.sql
2022-05-31 17:07:06.117760 (MainThread): Parsing macros/schema_tests/unique.sql
2022-05-31 17:07:06.120659 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-05-31 17:07:06.123371 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-05-31 17:07:06.126420 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-05-31 17:07:06.173070 (MainThread): Parsing macros/internal/alias.sql
2022-05-31 17:07:06.183943 (MainThread): Parsing macros/internal/alias_all.sql
2022-05-31 17:07:06.193197 (MainThread): Parsing macros/internal/as_constant.sql
2022-05-31 17:07:06.202043 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-05-31 17:07:06.212271 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-05-31 17:07:06.218849 (MainThread): Parsing macros/internal/is_checks.sql
2022-05-31 17:07:06.229441 (MainThread): Parsing macros/internal/multikey.sql
2022-05-31 17:07:06.241833 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-05-31 17:07:06.247609 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-05-31 17:07:06.265876 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-05-31 17:07:06.296458 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-05-31 17:07:06.310810 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-05-31 17:07:06.318009 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-05-31 17:07:06.347722 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-05-31 17:07:06.373459 (MainThread): Parsing macros/staging/derive_columns.sql
2022-05-31 17:07:06.387178 (MainThread): Parsing macros/staging/hash_columns.sql
2022-05-31 17:07:06.397896 (MainThread): Parsing macros/staging/rank_columns.sql
2022-05-31 17:07:06.407146 (MainThread): Parsing macros/staging/source_columns.sql
2022-05-31 17:07:06.414783 (MainThread): Parsing macros/staging/stage.sql
2022-05-31 17:07:06.434897 (MainThread): Parsing macros/supporting/hash.sql
2022-05-31 17:07:06.449343 (MainThread): Parsing macros/supporting/prefix.sql
2022-05-31 17:07:06.462335 (MainThread): Parsing macros/tables/eff_sat.sql
2022-05-31 17:07:06.483549 (MainThread): Parsing macros/tables/hub.sql
2022-05-31 17:07:06.501760 (MainThread): Parsing macros/tables/link.sql
2022-05-31 17:07:06.520660 (MainThread): Parsing macros/tables/sat.sql
2022-05-31 17:07:06.538051 (MainThread): Parsing macros/tables/t_link.sql
2022-05-31 17:07:06.605300 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-05-31 17:07:06.614344 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-05-31 17:07:06.624639 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-05-31 17:07:06.639453 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-05-31 17:07:06.649516 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-05-31 17:07:06.668003 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-05-31 17:07:06.675432 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-05-31 17:07:06.682530 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-05-31 17:07:06.690273 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-05-31 17:07:06.698272 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-05-31 17:07:06.705053 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-05-31 17:07:06.715326 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-05-31 17:07:06.723115 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-05-31 17:07:06.730516 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-05-31 17:07:06.738387 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-05-31 17:07:06.747392 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-05-31 17:07:06.756606 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-05-31 17:07:06.765135 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-05-31 17:07:06.773150 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-05-31 17:07:06.786023 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-05-31 17:07:06.791770 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-05-31 17:07:06.799529 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-05-31 17:07:06.807359 (MainThread): Parsing macros/datetime/date_spine.sql
2022-05-31 17:07:06.819224 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-05-31 17:07:06.827182 (MainThread): Parsing macros/logger/log_info.sql
2022-05-31 17:07:06.834796 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-05-31 17:07:06.841879 (MainThread): Parsing macros/logger/pretty_time.sql
2022-05-31 17:07:06.849439 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-05-31 17:07:06.887751 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-05-31 17:07:06.895310 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-05-31 17:07:06.903877 (MainThread): Parsing macros/schema_tests/equality.sql
2022-05-31 17:07:06.915113 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-05-31 17:07:06.922361 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-05-31 17:07:06.930688 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-05-31 17:07:06.944410 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-05-31 17:07:06.952911 (MainThread): Parsing macros/schema_tests/recency.sql
2022-05-31 17:07:06.961153 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-05-31 17:07:06.970269 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-05-31 17:07:06.979020 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-05-31 17:07:06.987580 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-05-31 17:07:06.997029 (MainThread): Parsing macros/sql/generate_series.sql
2022-05-31 17:07:07.009414 (MainThread): Parsing macros/sql/get_column_values.sql
2022-05-31 17:07:07.020560 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-05-31 17:07:07.028892 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-05-31 17:07:07.039133 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-05-31 17:07:07.049287 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-05-31 17:07:07.064476 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-05-31 17:07:07.072133 (MainThread): Parsing macros/sql/groupby.sql
2022-05-31 17:07:07.079404 (MainThread): Parsing macros/sql/nullcheck.sql
2022-05-31 17:07:07.088050 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-05-31 17:07:07.096570 (MainThread): Parsing macros/sql/pivot.sql
2022-05-31 17:07:07.107827 (MainThread): Parsing macros/sql/safe_add.sql
2022-05-31 17:07:07.116893 (MainThread): Parsing macros/sql/star.sql
2022-05-31 17:07:07.127788 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-05-31 17:07:07.139164 (MainThread): Parsing macros/sql/union.sql
2022-05-31 17:07:07.157891 (MainThread): Parsing macros/sql/unpivot.sql
2022-05-31 17:07:07.173697 (MainThread): Parsing macros/web/get_url_host.sql
2022-05-31 17:07:07.184122 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-05-31 17:07:07.192018 (MainThread): Parsing macros/web/get_url_path.sql
2022-05-31 17:07:07.362431 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-05-31 17:07:07.458773 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-05-31 17:07:07.490773 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-05-31 17:07:07.541901 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-05-31 17:07:07.615670 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-05-31 17:07:07.655014 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:07:07.795756 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:07:09.305159 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-05-31 17:07:09.307048 (MainThread): 
2022-05-31 17:07:09.308249 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:07:09.314228 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-05-31 17:07:09.328846 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-05-31 17:07:09.329354 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-05-31 17:07:09.329676 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-05-31 17:07:09.354964 (ThreadPoolExecutor-0_0): SQL status: SELECT 4 in 0.03 seconds
2022-05-31 17:07:09.360484 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-05-31 17:07:09.361948 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "create_postgres_dbt".
2022-05-31 17:07:09.362718 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "create_postgres_dbt".
2022-05-31 17:07:09.363265 (ThreadPoolExecutor-0_0): Creating schema ""postgres"."dbt""
2022-05-31 17:07:09.372989 (ThreadPoolExecutor-0_0): Using postgres connection "create_postgres_dbt".
2022-05-31 17:07:09.373622 (ThreadPoolExecutor-0_0): On create_postgres_dbt: BEGIN
2022-05-31 17:07:09.374091 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state closed
2022-05-31 17:07:09.383676 (ThreadPoolExecutor-0_0): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:07:09.384441 (ThreadPoolExecutor-0_0): Using postgres connection "create_postgres_dbt".
2022-05-31 17:07:09.385150 (ThreadPoolExecutor-0_0): On create_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "create_postgres_dbt"} */
create schema if not exists "dbt"
2022-05-31 17:07:09.411188 (ThreadPoolExecutor-0_0): SQL status: CREATE SCHEMA in 0.03 seconds
2022-05-31 17:07:09.412962 (ThreadPoolExecutor-0_0): On create_postgres_dbt: COMMIT
2022-05-31 17:07:09.413380 (ThreadPoolExecutor-0_0): Using postgres connection "create_postgres_dbt".
2022-05-31 17:07:09.413710 (ThreadPoolExecutor-0_0): On create_postgres_dbt: COMMIT
2022-05-31 17:07:09.417702 (ThreadPoolExecutor-0_0): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:07:09.418263 (ThreadPoolExecutor-0_0): On create_postgres_dbt: Close
2022-05-31 17:07:09.434225 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-05-31 17:07:09.444027 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:07:09.444512 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-05-31 17:07:09.444893 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-05-31 17:07:09.457225 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:07:09.457745 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:07:09.458086 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-05-31 17:07:09.480309 (ThreadPoolExecutor-1_0): SQL status: SELECT 0 in 0.02 seconds
2022-05-31 17:07:09.481136 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-05-31 17:07:09.481699 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-05-31 17:07:09.502974 (MainThread): Using postgres connection "master".
2022-05-31 17:07:09.503558 (MainThread): On master: BEGIN
2022-05-31 17:07:09.503956 (MainThread): Opening a new connection, currently in state init
2022-05-31 17:07:09.510423 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:07:09.511011 (MainThread): Using postgres connection "master".
2022-05-31 17:07:09.511369 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-05-31 17:07:09.525538 (MainThread): SQL status: SELECT 0 in 0.01 seconds
2022-05-31 17:07:09.526480 (MainThread): On master: ROLLBACK
2022-05-31 17:07:09.527229 (MainThread): Using postgres connection "master".
2022-05-31 17:07:09.527623 (MainThread): On master: BEGIN
2022-05-31 17:07:09.528363 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-05-31 17:07:09.528792 (MainThread): On master: COMMIT
2022-05-31 17:07:09.529101 (MainThread): Using postgres connection "master".
2022-05-31 17:07:09.529440 (MainThread): On master: COMMIT
2022-05-31 17:07:09.530013 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:07:09.530367 (MainThread): On master: Close
2022-05-31 17:07:09.531044 (MainThread): 17:07:09 | Concurrency: 1 threads (target='dev')
2022-05-31 17:07:09.531548 (MainThread): 17:07:09 | 
2022-05-31 17:07:09.537342 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_customers
2022-05-31 17:07:09.539477 (Thread-1): 17:07:09 | 1 of 2 START seed file dbt.source_customers.......................... [RUN]
2022-05-31 17:07:09.540188 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-05-31 17:07:09.540719 (Thread-1): finished collecting timing info
2022-05-31 17:07:09.589844 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-05-31 17:07:09.591123 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-05-31 17:07:09.591806 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: BEGIN
2022-05-31 17:07:09.592574 (Thread-1): Opening a new connection, currently in state closed
2022-05-31 17:07:09.599910 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:07:09.600507 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-05-31 17:07:09.601075 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */

    create table "postgres"."dbt"."source_customers" (id integer,first_name text,last_name text,email text)
  
2022-05-31 17:07:09.639023 (Thread-1): SQL status: CREATE TABLE in 0.04 seconds
2022-05-31 17:07:09.662757 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-05-31 17:07:09.663315 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: 
            insert into "postgres"."dbt"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%...
2022-05-31 17:07:09.668967 (Thread-1): SQL status: INSERT 0 101 in 0.01 seconds
2022-05-31 17:07:09.674703 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_customers"
2022-05-31 17:07:09.704067 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-05-31 17:07:09.704724 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-05-31 17:07:09.705123 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-05-31 17:07:09.709906 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:07:09.712562 (Thread-1): finished collecting timing info
2022-05-31 17:07:09.713120 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: Close
2022-05-31 17:07:09.714443 (Thread-1): 17:07:09 | 1 of 2 OK loaded seed file dbt.source_customers...................... [INSERT 101 in 0.17s]
2022-05-31 17:07:09.715155 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_customers
2022-05-31 17:07:09.716008 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_orders
2022-05-31 17:07:09.718620 (Thread-1): 17:07:09 | 2 of 2 START seed file dbt.source_orders............................. [RUN]
2022-05-31 17:07:09.719552 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-05-31 17:07:09.720584 (Thread-1): finished collecting timing info
2022-05-31 17:07:09.739797 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-05-31 17:07:09.740287 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: BEGIN
2022-05-31 17:07:09.740719 (Thread-1): Opening a new connection, currently in state closed
2022-05-31 17:07:09.747997 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:07:09.748565 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-05-31 17:07:09.749045 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */

    create table "postgres"."dbt"."source_orders" (id integer,user_id integer,order_date date,status text)
  
2022-05-31 17:07:09.756954 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-05-31 17:07:09.762170 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-05-31 17:07:09.762600 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: 
            insert into "postgres"."dbt"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s...
2022-05-31 17:07:09.766879 (Thread-1): SQL status: INSERT 0 99 in 0.00 seconds
2022-05-31 17:07:09.767991 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_orders"
2022-05-31 17:07:09.781199 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-05-31 17:07:09.781871 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-05-31 17:07:09.782437 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-05-31 17:07:09.785212 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:07:09.788403 (Thread-1): finished collecting timing info
2022-05-31 17:07:09.789096 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: Close
2022-05-31 17:07:09.790270 (Thread-1): 17:07:09 | 2 of 2 OK loaded seed file dbt.source_orders......................... [INSERT 99 in 0.07s]
2022-05-31 17:07:09.790791 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_orders
2022-05-31 17:07:09.793484 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:07:09.794118 (MainThread): Using postgres connection "master".
2022-05-31 17:07:09.794532 (MainThread): On master: BEGIN
2022-05-31 17:07:09.794933 (MainThread): Opening a new connection, currently in state closed
2022-05-31 17:07:09.801765 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:07:09.802352 (MainThread): On master: COMMIT
2022-05-31 17:07:09.802707 (MainThread): Using postgres connection "master".
2022-05-31 17:07:09.802982 (MainThread): On master: COMMIT
2022-05-31 17:07:09.803545 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:07:09.803877 (MainThread): On master: Close
2022-05-31 17:07:09.804531 (MainThread): 17:07:09 | 
2022-05-31 17:07:09.804971 (MainThread): 17:07:09 | Finished running 2 seeds in 0.50s.
2022-05-31 17:07:09.805699 (MainThread): Connection 'master' was properly closed.
2022-05-31 17:07:09.806437 (MainThread): Connection 'seed.jaffle_shop_dbtvault.source_orders' was properly closed.
2022-05-31 17:07:09.926939 (MainThread): 
2022-05-31 17:07:09.927487 (MainThread): Completed successfully
2022-05-31 17:07:09.928069 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-05-31 17:07:09.929176 (MainThread): Flushing usage events
2022-05-31 17:24:55.552044 (MainThread): Running with dbt=0.19.0
2022-05-31 17:24:55.686673 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=[':stage'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-05-31 17:24:55.691569 (MainThread): Tracking: do not track
2022-05-31 17:24:56.364368 (MainThread): Got an acceptable cached parse result
2022-05-31 17:24:57.861330 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-05-31 17:24:57.862543 (MainThread): The selector ':stage' does not match any nodes and will be ignored
2022-05-31 17:24:57.864883 (MainThread): WARNING: Nothing to do. Try checking your model configs and model specification args
2022-05-31 17:24:57.865863 (MainThread): Flushing usage events
2022-05-31 17:25:20.240036 (MainThread): Running with dbt=0.19.0
2022-05-31 17:25:20.398421 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-05-31 17:25:20.403691 (MainThread): Tracking: do not track
2022-05-31 17:25:21.089677 (MainThread): Got an acceptable cached parse result
2022-05-31 17:25:22.428084 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-05-31 17:25:22.430471 (MainThread): 
2022-05-31 17:25:22.431807 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:25:22.437126 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-05-31 17:25:22.452020 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-05-31 17:25:22.452604 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-05-31 17:25:22.452995 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-05-31 17:25:22.463052 (ThreadPoolExecutor-0_0): SQL status: SELECT 5 in 0.01 seconds
2022-05-31 17:25:22.466577 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-05-31 17:25:22.485830 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-05-31 17:25:22.496830 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:25:22.497464 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-05-31 17:25:22.497984 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-05-31 17:25:22.506993 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:25:22.507546 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:25:22.507911 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-05-31 17:25:22.511358 (ThreadPoolExecutor-1_0): SQL status: SELECT 2 in 0.00 seconds
2022-05-31 17:25:22.514823 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-05-31 17:25:22.515548 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-05-31 17:25:22.535436 (MainThread): Using postgres connection "master".
2022-05-31 17:25:22.536064 (MainThread): On master: BEGIN
2022-05-31 17:25:22.536521 (MainThread): Opening a new connection, currently in state init
2022-05-31 17:25:22.543250 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:25:22.543824 (MainThread): Using postgres connection "master".
2022-05-31 17:25:22.544136 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-05-31 17:25:22.558033 (MainThread): SQL status: SELECT 0 in 0.01 seconds
2022-05-31 17:25:22.559023 (MainThread): On master: ROLLBACK
2022-05-31 17:25:22.559729 (MainThread): Using postgres connection "master".
2022-05-31 17:25:22.560109 (MainThread): On master: BEGIN
2022-05-31 17:25:22.560907 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-05-31 17:25:22.561444 (MainThread): On master: COMMIT
2022-05-31 17:25:22.561812 (MainThread): Using postgres connection "master".
2022-05-31 17:25:22.562149 (MainThread): On master: COMMIT
2022-05-31 17:25:22.562757 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:25:22.563161 (MainThread): On master: Close
2022-05-31 17:25:22.563815 (MainThread): 17:25:22 | Concurrency: 1 threads (target='dev')
2022-05-31 17:25:22.564287 (MainThread): 17:25:22 | 
2022-05-31 17:25:22.570365 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers
2022-05-31 17:25:22.572550 (Thread-1): 17:25:22 | 1 of 2 START view model dbt.v_stg_customers.......................... [RUN]
2022-05-31 17:25:22.573364 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.574037 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers
2022-05-31 17:25:22.656058 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.656680 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: BEGIN
2022-05-31 17:25:22.657082 (Thread-1): Opening a new connection, currently in state closed
2022-05-31 17:25:22.664466 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:25:22.665080 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.665478 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-05-31 17:25:22.688233 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-05-31 17:25:22.734534 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.735105 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-05-31 17:25:22.739580 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-05-31 17:25:22.787931 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-05-31 17:25:22.810050 (Thread-1): finished collecting timing info
2022-05-31 17:25:22.844666 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.845298 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_tmp" cascade
2022-05-31 17:25:22.849300 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-05-31 17:25:22.854861 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.855380 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-05-31 17:25:22.856088 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-05-31 17:25:22.861713 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-05-31 17:25:22.880497 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.881173 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

  create view "postgres"."dbt"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."dbt"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-05-31 17:25:22.897367 (Thread-1): SQL status: CREATE VIEW in 0.02 seconds
2022-05-31 17:25:22.906094 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.906546 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
alter table "postgres"."dbt"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-05-31 17:25:22.909891 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-05-31 17:25:22.918204 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-05-31 17:25:22.918733 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.919082 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-05-31 17:25:22.922643 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:25:22.927764 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-05-31 17:25:22.928230 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-05-31 17:25:22.928979 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-05-31 17:25:22.932216 (Thread-1): finished collecting timing info
2022-05-31 17:25:22.932844 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: Close
2022-05-31 17:25:22.934990 (Thread-1): 17:25:22 | 1 of 2 OK created view model dbt.v_stg_customers..................... [CREATE VIEW in 0.36s]
2022-05-31 17:25:22.935594 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers
2022-05-31 17:25:22.936352 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_orders
2022-05-31 17:25:22.938468 (Thread-1): 17:25:22 | 2 of 2 START view model dbt.v_stg_orders............................. [RUN]
2022-05-31 17:25:22.939325 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:22.939881 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_orders
2022-05-31 17:25:22.959692 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:22.960272 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: BEGIN
2022-05-31 17:25:22.960780 (Thread-1): Opening a new connection, currently in state closed
2022-05-31 17:25:22.966620 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:25:22.967184 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:22.967517 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-05-31 17:25:22.974188 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-05-31 17:25:22.982437 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:22.983024 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-05-31 17:25:22.987271 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-05-31 17:25:22.994764 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-05-31 17:25:23.005019 (Thread-1): finished collecting timing info
2022-05-31 17:25:23.017118 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:23.017665 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_tmp" cascade
2022-05-31 17:25:23.018413 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-05-31 17:25:23.022258 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:23.022774 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-05-31 17:25:23.023493 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-05-31 17:25:23.025270 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-05-31 17:25:23.034891 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:23.035323 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

  create view "postgres"."dbt"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."dbt"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-05-31 17:25:23.040564 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-05-31 17:25:23.045970 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:23.046523 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
alter table "postgres"."dbt"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-05-31 17:25:23.047899 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-05-31 17:25:23.049894 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-05-31 17:25:23.050305 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:23.050680 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-05-31 17:25:23.052961 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:25:23.057910 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-05-31 17:25:23.058431 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-05-31 17:25:23.059180 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-05-31 17:25:23.062449 (Thread-1): finished collecting timing info
2022-05-31 17:25:23.063086 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: Close
2022-05-31 17:25:23.065200 (Thread-1): 17:25:23 | 2 of 2 OK created view model dbt.v_stg_orders........................ [CREATE VIEW in 0.12s]
2022-05-31 17:25:23.065803 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_orders
2022-05-31 17:25:23.068300 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:25:23.068918 (MainThread): Using postgres connection "master".
2022-05-31 17:25:23.069301 (MainThread): On master: BEGIN
2022-05-31 17:25:23.069715 (MainThread): Opening a new connection, currently in state closed
2022-05-31 17:25:23.076122 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:25:23.076679 (MainThread): On master: COMMIT
2022-05-31 17:25:23.076991 (MainThread): Using postgres connection "master".
2022-05-31 17:25:23.077316 (MainThread): On master: COMMIT
2022-05-31 17:25:23.078041 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:25:23.078452 (MainThread): On master: Close
2022-05-31 17:25:23.079178 (MainThread): 17:25:23 | 
2022-05-31 17:25:23.079675 (MainThread): 17:25:23 | Finished running 2 view models in 0.65s.
2022-05-31 17:25:23.080241 (MainThread): Connection 'master' was properly closed.
2022-05-31 17:25:23.080936 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_stg_orders' was properly closed.
2022-05-31 17:25:23.203202 (MainThread): 
2022-05-31 17:25:23.203798 (MainThread): Completed successfully
2022-05-31 17:25:23.204575 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-05-31 17:25:23.205802 (MainThread): Flushing usage events
2022-05-31 17:36:04.414123 (MainThread): Running with dbt=0.19.0
2022-05-31 17:36:04.558689 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:hub'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-05-31 17:36:04.563404 (MainThread): Tracking: do not track
2022-05-31 17:36:05.226558 (MainThread): Got an acceptable cached parse result
2022-05-31 17:36:06.539445 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-05-31 17:36:06.541700 (MainThread): 
2022-05-31 17:36:06.542992 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:36:06.548011 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-05-31 17:36:06.564135 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-05-31 17:36:06.564673 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-05-31 17:36:06.565009 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-05-31 17:36:06.582871 (ThreadPoolExecutor-0_0): SQL status: SELECT 5 in 0.02 seconds
2022-05-31 17:36:06.586607 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-05-31 17:36:06.605635 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-05-31 17:36:06.615972 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:36:06.616571 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-05-31 17:36:06.617014 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-05-31 17:36:06.624075 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:36:06.624675 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:36:06.625007 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-05-31 17:36:06.628814 (ThreadPoolExecutor-1_0): SQL status: SELECT 4 in 0.00 seconds
2022-05-31 17:36:06.634116 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-05-31 17:36:06.634976 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-05-31 17:36:06.658674 (MainThread): Using postgres connection "master".
2022-05-31 17:36:06.659189 (MainThread): On master: BEGIN
2022-05-31 17:36:06.659502 (MainThread): Opening a new connection, currently in state init
2022-05-31 17:36:06.666435 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:36:06.666954 (MainThread): Using postgres connection "master".
2022-05-31 17:36:06.667246 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-05-31 17:36:06.673835 (MainThread): SQL status: SELECT 2 in 0.01 seconds
2022-05-31 17:36:06.678172 (MainThread): On master: ROLLBACK
2022-05-31 17:36:06.678989 (MainThread): Using postgres connection "master".
2022-05-31 17:36:06.679376 (MainThread): On master: BEGIN
2022-05-31 17:36:06.680132 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-05-31 17:36:06.680664 (MainThread): On master: COMMIT
2022-05-31 17:36:06.681033 (MainThread): Using postgres connection "master".
2022-05-31 17:36:06.681332 (MainThread): On master: COMMIT
2022-05-31 17:36:06.681853 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:36:06.682297 (MainThread): On master: Close
2022-05-31 17:36:06.683055 (MainThread): 17:36:06 | Concurrency: 1 threads (target='dev')
2022-05-31 17:36:06.683607 (MainThread): 17:36:06 | 
2022-05-31 17:36:06.687741 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_customer
2022-05-31 17:36:06.690386 (Thread-1): 17:36:06 | 1 of 2 START incremental model dbt.hub_customer...................... [RUN]
2022-05-31 17:36:06.691257 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-05-31 17:36:06.691824 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_customer
2022-05-31 17:36:06.789086 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-05-31 17:36:06.812844 (Thread-1): finished collecting timing info
2022-05-31 17:36:06.859979 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-05-31 17:36:06.883345 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-05-31 17:36:06.883808 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: BEGIN
2022-05-31 17:36:06.884244 (Thread-1): Opening a new connection, currently in state closed
2022-05-31 17:36:06.891710 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:36:06.892363 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-05-31 17:36:06.892678 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      

  create  table "postgres"."dbt"."hub_customer"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_customers"

) as h
WHERE row_number = 1
),

row_rank_2 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

stage_union AS (
    SELECT * FROM row_rank_1
    UNION ALL
    SELECT * FROM row_rank_2
),

row_rank_union AS (

SELECT * FROM (

    SELECT *,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE, RECORD_SOURCE ASC
           ) AS row_rank_number
    FROM stage_union
    WHERE CUSTOMER_PK IS NOT NULL
) as h 
WHERE row_rank_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_union AS a
)

SELECT * FROM records_to_insert
  );
  
2022-05-31 17:36:06.910230 (Thread-1): SQL status: SELECT 101 in 0.02 seconds
2022-05-31 17:36:06.921757 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-05-31 17:36:06.922231 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-05-31 17:36:06.922504 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-05-31 17:36:06.925741 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:36:06.928269 (Thread-1): finished collecting timing info
2022-05-31 17:36:06.928998 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: Close
2022-05-31 17:36:06.931319 (Thread-1): 17:36:06 | 1 of 2 OK created incremental model dbt.hub_customer................. [SELECT 101 in 0.24s]
2022-05-31 17:36:06.931957 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_customer
2022-05-31 17:36:06.932514 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_order
2022-05-31 17:36:06.935103 (Thread-1): 17:36:06 | 2 of 2 START incremental model dbt.hub_order......................... [RUN]
2022-05-31 17:36:06.936129 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-05-31 17:36:06.936732 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_order
2022-05-31 17:36:06.952043 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-05-31 17:36:06.960061 (Thread-1): finished collecting timing info
2022-05-31 17:36:06.971673 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-05-31 17:36:06.982148 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-05-31 17:36:06.982600 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: BEGIN
2022-05-31 17:36:06.983035 (Thread-1): Opening a new connection, currently in state closed
2022-05-31 17:36:06.989560 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:36:06.990100 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-05-31 17:36:06.990412 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      

  create  table "postgres"."dbt"."hub_order"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT ORDER_PK, ORDER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-05-31 17:36:06.998740 (Thread-1): SQL status: SELECT 99 in 0.01 seconds
2022-05-31 17:36:07.000630 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-05-31 17:36:07.001206 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-05-31 17:36:07.001515 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-05-31 17:36:07.003351 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:36:07.006661 (Thread-1): finished collecting timing info
2022-05-31 17:36:07.007257 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: Close
2022-05-31 17:36:07.009478 (Thread-1): 17:36:06 | 2 of 2 OK created incremental model dbt.hub_order.................... [SELECT 99 in 0.07s]
2022-05-31 17:36:07.010032 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_order
2022-05-31 17:36:07.012534 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:36:07.013097 (MainThread): Using postgres connection "master".
2022-05-31 17:36:07.013442 (MainThread): On master: BEGIN
2022-05-31 17:36:07.013768 (MainThread): Opening a new connection, currently in state closed
2022-05-31 17:36:07.020996 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:36:07.021670 (MainThread): On master: COMMIT
2022-05-31 17:36:07.022030 (MainThread): Using postgres connection "master".
2022-05-31 17:36:07.022389 (MainThread): On master: COMMIT
2022-05-31 17:36:07.023003 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:36:07.023392 (MainThread): On master: Close
2022-05-31 17:36:07.024269 (MainThread): 17:36:07 | 
2022-05-31 17:36:07.025040 (MainThread): 17:36:07 | Finished running 2 incremental models in 0.48s.
2022-05-31 17:36:07.026051 (MainThread): Connection 'master' was properly closed.
2022-05-31 17:36:07.026808 (MainThread): Connection 'model.jaffle_shop_dbtvault.hub_order' was properly closed.
2022-05-31 17:36:07.150130 (MainThread): 
2022-05-31 17:36:07.151041 (MainThread): Completed successfully
2022-05-31 17:36:07.151843 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-05-31 17:36:07.152997 (MainThread): Flushing usage events
2022-05-31 17:41:24.213784 (MainThread): Running with dbt=0.19.0
2022-05-31 17:41:24.350591 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:satellite'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-05-31 17:41:24.354753 (MainThread): Tracking: do not track
2022-05-31 17:41:25.028677 (MainThread): Got an acceptable cached parse result
2022-05-31 17:41:26.314122 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-05-31 17:41:26.316295 (MainThread): 
2022-05-31 17:41:26.317437 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:41:26.322785 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-05-31 17:41:26.339252 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-05-31 17:41:26.340006 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-05-31 17:41:26.340485 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-05-31 17:41:26.348264 (ThreadPoolExecutor-0_0): SQL status: SELECT 5 in 0.01 seconds
2022-05-31 17:41:26.353109 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-05-31 17:41:26.380898 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-05-31 17:41:26.390940 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:41:26.391462 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-05-31 17:41:26.391805 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-05-31 17:41:26.399774 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:41:26.400407 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:41:26.400821 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-05-31 17:41:26.404714 (ThreadPoolExecutor-1_0): SQL status: SELECT 6 in 0.00 seconds
2022-05-31 17:41:26.411654 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-05-31 17:41:26.412508 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-05-31 17:41:26.432844 (MainThread): Using postgres connection "master".
2022-05-31 17:41:26.433594 (MainThread): On master: BEGIN
2022-05-31 17:41:26.434071 (MainThread): Opening a new connection, currently in state init
2022-05-31 17:41:26.440492 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:41:26.441064 (MainThread): Using postgres connection "master".
2022-05-31 17:41:26.441431 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-05-31 17:41:26.449492 (MainThread): SQL status: SELECT 2 in 0.01 seconds
2022-05-31 17:41:26.454094 (MainThread): On master: ROLLBACK
2022-05-31 17:41:26.454855 (MainThread): Using postgres connection "master".
2022-05-31 17:41:26.455208 (MainThread): On master: BEGIN
2022-05-31 17:41:26.455933 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-05-31 17:41:26.456347 (MainThread): On master: COMMIT
2022-05-31 17:41:26.456725 (MainThread): Using postgres connection "master".
2022-05-31 17:41:26.457097 (MainThread): On master: COMMIT
2022-05-31 17:41:26.457613 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:41:26.458045 (MainThread): On master: Close
2022-05-31 17:41:26.458966 (MainThread): 17:41:26 | Concurrency: 1 threads (target='dev')
2022-05-31 17:41:26.459615 (MainThread): 17:41:26 | 
2022-05-31 17:41:26.463155 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_customer_details
2022-05-31 17:41:26.465953 (Thread-1): 17:41:26 | 1 of 2 START incremental model dbt.sat_customer_details.............. [RUN]
2022-05-31 17:41:26.466888 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-05-31 17:41:26.467559 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_customer_details
2022-05-31 17:41:26.585251 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-05-31 17:41:26.604310 (Thread-1): finished collecting timing info
2022-05-31 17:41:26.654190 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-05-31 17:41:26.671144 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-05-31 17:41:26.671670 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: BEGIN
2022-05-31 17:41:26.672023 (Thread-1): Opening a new connection, currently in state closed
2022-05-31 17:41:26.678263 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:41:26.678875 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-05-31 17:41:26.679237 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      

  create  table "postgres"."dbt"."sat_customer_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_customers" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.first_name, e.last_name, e.email, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-05-31 17:41:26.689028 (Thread-1): SQL status: SELECT 101 in 0.01 seconds
2022-05-31 17:41:26.698383 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-05-31 17:41:26.698921 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-05-31 17:41:26.699271 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-05-31 17:41:26.701436 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:41:26.704012 (Thread-1): finished collecting timing info
2022-05-31 17:41:26.704542 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: Close
2022-05-31 17:41:26.706641 (Thread-1): 17:41:26 | 1 of 2 OK created incremental model dbt.sat_customer_details......... [SELECT 101 in 0.24s]
2022-05-31 17:41:26.707219 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_customer_details
2022-05-31 17:41:26.707676 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_order_details
2022-05-31 17:41:26.709833 (Thread-1): 17:41:26 | 2 of 2 START incremental model dbt.sat_order_details................. [RUN]
2022-05-31 17:41:26.711011 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-05-31 17:41:26.711697 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_order_details
2022-05-31 17:41:26.731107 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-05-31 17:41:26.743069 (Thread-1): finished collecting timing info
2022-05-31 17:41:26.753020 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-05-31 17:41:26.764242 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-05-31 17:41:26.764699 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: BEGIN
2022-05-31 17:41:26.765049 (Thread-1): Opening a new connection, currently in state closed
2022-05-31 17:41:26.771741 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:41:26.772348 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-05-31 17:41:26.772732 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      

  create  table "postgres"."dbt"."sat_order_details"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_orders" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.order_date, e.status, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-05-31 17:41:26.782665 (Thread-1): SQL status: SELECT 99 in 0.01 seconds
2022-05-31 17:41:26.784667 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-05-31 17:41:26.785054 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-05-31 17:41:26.785417 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-05-31 17:41:26.787781 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:41:26.790784 (Thread-1): finished collecting timing info
2022-05-31 17:41:26.791353 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: Close
2022-05-31 17:41:26.793468 (Thread-1): 17:41:26 | 2 of 2 OK created incremental model dbt.sat_order_details............ [SELECT 99 in 0.08s]
2022-05-31 17:41:26.794084 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_order_details
2022-05-31 17:41:26.797445 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:41:26.798205 (MainThread): Using postgres connection "master".
2022-05-31 17:41:26.798642 (MainThread): On master: BEGIN
2022-05-31 17:41:26.799009 (MainThread): Opening a new connection, currently in state closed
2022-05-31 17:41:26.805321 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:41:26.806054 (MainThread): On master: COMMIT
2022-05-31 17:41:26.806428 (MainThread): Using postgres connection "master".
2022-05-31 17:41:26.806735 (MainThread): On master: COMMIT
2022-05-31 17:41:26.807286 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:41:26.807633 (MainThread): On master: Close
2022-05-31 17:41:26.808407 (MainThread): 17:41:26 | 
2022-05-31 17:41:26.808920 (MainThread): 17:41:26 | Finished running 2 incremental models in 0.49s.
2022-05-31 17:41:26.809610 (MainThread): Connection 'master' was properly closed.
2022-05-31 17:41:26.810364 (MainThread): Connection 'model.jaffle_shop_dbtvault.sat_order_details' was properly closed.
2022-05-31 17:41:26.932731 (MainThread): 
2022-05-31 17:41:26.933310 (MainThread): Completed successfully
2022-05-31 17:41:26.933963 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-05-31 17:41:26.935094 (MainThread): Flushing usage events
2022-05-31 17:42:52.026997 (MainThread): Running with dbt=0.19.0
2022-05-31 17:42:52.168483 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:link'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-05-31 17:42:52.172402 (MainThread): Tracking: do not track
2022-05-31 17:42:52.825369 (MainThread): Got an acceptable cached parse result
2022-05-31 17:42:54.189026 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-05-31 17:42:54.190718 (MainThread): 
2022-05-31 17:42:54.191867 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:42:54.195960 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-05-31 17:42:54.212291 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-05-31 17:42:54.213033 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-05-31 17:42:54.213591 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-05-31 17:42:54.222643 (ThreadPoolExecutor-0_0): SQL status: SELECT 5 in 0.01 seconds
2022-05-31 17:42:54.226004 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-05-31 17:42:54.242640 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-05-31 17:42:54.253587 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:42:54.254102 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-05-31 17:42:54.254572 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-05-31 17:42:54.261746 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:42:54.262309 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-05-31 17:42:54.262698 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-05-31 17:42:54.266150 (ThreadPoolExecutor-1_0): SQL status: SELECT 8 in 0.00 seconds
2022-05-31 17:42:54.274627 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-05-31 17:42:54.275519 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-05-31 17:42:54.296246 (MainThread): Using postgres connection "master".
2022-05-31 17:42:54.296788 (MainThread): On master: BEGIN
2022-05-31 17:42:54.297101 (MainThread): Opening a new connection, currently in state init
2022-05-31 17:42:54.303243 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:42:54.303778 (MainThread): Using postgres connection "master".
2022-05-31 17:42:54.304063 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-05-31 17:42:54.314737 (MainThread): SQL status: SELECT 2 in 0.01 seconds
2022-05-31 17:42:54.319608 (MainThread): On master: ROLLBACK
2022-05-31 17:42:54.320439 (MainThread): Using postgres connection "master".
2022-05-31 17:42:54.320900 (MainThread): On master: BEGIN
2022-05-31 17:42:54.321606 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-05-31 17:42:54.322029 (MainThread): On master: COMMIT
2022-05-31 17:42:54.322372 (MainThread): Using postgres connection "master".
2022-05-31 17:42:54.322662 (MainThread): On master: COMMIT
2022-05-31 17:42:54.323203 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:42:54.323587 (MainThread): On master: Close
2022-05-31 17:42:54.324231 (MainThread): 17:42:54 | Concurrency: 1 threads (target='dev')
2022-05-31 17:42:54.324756 (MainThread): 17:42:54 | 
2022-05-31 17:42:54.330337 (Thread-1): Began running node model.jaffle_shop_dbtvault.link_customer_order
2022-05-31 17:42:54.332725 (Thread-1): 17:42:54 | 1 of 1 START incremental model dbt.link_customer_order............... [RUN]
2022-05-31 17:42:54.333680 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-05-31 17:42:54.334204 (Thread-1): Compiling model.jaffle_shop_dbtvault.link_customer_order
2022-05-31 17:42:54.428533 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.link_customer_order"
2022-05-31 17:42:54.449168 (Thread-1): finished collecting timing info
2022-05-31 17:42:54.502356 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.link_customer_order"
2022-05-31 17:42:54.521826 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-05-31 17:42:54.522349 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: BEGIN
2022-05-31 17:42:54.522772 (Thread-1): Opening a new connection, currently in state closed
2022-05-31 17:42:54.529753 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:42:54.530330 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-05-31 17:42:54.530671 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      

  create  table "postgres"."dbt"."link_customer_order"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_CUSTOMER_ORDER_PK, CUSTOMER_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_CUSTOMER_ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_CUSTOMER_ORDER_PK, a.CUSTOMER_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
)

SELECT * FROM records_to_insert
  );
  
2022-05-31 17:42:54.539851 (Thread-1): SQL status: SELECT 99 in 0.01 seconds
2022-05-31 17:42:54.551067 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: COMMIT
2022-05-31 17:42:54.551712 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-05-31 17:42:54.552184 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: COMMIT
2022-05-31 17:42:54.554780 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:42:54.558726 (Thread-1): finished collecting timing info
2022-05-31 17:42:54.559424 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: Close
2022-05-31 17:42:54.561938 (Thread-1): 17:42:54 | 1 of 1 OK created incremental model dbt.link_customer_order.......... [SELECT 99 in 0.23s]
2022-05-31 17:42:54.562545 (Thread-1): Finished running node model.jaffle_shop_dbtvault.link_customer_order
2022-05-31 17:42:54.565366 (MainThread): Acquiring new postgres connection "master".
2022-05-31 17:42:54.566168 (MainThread): Using postgres connection "master".
2022-05-31 17:42:54.566541 (MainThread): On master: BEGIN
2022-05-31 17:42:54.566887 (MainThread): Opening a new connection, currently in state closed
2022-05-31 17:42:54.573342 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-05-31 17:42:54.574081 (MainThread): On master: COMMIT
2022-05-31 17:42:54.574637 (MainThread): Using postgres connection "master".
2022-05-31 17:42:54.575015 (MainThread): On master: COMMIT
2022-05-31 17:42:54.575579 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-05-31 17:42:54.576001 (MainThread): On master: Close
2022-05-31 17:42:54.576693 (MainThread): 17:42:54 | 
2022-05-31 17:42:54.577226 (MainThread): 17:42:54 | Finished running 1 incremental model in 0.39s.
2022-05-31 17:42:54.577940 (MainThread): Connection 'master' was properly closed.
2022-05-31 17:42:54.578692 (MainThread): Connection 'model.jaffle_shop_dbtvault.link_customer_order' was properly closed.
2022-05-31 17:42:54.697873 (MainThread): 
2022-05-31 17:42:54.698542 (MainThread): Completed successfully
2022-05-31 17:42:54.699434 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2022-05-31 17:42:54.700564 (MainThread): Flushing usage events
2022-06-05 17:12:33.919200 (MainThread): Running with dbt=0.19.0
2022-06-05 17:12:34.082715 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=True, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-06-05 17:12:34.090959 (MainThread): Tracking: do not track
2022-06-05 17:12:35.346251 (MainThread): Got an acceptable cached parse result
2022-06-05 17:12:36.913100 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-05 17:12:36.915597 (MainThread): 
2022-06-05 17:12:36.916741 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:12:36.924256 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-05 17:12:36.940673 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-05 17:12:36.941192 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-05 17:12:36.941509 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-05 17:12:36.962154 (ThreadPoolExecutor-0_0): SQL status: SELECT 5 in 0.02 seconds
2022-06-05 17:12:36.966123 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-05 17:12:36.984598 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-05 17:12:36.993915 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:12:36.994426 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-05 17:12:36.994869 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-05 17:12:37.003801 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:12:37.004522 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:12:37.004923 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-05 17:12:37.012229 (ThreadPoolExecutor-1_0): SQL status: SELECT 9 in 0.01 seconds
2022-06-05 17:12:37.021185 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-05 17:12:37.021933 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-05 17:12:37.043632 (MainThread): Using postgres connection "master".
2022-06-05 17:12:37.044127 (MainThread): On master: BEGIN
2022-06-05 17:12:37.044409 (MainThread): Opening a new connection, currently in state init
2022-06-05 17:12:37.053589 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:12:37.054131 (MainThread): Using postgres connection "master".
2022-06-05 17:12:37.054405 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-05 17:12:37.077380 (MainThread): SQL status: SELECT 2 in 0.02 seconds
2022-06-05 17:12:37.081329 (MainThread): On master: ROLLBACK
2022-06-05 17:12:37.082145 (MainThread): Using postgres connection "master".
2022-06-05 17:12:37.082557 (MainThread): On master: BEGIN
2022-06-05 17:12:37.083444 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:12:37.083955 (MainThread): On master: COMMIT
2022-06-05 17:12:37.084303 (MainThread): Using postgres connection "master".
2022-06-05 17:12:37.084601 (MainThread): On master: COMMIT
2022-06-05 17:12:37.085310 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:12:37.085756 (MainThread): On master: Close
2022-06-05 17:12:37.086471 (MainThread): 17:12:37 | Concurrency: 1 threads (target='dev')
2022-06-05 17:12:37.087126 (MainThread): 17:12:37 | 
2022-06-05 17:12:37.091541 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_customers
2022-06-05 17:12:37.093535 (Thread-1): 17:12:37 | 1 of 2 START seed file dbt.source_customers.......................... [RUN]
2022-06-05 17:12:37.094825 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:12:37.095386 (Thread-1): finished collecting timing info
2022-06-05 17:12:37.155274 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:12:37.156004 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */
drop table if exists "postgres"."dbt"."source_customers" cascade
2022-06-05 17:12:37.156493 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:12:37.186836 (Thread-1): SQL status: DROP TABLE in 0.03 seconds
2022-06-05 17:12:37.199377 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-06-05 17:12:37.200761 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:12:37.202246 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: BEGIN
2022-06-05 17:12:37.203613 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:12:37.204203 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:12:37.204589 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */

    create table "postgres"."dbt"."source_customers" (id integer,first_name text,last_name text,email text)
  
2022-06-05 17:12:37.220587 (Thread-1): SQL status: CREATE TABLE in 0.02 seconds
2022-06-05 17:12:37.244731 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:12:37.245273 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: 
            insert into "postgres"."dbt"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%...
2022-06-05 17:12:37.249257 (Thread-1): SQL status: INSERT 0 102 in 0.00 seconds
2022-06-05 17:12:37.255336 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_customers"
2022-06-05 17:12:37.275998 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-05 17:12:37.276522 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:12:37.276808 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-05 17:12:37.293026 (Thread-1): SQL status: COMMIT in 0.02 seconds
2022-06-05 17:12:37.296468 (Thread-1): finished collecting timing info
2022-06-05 17:12:37.297131 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: Close
2022-06-05 17:12:37.298377 (Thread-1): 17:12:37 | 1 of 2 OK loaded seed file dbt.source_customers...................... [CREATE 102 in 0.20s]
2022-06-05 17:12:37.299021 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_customers
2022-06-05 17:12:37.300025 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_orders
2022-06-05 17:12:37.302183 (Thread-1): 17:12:37 | 2 of 2 START seed file dbt.source_orders............................. [RUN]
2022-06-05 17:12:37.303083 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:12:37.303633 (Thread-1): finished collecting timing info
2022-06-05 17:12:37.324766 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:12:37.325313 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */
drop table if exists "postgres"."dbt"."source_orders" cascade
2022-06-05 17:12:37.325982 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:12:37.335850 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-06-05 17:12:37.338220 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:12:37.338612 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: BEGIN
2022-06-05 17:12:37.339191 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:12:37.339638 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:12:37.339904 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */

    create table "postgres"."dbt"."source_orders" (id integer,user_id integer,order_date date,status text)
  
2022-06-05 17:12:37.347743 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-06-05 17:12:37.352762 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:12:37.353209 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: 
            insert into "postgres"."dbt"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s...
2022-06-05 17:12:37.356392 (Thread-1): SQL status: INSERT 0 99 in 0.00 seconds
2022-06-05 17:12:37.357584 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_orders"
2022-06-05 17:12:37.368448 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-05 17:12:37.369021 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:12:37.369390 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-05 17:12:37.372150 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:12:37.374920 (Thread-1): finished collecting timing info
2022-06-05 17:12:37.375521 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: Close
2022-06-05 17:12:37.376636 (Thread-1): 17:12:37 | 2 of 2 OK loaded seed file dbt.source_orders......................... [CREATE 99 in 0.07s]
2022-06-05 17:12:37.377287 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_orders
2022-06-05 17:12:37.380030 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:12:37.380545 (MainThread): Using postgres connection "master".
2022-06-05 17:12:37.380909 (MainThread): On master: BEGIN
2022-06-05 17:12:37.381205 (MainThread): Opening a new connection, currently in state closed
2022-06-05 17:12:37.386937 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:12:37.387464 (MainThread): On master: COMMIT
2022-06-05 17:12:37.387808 (MainThread): Using postgres connection "master".
2022-06-05 17:12:37.388069 (MainThread): On master: COMMIT
2022-06-05 17:12:37.388838 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:12:37.389527 (MainThread): On master: Close
2022-06-05 17:12:37.390485 (MainThread): 17:12:37 | 
2022-06-05 17:12:37.391138 (MainThread): 17:12:37 | Finished running 2 seeds in 0.47s.
2022-06-05 17:12:37.392107 (MainThread): Connection 'master' was properly closed.
2022-06-05 17:12:37.393206 (MainThread): Connection 'seed.jaffle_shop_dbtvault.source_orders' was properly closed.
2022-06-05 17:12:37.518092 (MainThread): 
2022-06-05 17:12:37.518898 (MainThread): Completed successfully
2022-06-05 17:12:37.519899 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-05 17:12:37.521335 (MainThread): Flushing usage events
2022-06-05 17:14:58.775328 (MainThread): Running with dbt=0.19.0
2022-06-05 17:14:58.932439 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:hub'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-05 17:14:58.936622 (MainThread): Tracking: do not track
2022-06-05 17:14:59.571834 (MainThread): Got an acceptable cached parse result
2022-06-05 17:15:00.902009 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-05 17:15:00.906134 (MainThread): 
2022-06-05 17:15:00.909847 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:15:00.914593 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-05 17:15:00.928691 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-05 17:15:00.929596 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-05 17:15:00.930065 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-05 17:15:00.942992 (ThreadPoolExecutor-0_0): SQL status: SELECT 5 in 0.01 seconds
2022-06-05 17:15:00.946630 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-05 17:15:00.962892 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-05 17:15:00.972862 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:15:00.973508 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-05 17:15:00.973944 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-05 17:15:00.985766 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:15:00.986300 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:15:00.986611 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-05 17:15:00.990081 (ThreadPoolExecutor-1_0): SQL status: SELECT 7 in 0.00 seconds
2022-06-05 17:15:00.997752 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-05 17:15:00.998573 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-05 17:15:01.017670 (MainThread): Using postgres connection "master".
2022-06-05 17:15:01.018193 (MainThread): On master: BEGIN
2022-06-05 17:15:01.018529 (MainThread): Opening a new connection, currently in state init
2022-06-05 17:15:01.027362 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:15:01.027958 (MainThread): Using postgres connection "master".
2022-06-05 17:15:01.028314 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-05 17:15:01.038211 (MainThread): SQL status: SELECT 0 in 0.01 seconds
2022-06-05 17:15:01.039082 (MainThread): On master: ROLLBACK
2022-06-05 17:15:01.039859 (MainThread): Using postgres connection "master".
2022-06-05 17:15:01.040431 (MainThread): On master: BEGIN
2022-06-05 17:15:01.041552 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:15:01.042154 (MainThread): On master: COMMIT
2022-06-05 17:15:01.042558 (MainThread): Using postgres connection "master".
2022-06-05 17:15:01.042907 (MainThread): On master: COMMIT
2022-06-05 17:15:01.043496 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:15:01.043841 (MainThread): On master: Close
2022-06-05 17:15:01.044550 (MainThread): 17:15:01 | Concurrency: 1 threads (target='dev')
2022-06-05 17:15:01.045212 (MainThread): 17:15:01 | 
2022-06-05 17:15:01.051318 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_customer
2022-06-05 17:15:01.053123 (Thread-1): 17:15:01 | 1 of 2 START incremental model dbt.hub_customer...................... [RUN]
2022-06-05 17:15:01.053821 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:15:01.054480 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_customer
2022-06-05 17:15:01.152711 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-06-05 17:15:01.164376 (Thread-1): finished collecting timing info
2022-06-05 17:15:01.221857 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:15:01.222409 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

    

  create temporary table "hub_customer__dbt_tmp171501208395"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_customers"

) as h
WHERE row_number = 1
),

row_rank_2 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

stage_union AS (
    SELECT * FROM row_rank_1
    UNION ALL
    SELECT * FROM row_rank_2
),

row_rank_union AS (

SELECT * FROM (

    SELECT *,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE, RECORD_SOURCE ASC
           ) AS row_rank_number
    FROM stage_union
    WHERE CUSTOMER_PK IS NOT NULL
) as h 
WHERE row_rank_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_union AS a
    LEFT JOIN "postgres"."dbt"."hub_customer" AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:15:01.222800 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:15:01.232419 (Thread-1): Postgres error: relation "dbt.v_stg_customers" does not exist
LINE 17:     FROM "postgres"."dbt"."v_stg_customers"
                  ^

2022-06-05 17:15:01.233249 (Thread-1): finished collecting timing info
2022-06-05 17:15:01.234206 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: Close
2022-06-05 17:15:01.235326 (Thread-1): Database Error in model hub_customer (models/raw_vault/hubs/hub_customer.sql)
  relation "dbt.v_stg_customers" does not exist
  LINE 17:     FROM "postgres"."dbt"."v_stg_customers"
                    ^
  compiled SQL at target/compiled/jaffle_shop_dbtvault/models/raw_vault/hubs/hub_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "dbt.v_stg_customers" does not exist
LINE 17:     FROM "postgres"."dbt"."v_stg_customers"
                  ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 107, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 33, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model hub_customer (models/raw_vault/hubs/hub_customer.sql)
  relation "dbt.v_stg_customers" does not exist
  LINE 17:     FROM "postgres"."dbt"."v_stg_customers"
                    ^
  compiled SQL at target/compiled/jaffle_shop_dbtvault/models/raw_vault/hubs/hub_customer.sql
2022-06-05 17:15:01.248684 (Thread-1): 17:15:01 | 1 of 2 ERROR creating incremental model dbt.hub_customer............. [ERROR in 0.19s]
2022-06-05 17:15:01.249278 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_customer
2022-06-05 17:15:01.250436 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_order
2022-06-05 17:15:01.253132 (Thread-1): 17:15:01 | 2 of 2 START incremental model dbt.hub_order......................... [RUN]
2022-06-05 17:15:01.254310 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:15:01.255641 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_order
2022-06-05 17:15:01.273557 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-06-05 17:15:01.285387 (Thread-1): finished collecting timing info
2022-06-05 17:15:01.300043 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:15:01.300573 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

    

  create temporary table "hub_order__dbt_tmp171501296912"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT ORDER_PK, ORDER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."dbt"."hub_order" AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:15:01.300890 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:15:01.306789 (Thread-1): Postgres error: relation "dbt.v_stg_orders" does not exist
LINE 17:     FROM "postgres"."dbt"."v_stg_orders"
                  ^

2022-06-05 17:15:01.308161 (Thread-1): finished collecting timing info
2022-06-05 17:15:01.309125 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: Close
2022-06-05 17:15:01.309848 (Thread-1): Database Error in model hub_order (models/raw_vault/hubs/hub_order.sql)
  relation "dbt.v_stg_orders" does not exist
  LINE 17:     FROM "postgres"."dbt"."v_stg_orders"
                    ^
  compiled SQL at target/compiled/jaffle_shop_dbtvault/models/raw_vault/hubs/hub_order.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: relation "dbt.v_stg_orders" does not exist
LINE 17:     FROM "postgres"."dbt"."v_stg_orders"
                  ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 107, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 33, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model hub_order (models/raw_vault/hubs/hub_order.sql)
  relation "dbt.v_stg_orders" does not exist
  LINE 17:     FROM "postgres"."dbt"."v_stg_orders"
                    ^
  compiled SQL at target/compiled/jaffle_shop_dbtvault/models/raw_vault/hubs/hub_order.sql
2022-06-05 17:15:01.312098 (Thread-1): 17:15:01 | 2 of 2 ERROR creating incremental model dbt.hub_order................ [ERROR in 0.06s]
2022-06-05 17:15:01.312664 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_order
2022-06-05 17:15:01.316081 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:15:01.316909 (MainThread): Using postgres connection "master".
2022-06-05 17:15:01.317750 (MainThread): On master: BEGIN
2022-06-05 17:15:01.318232 (MainThread): Opening a new connection, currently in state closed
2022-06-05 17:15:01.325649 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:15:01.326347 (MainThread): On master: COMMIT
2022-06-05 17:15:01.326712 (MainThread): Using postgres connection "master".
2022-06-05 17:15:01.327076 (MainThread): On master: COMMIT
2022-06-05 17:15:01.327761 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:15:01.328244 (MainThread): On master: Close
2022-06-05 17:15:01.329238 (MainThread): 17:15:01 | 
2022-06-05 17:15:01.329844 (MainThread): 17:15:01 | Finished running 2 incremental models in 0.42s.
2022-06-05 17:15:01.331116 (MainThread): Connection 'master' was properly closed.
2022-06-05 17:15:01.331856 (MainThread): Connection 'model.jaffle_shop_dbtvault.hub_order' was properly closed.
2022-06-05 17:15:01.462656 (MainThread): 
2022-06-05 17:15:01.463460 (MainThread): Completed with 2 errors and 0 warnings:
2022-06-05 17:15:01.464443 (MainThread): 
2022-06-05 17:15:01.465524 (MainThread): Database Error in model hub_customer (models/raw_vault/hubs/hub_customer.sql)
2022-06-05 17:15:01.466672 (MainThread):   relation "dbt.v_stg_customers" does not exist
2022-06-05 17:15:01.467531 (MainThread):   LINE 17:     FROM "postgres"."dbt"."v_stg_customers"
2022-06-05 17:15:01.468464 (MainThread):                     ^
2022-06-05 17:15:01.469766 (MainThread):   compiled SQL at target/compiled/jaffle_shop_dbtvault/models/raw_vault/hubs/hub_customer.sql
2022-06-05 17:15:01.470563 (MainThread): 
2022-06-05 17:15:01.471352 (MainThread): Database Error in model hub_order (models/raw_vault/hubs/hub_order.sql)
2022-06-05 17:15:01.472226 (MainThread):   relation "dbt.v_stg_orders" does not exist
2022-06-05 17:15:01.473109 (MainThread):   LINE 17:     FROM "postgres"."dbt"."v_stg_orders"
2022-06-05 17:15:01.473777 (MainThread):                     ^
2022-06-05 17:15:01.474559 (MainThread):   compiled SQL at target/compiled/jaffle_shop_dbtvault/models/raw_vault/hubs/hub_order.sql
2022-06-05 17:15:01.475583 (MainThread): 
Done. PASS=0 WARN=0 ERROR=2 SKIP=0 TOTAL=2
2022-06-05 17:15:01.476928 (MainThread): Flushing usage events
2022-06-05 17:25:14.949712 (MainThread): Running with dbt=0.19.0
2022-06-05 17:25:15.084057 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-05 17:25:15.088118 (MainThread): Tracking: do not track
2022-06-05 17:25:15.708758 (MainThread): Got an acceptable cached parse result
2022-06-05 17:25:17.038900 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-05 17:25:17.042262 (MainThread): 
2022-06-05 17:25:17.043530 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:25:17.049246 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-05 17:25:17.064694 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-05 17:25:17.065327 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-05 17:25:17.065664 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-05 17:25:17.073057 (ThreadPoolExecutor-0_0): SQL status: SELECT 5 in 0.01 seconds
2022-06-05 17:25:17.076466 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-05 17:25:17.094847 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-05 17:25:17.103921 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:25:17.104467 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-05 17:25:17.104934 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-05 17:25:17.111915 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:25:17.112418 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:25:17.112675 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-05 17:25:17.115537 (ThreadPoolExecutor-1_0): SQL status: SELECT 7 in 0.00 seconds
2022-06-05 17:25:17.123240 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-05 17:25:17.124126 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-05 17:25:17.145454 (MainThread): Using postgres connection "master".
2022-06-05 17:25:17.146104 (MainThread): On master: BEGIN
2022-06-05 17:25:17.146419 (MainThread): Opening a new connection, currently in state init
2022-06-05 17:25:17.152911 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:25:17.153451 (MainThread): Using postgres connection "master".
2022-06-05 17:25:17.153734 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-05 17:25:17.162372 (MainThread): SQL status: SELECT 0 in 0.01 seconds
2022-06-05 17:25:17.163187 (MainThread): On master: ROLLBACK
2022-06-05 17:25:17.163759 (MainThread): Using postgres connection "master".
2022-06-05 17:25:17.164107 (MainThread): On master: BEGIN
2022-06-05 17:25:17.164958 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:25:17.165589 (MainThread): On master: COMMIT
2022-06-05 17:25:17.165942 (MainThread): Using postgres connection "master".
2022-06-05 17:25:17.166279 (MainThread): On master: COMMIT
2022-06-05 17:25:17.166860 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:25:17.167295 (MainThread): On master: Close
2022-06-05 17:25:17.168089 (MainThread): 17:25:17 | Concurrency: 1 threads (target='dev')
2022-06-05 17:25:17.168773 (MainThread): 17:25:17 | 
2022-06-05 17:25:17.173608 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-05 17:25:17.175438 (Thread-1): 17:25:17 | 1 of 2 START view model dbt.v_stg_customers.......................... [RUN]
2022-06-05 17:25:17.176420 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.176976 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers
2022-06-05 17:25:17.256628 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.257236 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: BEGIN
2022-06-05 17:25:17.257547 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:25:17.274501 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-06-05 17:25:17.275162 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.275578 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:25:17.288573 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-05 17:25:17.336053 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.336553 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:25:17.340736 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:25:17.389506 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-05 17:25:17.400727 (Thread-1): finished collecting timing info
2022-06-05 17:25:17.436043 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.436628 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_tmp" cascade
2022-06-05 17:25:17.438334 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:25:17.443363 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.443874 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-05 17:25:17.444553 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:25:17.450459 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-05 17:25:17.460360 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.460806 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

  create view "postgres"."dbt"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."dbt"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-05 17:25:17.475429 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-05 17:25:17.484073 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.484590 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
alter table "postgres"."dbt"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-06-05 17:25:17.486912 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-05 17:25:17.495345 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-05 17:25:17.495862 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.496141 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-05 17:25:17.498310 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:25:17.503441 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:25:17.503915 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-05 17:25:17.504530 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:25:17.507712 (Thread-1): finished collecting timing info
2022-06-05 17:25:17.508428 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: Close
2022-06-05 17:25:17.511550 (Thread-1): 17:25:17 | 1 of 2 OK created view model dbt.v_stg_customers..................... [CREATE VIEW in 0.33s]
2022-06-05 17:25:17.512313 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-05 17:25:17.513039 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-05 17:25:17.515672 (Thread-1): 17:25:17 | 2 of 2 START view model dbt.v_stg_orders............................. [RUN]
2022-06-05 17:25:17.516741 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.517299 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_orders
2022-06-05 17:25:17.537104 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.537650 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: BEGIN
2022-06-05 17:25:17.537989 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:25:17.543810 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:25:17.544326 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.544601 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:25:17.553186 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-05 17:25:17.560529 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.561025 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:25:17.564580 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:25:17.571256 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-05 17:25:17.581048 (Thread-1): finished collecting timing info
2022-06-05 17:25:17.591949 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.592441 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_tmp" cascade
2022-06-05 17:25:17.593133 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:25:17.597131 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.597612 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-05 17:25:17.598262 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:25:17.599897 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-05 17:25:17.608600 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.609061 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

  create view "postgres"."dbt"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."dbt"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-05 17:25:17.615075 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-05 17:25:17.619179 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.619648 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
alter table "postgres"."dbt"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-06-05 17:25:17.620588 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-05 17:25:17.622069 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-05 17:25:17.622423 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.622673 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-05 17:25:17.624618 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:25:17.629208 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:25:17.629685 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-05 17:25:17.630368 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:25:17.633556 (Thread-1): finished collecting timing info
2022-06-05 17:25:17.634146 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: Close
2022-06-05 17:25:17.636395 (Thread-1): 17:25:17 | 2 of 2 OK created view model dbt.v_stg_orders........................ [CREATE VIEW in 0.12s]
2022-06-05 17:25:17.637046 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-05 17:25:17.639610 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:25:17.640116 (MainThread): Using postgres connection "master".
2022-06-05 17:25:17.640623 (MainThread): On master: BEGIN
2022-06-05 17:25:17.641076 (MainThread): Opening a new connection, currently in state closed
2022-06-05 17:25:17.646956 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:25:17.647501 (MainThread): On master: COMMIT
2022-06-05 17:25:17.647813 (MainThread): Using postgres connection "master".
2022-06-05 17:25:17.648103 (MainThread): On master: COMMIT
2022-06-05 17:25:17.648645 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:25:17.649009 (MainThread): On master: Close
2022-06-05 17:25:17.649685 (MainThread): 17:25:17 | 
2022-06-05 17:25:17.650339 (MainThread): 17:25:17 | Finished running 2 view models in 0.61s.
2022-06-05 17:25:17.651133 (MainThread): Connection 'master' was properly closed.
2022-06-05 17:25:17.651695 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_stg_orders' was properly closed.
2022-06-05 17:25:17.779741 (MainThread): 
2022-06-05 17:25:17.780632 (MainThread): Completed successfully
2022-06-05 17:25:17.781790 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-05 17:25:17.783040 (MainThread): Flushing usage events
2022-06-05 17:28:12.939305 (MainThread): Running with dbt=0.19.0
2022-06-05 17:28:13.069376 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:hub'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-05 17:28:13.073726 (MainThread): Tracking: do not track
2022-06-05 17:28:13.697150 (MainThread): Got an acceptable cached parse result
2022-06-05 17:28:15.191556 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-05 17:28:15.193784 (MainThread): 
2022-06-05 17:28:15.195083 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:28:15.202064 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-05 17:28:15.228291 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-05 17:28:15.228882 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-05 17:28:15.229443 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-05 17:28:15.237960 (ThreadPoolExecutor-0_0): SQL status: SELECT 5 in 0.01 seconds
2022-06-05 17:28:15.241689 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-05 17:28:15.259060 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-05 17:28:15.269275 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:28:15.269794 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-05 17:28:15.270111 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-05 17:28:15.276560 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:28:15.277122 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:28:15.277524 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-05 17:28:15.281678 (ThreadPoolExecutor-1_0): SQL status: SELECT 9 in 0.00 seconds
2022-06-05 17:28:15.290994 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-05 17:28:15.291764 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-05 17:28:15.311206 (MainThread): Using postgres connection "master".
2022-06-05 17:28:15.311770 (MainThread): On master: BEGIN
2022-06-05 17:28:15.312148 (MainThread): Opening a new connection, currently in state init
2022-06-05 17:28:15.319739 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:28:15.320296 (MainThread): Using postgres connection "master".
2022-06-05 17:28:15.320638 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-05 17:28:15.334995 (MainThread): SQL status: SELECT 2 in 0.01 seconds
2022-06-05 17:28:15.338560 (MainThread): On master: ROLLBACK
2022-06-05 17:28:15.339319 (MainThread): Using postgres connection "master".
2022-06-05 17:28:15.339713 (MainThread): On master: BEGIN
2022-06-05 17:28:15.340387 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:28:15.340782 (MainThread): On master: COMMIT
2022-06-05 17:28:15.341101 (MainThread): Using postgres connection "master".
2022-06-05 17:28:15.341372 (MainThread): On master: COMMIT
2022-06-05 17:28:15.341899 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:28:15.342272 (MainThread): On master: Close
2022-06-05 17:28:15.342927 (MainThread): 17:28:15 | Concurrency: 1 threads (target='dev')
2022-06-05 17:28:15.343448 (MainThread): 17:28:15 | 
2022-06-05 17:28:15.349011 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_customer
2022-06-05 17:28:15.351014 (Thread-1): 17:28:15 | 1 of 2 START incremental model dbt.hub_customer...................... [RUN]
2022-06-05 17:28:15.352200 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:28:15.352851 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_customer
2022-06-05 17:28:15.450871 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-06-05 17:28:15.461954 (Thread-1): finished collecting timing info
2022-06-05 17:28:15.514742 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:28:15.515313 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

    

  create temporary table "hub_customer__dbt_tmp172815503188"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_customers"

) as h
WHERE row_number = 1
),

row_rank_2 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

stage_union AS (
    SELECT * FROM row_rank_1
    UNION ALL
    SELECT * FROM row_rank_2
),

row_rank_union AS (

SELECT * FROM (

    SELECT *,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE, RECORD_SOURCE ASC
           ) AS row_rank_number
    FROM stage_union
    WHERE CUSTOMER_PK IS NOT NULL
) as h 
WHERE row_rank_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_union AS a
    LEFT JOIN "postgres"."dbt"."hub_customer" AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:28:15.515708 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:28:15.535553 (Thread-1): SQL status: SELECT 1 in 0.02 seconds
2022-06-05 17:28:15.547932 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:28:15.548475 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: BEGIN
2022-06-05 17:28:15.549253 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:28:15.549884 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:28:15.550212 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer__dbt_tmp172815503188'
        
      order by ordinal_position

  
2022-06-05 17:28:15.556893 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-05 17:28:15.566016 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:28:15.566518 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:28:15.570374 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:28:15.580282 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:28:15.580781 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:28:15.584099 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:28:15.585581 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-06-05 17:28:15.596864 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:28:15.597327 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      

    insert into "postgres"."dbt"."hub_customer" ("customer_pk", "customer_key", "load_date", "record_source")
    (
       select "customer_pk", "customer_key", "load_date", "record_source"
       from "hub_customer__dbt_tmp172815503188"
    );
  
2022-06-05 17:28:15.598395 (Thread-1): SQL status: INSERT 0 1 in 0.00 seconds
2022-06-05 17:28:15.607266 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-06-05 17:28:15.607786 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:28:15.608085 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-06-05 17:28:15.610395 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:28:15.613093 (Thread-1): finished collecting timing info
2022-06-05 17:28:15.613695 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: Close
2022-06-05 17:28:15.615957 (Thread-1): 17:28:15 | 1 of 2 OK created incremental model dbt.hub_customer................. [INSERT 0 1 in 0.26s]
2022-06-05 17:28:15.616659 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_customer
2022-06-05 17:28:15.617660 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_order
2022-06-05 17:28:15.620098 (Thread-1): 17:28:15 | 2 of 2 START incremental model dbt.hub_order......................... [RUN]
2022-06-05 17:28:15.621054 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:28:15.621674 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_order
2022-06-05 17:28:15.636161 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-06-05 17:28:15.646885 (Thread-1): finished collecting timing info
2022-06-05 17:28:15.657120 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:28:15.657635 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

    

  create temporary table "hub_order__dbt_tmp172815655103"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT ORDER_PK, ORDER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."dbt"."hub_order" AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:28:15.658000 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:28:15.674915 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-06-05 17:28:15.680312 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:28:15.680796 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: BEGIN
2022-06-05 17:28:15.681436 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:28:15.681855 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:28:15.682134 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_order__dbt_tmp172815655103'
        
      order by ordinal_position

  
2022-06-05 17:28:15.688063 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-05 17:28:15.693395 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:28:15.693975 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:28:15.697449 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:28:15.704233 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:28:15.704729 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:28:15.708146 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:28:15.709520 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-06-05 17:28:15.720055 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:28:15.720516 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      

    insert into "postgres"."dbt"."hub_order" ("order_pk", "order_key", "load_date", "record_source")
    (
       select "order_pk", "order_key", "load_date", "record_source"
       from "hub_order__dbt_tmp172815655103"
    );
  
2022-06-05 17:28:15.721543 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-05 17:28:15.723808 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-06-05 17:28:15.724391 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:28:15.724983 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-06-05 17:28:15.728076 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:28:15.730661 (Thread-1): finished collecting timing info
2022-06-05 17:28:15.731245 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: Close
2022-06-05 17:28:15.733340 (Thread-1): 17:28:15 | 2 of 2 OK created incremental model dbt.hub_order.................... [INSERT 0 0 in 0.11s]
2022-06-05 17:28:15.733956 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_order
2022-06-05 17:28:15.737218 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:28:15.737754 (MainThread): Using postgres connection "master".
2022-06-05 17:28:15.738141 (MainThread): On master: BEGIN
2022-06-05 17:28:15.738611 (MainThread): Opening a new connection, currently in state closed
2022-06-05 17:28:15.744970 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:28:15.745646 (MainThread): On master: COMMIT
2022-06-05 17:28:15.745979 (MainThread): Using postgres connection "master".
2022-06-05 17:28:15.746267 (MainThread): On master: COMMIT
2022-06-05 17:28:15.746779 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:28:15.747108 (MainThread): On master: Close
2022-06-05 17:28:15.747848 (MainThread): 17:28:15 | 
2022-06-05 17:28:15.748416 (MainThread): 17:28:15 | Finished running 2 incremental models in 0.55s.
2022-06-05 17:28:15.749973 (MainThread): Connection 'master' was properly closed.
2022-06-05 17:28:15.750710 (MainThread): Connection 'model.jaffle_shop_dbtvault.hub_order' was properly closed.
2022-06-05 17:28:15.880809 (MainThread): 
2022-06-05 17:28:15.881411 (MainThread): Completed successfully
2022-06-05 17:28:15.883617 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-05 17:28:15.885359 (MainThread): Flushing usage events
2022-06-05 17:37:56.468056 (MainThread): Running with dbt=0.19.0
2022-06-05 17:37:56.606915 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:satellite'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-05 17:37:56.611260 (MainThread): Tracking: do not track
2022-06-05 17:37:57.224648 (MainThread): Got an acceptable cached parse result
2022-06-05 17:37:58.450130 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-05 17:37:58.452512 (MainThread): 
2022-06-05 17:37:58.454447 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:37:58.459904 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-05 17:37:58.473891 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-05 17:37:58.474459 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-05 17:37:58.474896 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-05 17:37:58.481916 (ThreadPoolExecutor-0_0): SQL status: SELECT 7 in 0.01 seconds
2022-06-05 17:37:58.485012 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-05 17:37:58.500826 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-05 17:37:58.510573 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:37:58.511288 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-05 17:37:58.511994 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-05 17:37:58.517178 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:37:58.517691 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:37:58.517974 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-05 17:37:58.521397 (ThreadPoolExecutor-1_0): SQL status: SELECT 9 in 0.00 seconds
2022-06-05 17:37:58.530681 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-05 17:37:58.531488 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-05 17:37:58.550847 (MainThread): Using postgres connection "master".
2022-06-05 17:37:58.551356 (MainThread): On master: BEGIN
2022-06-05 17:37:58.551758 (MainThread): Opening a new connection, currently in state init
2022-06-05 17:37:58.557551 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:37:58.558081 (MainThread): Using postgres connection "master".
2022-06-05 17:37:58.558386 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-05 17:37:58.570611 (MainThread): SQL status: SELECT 2 in 0.01 seconds
2022-06-05 17:37:58.575550 (MainThread): On master: ROLLBACK
2022-06-05 17:37:58.576277 (MainThread): Using postgres connection "master".
2022-06-05 17:37:58.576613 (MainThread): On master: BEGIN
2022-06-05 17:37:58.577339 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:37:58.577760 (MainThread): On master: COMMIT
2022-06-05 17:37:58.578048 (MainThread): Using postgres connection "master".
2022-06-05 17:37:58.578340 (MainThread): On master: COMMIT
2022-06-05 17:37:58.578867 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:37:58.579228 (MainThread): On master: Close
2022-06-05 17:37:58.579878 (MainThread): 17:37:58 | Concurrency: 1 threads (target='dev')
2022-06-05 17:37:58.580551 (MainThread): 17:37:58 | 
2022-06-05 17:37:58.586030 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_customer_details
2022-06-05 17:37:58.587847 (Thread-1): 17:37:58 | 1 of 2 START incremental model dbt.sat_customer_details.............. [RUN]
2022-06-05 17:37:58.589248 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:37:58.589854 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_customer_details
2022-06-05 17:37:58.720756 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-06-05 17:37:58.733617 (Thread-1): finished collecting timing info
2022-06-05 17:37:58.795838 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:37:58.796453 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

    

  create temporary table "sat_customer_details__dbt_tmp173758783694"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_customers" AS a
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."sat_customer_details" as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.first_name, e.last_name, e.email, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:37:58.796780 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:37:58.813146 (Thread-1): SQL status: SELECT 1 in 0.02 seconds
2022-06-05 17:37:58.826674 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:37:58.827163 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: BEGIN
2022-06-05 17:37:58.828032 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:37:58.828529 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:37:58.828836 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details__dbt_tmp173758783694'
        
      order by ordinal_position

  
2022-06-05 17:37:58.834681 (Thread-1): SQL status: SELECT 8 in 0.01 seconds
2022-06-05 17:37:58.843309 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:37:58.843881 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:37:58.848482 (Thread-1): SQL status: SELECT 8 in 0.00 seconds
2022-06-05 17:37:58.858636 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:37:58.859161 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:37:58.862227 (Thread-1): SQL status: SELECT 8 in 0.00 seconds
2022-06-05 17:37:58.864214 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-06-05 17:37:58.875678 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:37:58.876170 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      

    insert into "postgres"."dbt"."sat_customer_details" ("customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source")
    (
       select "customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source"
       from "sat_customer_details__dbt_tmp173758783694"
    );
  
2022-06-05 17:37:58.877331 (Thread-1): SQL status: INSERT 0 1 in 0.00 seconds
2022-06-05 17:37:58.886270 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-06-05 17:37:58.886746 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:37:58.887042 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-06-05 17:37:58.889491 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:37:58.892047 (Thread-1): finished collecting timing info
2022-06-05 17:37:58.892578 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: Close
2022-06-05 17:37:58.894707 (Thread-1): 17:37:58 | 1 of 2 OK created incremental model dbt.sat_customer_details......... [INSERT 0 1 in 0.30s]
2022-06-05 17:37:58.895424 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_customer_details
2022-06-05 17:37:58.896763 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_order_details
2022-06-05 17:37:58.899221 (Thread-1): 17:37:58 | 2 of 2 START incremental model dbt.sat_order_details................. [RUN]
2022-06-05 17:37:58.900440 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:37:58.901054 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_order_details
2022-06-05 17:37:58.924660 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-06-05 17:37:58.935511 (Thread-1): finished collecting timing info
2022-06-05 17:37:58.948202 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:37:58.948894 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

    

  create temporary table "sat_order_details__dbt_tmp173758945417"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_orders" AS a
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."sat_order_details" as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.order_date, e.status, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:37:58.949708 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:37:58.961089 (Thread-1): SQL status: SELECT 0 in 0.01 seconds
2022-06-05 17:37:58.966159 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:37:58.966640 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: BEGIN
2022-06-05 17:37:58.967372 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:37:58.967824 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:37:58.968279 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details__dbt_tmp173758945417'
        
      order by ordinal_position

  
2022-06-05 17:37:58.974249 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-06-05 17:37:58.980585 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:37:58.981071 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:37:58.984254 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-06-05 17:37:58.989901 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:37:58.990398 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:37:58.993967 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-06-05 17:37:58.995548 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-06-05 17:37:59.005510 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:37:59.005985 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      

    insert into "postgres"."dbt"."sat_order_details" ("order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source")
    (
       select "order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source"
       from "sat_order_details__dbt_tmp173758945417"
    );
  
2022-06-05 17:37:59.007069 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-05 17:37:59.009801 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-06-05 17:37:59.010485 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:37:59.010927 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-06-05 17:37:59.012662 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:37:59.015303 (Thread-1): finished collecting timing info
2022-06-05 17:37:59.015921 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: Close
2022-06-05 17:37:59.018087 (Thread-1): 17:37:59 | 2 of 2 OK created incremental model dbt.sat_order_details............ [INSERT 0 0 in 0.12s]
2022-06-05 17:37:59.018907 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_order_details
2022-06-05 17:37:59.022006 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:37:59.022526 (MainThread): Using postgres connection "master".
2022-06-05 17:37:59.022854 (MainThread): On master: BEGIN
2022-06-05 17:37:59.023166 (MainThread): Opening a new connection, currently in state closed
2022-06-05 17:37:59.028485 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:37:59.029012 (MainThread): On master: COMMIT
2022-06-05 17:37:59.029331 (MainThread): Using postgres connection "master".
2022-06-05 17:37:59.029599 (MainThread): On master: COMMIT
2022-06-05 17:37:59.030150 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:37:59.030529 (MainThread): On master: Close
2022-06-05 17:37:59.031260 (MainThread): 17:37:59 | 
2022-06-05 17:37:59.031810 (MainThread): 17:37:59 | Finished running 2 incremental models in 0.58s.
2022-06-05 17:37:59.032647 (MainThread): Connection 'master' was properly closed.
2022-06-05 17:37:59.033316 (MainThread): Connection 'model.jaffle_shop_dbtvault.sat_order_details' was properly closed.
2022-06-05 17:37:59.169817 (MainThread): 
2022-06-05 17:37:59.170464 (MainThread): Completed successfully
2022-06-05 17:37:59.171518 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-05 17:37:59.172901 (MainThread): Flushing usage events
2022-06-05 17:38:12.141561 (MainThread): Running with dbt=0.19.0
2022-06-05 17:38:12.281172 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:link'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-05 17:38:12.287288 (MainThread): Tracking: do not track
2022-06-05 17:38:12.913000 (MainThread): Got an acceptable cached parse result
2022-06-05 17:38:14.206683 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-05 17:38:14.209899 (MainThread): 
2022-06-05 17:38:14.211179 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:38:14.215195 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-05 17:38:14.231870 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-05 17:38:14.232407 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-05 17:38:14.232797 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-05 17:38:14.241312 (ThreadPoolExecutor-0_0): SQL status: SELECT 7 in 0.01 seconds
2022-06-05 17:38:14.244344 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-05 17:38:14.259574 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-05 17:38:14.268454 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:38:14.268979 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-05 17:38:14.269337 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-05 17:38:14.275435 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:38:14.276133 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:38:14.276528 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-05 17:38:14.279687 (ThreadPoolExecutor-1_0): SQL status: SELECT 9 in 0.00 seconds
2022-06-05 17:38:14.288897 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-05 17:38:14.289759 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-05 17:38:14.309045 (MainThread): Using postgres connection "master".
2022-06-05 17:38:14.309579 (MainThread): On master: BEGIN
2022-06-05 17:38:14.309913 (MainThread): Opening a new connection, currently in state init
2022-06-05 17:38:14.316357 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:38:14.317056 (MainThread): Using postgres connection "master".
2022-06-05 17:38:14.317446 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-05 17:38:14.330036 (MainThread): SQL status: SELECT 2 in 0.01 seconds
2022-06-05 17:38:14.333820 (MainThread): On master: ROLLBACK
2022-06-05 17:38:14.334578 (MainThread): Using postgres connection "master".
2022-06-05 17:38:14.335080 (MainThread): On master: BEGIN
2022-06-05 17:38:14.335929 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:38:14.336434 (MainThread): On master: COMMIT
2022-06-05 17:38:14.336822 (MainThread): Using postgres connection "master".
2022-06-05 17:38:14.337184 (MainThread): On master: COMMIT
2022-06-05 17:38:14.337832 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:38:14.338266 (MainThread): On master: Close
2022-06-05 17:38:14.339079 (MainThread): 17:38:14 | Concurrency: 1 threads (target='dev')
2022-06-05 17:38:14.339866 (MainThread): 17:38:14 | 
2022-06-05 17:38:14.343780 (Thread-1): Began running node model.jaffle_shop_dbtvault.link_customer_order
2022-06-05 17:38:14.345784 (Thread-1): 17:38:14 | 1 of 1 START incremental model dbt.link_customer_order............... [RUN]
2022-06-05 17:38:14.346970 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:38:14.347493 (Thread-1): Compiling model.jaffle_shop_dbtvault.link_customer_order
2022-06-05 17:38:14.448595 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.link_customer_order"
2022-06-05 17:38:14.460632 (Thread-1): finished collecting timing info
2022-06-05 17:38:14.515809 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:38:14.516323 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

    

  create temporary table "link_customer_order__dbt_tmp173814503801"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_CUSTOMER_ORDER_PK, CUSTOMER_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_CUSTOMER_ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_CUSTOMER_ORDER_PK, a.CUSTOMER_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."dbt"."link_customer_order" AS d
    ON a.LINK_CUSTOMER_ORDER_PK = d.LINK_CUSTOMER_ORDER_PK
    WHERE d.LINK_CUSTOMER_ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:38:14.516647 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:38:14.528223 (Thread-1): SQL status: SELECT 0 in 0.01 seconds
2022-06-05 17:38:14.544588 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:38:14.545274 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: BEGIN
2022-06-05 17:38:14.546397 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:38:14.547018 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:38:14.547526 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'link_customer_order__dbt_tmp173814503801'
        
      order by ordinal_position

  
2022-06-05 17:38:14.553577 (Thread-1): SQL status: SELECT 5 in 0.01 seconds
2022-06-05 17:38:14.562299 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:38:14.562827 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'link_customer_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:38:14.566526 (Thread-1): SQL status: SELECT 5 in 0.00 seconds
2022-06-05 17:38:14.576614 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:38:14.577117 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'link_customer_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:38:14.580577 (Thread-1): SQL status: SELECT 5 in 0.00 seconds
2022-06-05 17:38:14.582224 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.link_customer_order"
2022-06-05 17:38:14.592269 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:38:14.592962 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      

    insert into "postgres"."dbt"."link_customer_order" ("link_customer_order_pk", "customer_pk", "order_pk", "load_date", "record_source")
    (
       select "link_customer_order_pk", "customer_pk", "order_pk", "load_date", "record_source"
       from "link_customer_order__dbt_tmp173814503801"
    );
  
2022-06-05 17:38:14.593995 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-05 17:38:14.602891 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: COMMIT
2022-06-05 17:38:14.603389 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:38:14.603694 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: COMMIT
2022-06-05 17:38:14.605778 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:38:14.608330 (Thread-1): finished collecting timing info
2022-06-05 17:38:14.608886 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: Close
2022-06-05 17:38:14.611041 (Thread-1): 17:38:14 | 1 of 1 OK created incremental model dbt.link_customer_order.......... [INSERT 0 0 in 0.26s]
2022-06-05 17:38:14.611663 (Thread-1): Finished running node model.jaffle_shop_dbtvault.link_customer_order
2022-06-05 17:38:14.614968 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:38:14.615512 (MainThread): Using postgres connection "master".
2022-06-05 17:38:14.615875 (MainThread): On master: BEGIN
2022-06-05 17:38:14.616268 (MainThread): Opening a new connection, currently in state closed
2022-06-05 17:38:14.622085 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:38:14.622589 (MainThread): On master: COMMIT
2022-06-05 17:38:14.622929 (MainThread): Using postgres connection "master".
2022-06-05 17:38:14.623185 (MainThread): On master: COMMIT
2022-06-05 17:38:14.623621 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:38:14.623942 (MainThread): On master: Close
2022-06-05 17:38:14.624583 (MainThread): 17:38:14 | 
2022-06-05 17:38:14.625219 (MainThread): 17:38:14 | Finished running 1 incremental model in 0.41s.
2022-06-05 17:38:14.625978 (MainThread): Connection 'master' was properly closed.
2022-06-05 17:38:14.626705 (MainThread): Connection 'model.jaffle_shop_dbtvault.link_customer_order' was properly closed.
2022-06-05 17:38:14.753665 (MainThread): 
2022-06-05 17:38:14.754359 (MainThread): Completed successfully
2022-06-05 17:38:14.755591 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2022-06-05 17:38:14.757153 (MainThread): Flushing usage events
2022-06-05 17:42:55.378358 (MainThread): Running with dbt=0.19.0
2022-06-05 17:42:55.507124 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=True, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-06-05 17:42:55.511941 (MainThread): Tracking: do not track
2022-06-05 17:42:56.125585 (MainThread): Got an acceptable cached parse result
2022-06-05 17:42:57.460086 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-05 17:42:57.462727 (MainThread): 
2022-06-05 17:42:57.465539 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:42:57.472250 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-05 17:42:57.487183 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-05 17:42:57.487743 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-05 17:42:57.488190 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-05 17:42:57.497632 (ThreadPoolExecutor-0_0): SQL status: SELECT 7 in 0.01 seconds
2022-06-05 17:42:57.500769 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-05 17:42:57.518353 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-05 17:42:57.528690 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:42:57.529313 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-05 17:42:57.529682 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-05 17:42:57.536415 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:42:57.537096 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:42:57.537453 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-05 17:42:57.540463 (ThreadPoolExecutor-1_0): SQL status: SELECT 9 in 0.00 seconds
2022-06-05 17:42:57.549725 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-05 17:42:57.550524 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-05 17:42:57.570935 (MainThread): Using postgres connection "master".
2022-06-05 17:42:57.571402 (MainThread): On master: BEGIN
2022-06-05 17:42:57.571820 (MainThread): Opening a new connection, currently in state init
2022-06-05 17:42:57.578530 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:42:57.579261 (MainThread): Using postgres connection "master".
2022-06-05 17:42:57.579695 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-05 17:42:57.592571 (MainThread): SQL status: SELECT 2 in 0.01 seconds
2022-06-05 17:42:57.597851 (MainThread): On master: ROLLBACK
2022-06-05 17:42:57.598685 (MainThread): Using postgres connection "master".
2022-06-05 17:42:57.599119 (MainThread): On master: BEGIN
2022-06-05 17:42:57.599954 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:42:57.600394 (MainThread): On master: COMMIT
2022-06-05 17:42:57.600697 (MainThread): Using postgres connection "master".
2022-06-05 17:42:57.600982 (MainThread): On master: COMMIT
2022-06-05 17:42:57.601541 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:42:57.601938 (MainThread): On master: Close
2022-06-05 17:42:57.602671 (MainThread): 17:42:57 | Concurrency: 1 threads (target='dev')
2022-06-05 17:42:57.603289 (MainThread): 17:42:57 | 
2022-06-05 17:42:57.607684 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_customers
2022-06-05 17:42:57.610065 (Thread-1): 17:42:57 | 1 of 2 START seed file dbt.source_customers.......................... [RUN]
2022-06-05 17:42:57.611113 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:42:57.611780 (Thread-1): finished collecting timing info
2022-06-05 17:42:57.666057 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:42:57.666646 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */
drop table if exists "postgres"."dbt"."source_customers" cascade
2022-06-05 17:42:57.667125 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:42:57.677496 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-06-05 17:42:57.689614 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-06-05 17:42:57.690944 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:42:57.691556 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: BEGIN
2022-06-05 17:42:57.692763 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:42:57.693246 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:42:57.693609 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */

    create table "postgres"."dbt"."source_customers" (id integer,first_name text,last_name text,email text)
  
2022-06-05 17:42:57.702703 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-06-05 17:42:57.725476 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:42:57.725967 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: 
            insert into "postgres"."dbt"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%...
2022-06-05 17:42:57.728611 (Thread-1): SQL status: INSERT 0 102 in 0.00 seconds
2022-06-05 17:42:57.734186 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_customers"
2022-06-05 17:42:57.751475 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-05 17:42:57.752032 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-05 17:42:57.752418 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-05 17:42:57.755083 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:42:57.757875 (Thread-1): finished collecting timing info
2022-06-05 17:42:57.758843 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: Close
2022-06-05 17:42:57.760072 (Thread-1): 17:42:57 | 1 of 2 OK loaded seed file dbt.source_customers...................... [CREATE 102 in 0.15s]
2022-06-05 17:42:57.760775 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_customers
2022-06-05 17:42:57.761957 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_orders
2022-06-05 17:42:57.764001 (Thread-1): 17:42:57 | 2 of 2 START seed file dbt.source_orders............................. [RUN]
2022-06-05 17:42:57.764994 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:42:57.765603 (Thread-1): finished collecting timing info
2022-06-05 17:42:57.787785 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:42:57.788362 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */
drop table if exists "postgres"."dbt"."source_orders" cascade
2022-06-05 17:42:57.788669 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:42:57.797149 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-06-05 17:42:57.799499 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:42:57.799916 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: BEGIN
2022-06-05 17:42:57.800652 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:42:57.801112 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:42:57.801395 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */

    create table "postgres"."dbt"."source_orders" (id integer,user_id integer,order_date date,status text)
  
2022-06-05 17:42:57.807672 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-06-05 17:42:57.813236 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:42:57.813721 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: 
            insert into "postgres"."dbt"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s...
2022-06-05 17:42:57.816627 (Thread-1): SQL status: INSERT 0 99 in 0.00 seconds
2022-06-05 17:42:57.817533 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_orders"
2022-06-05 17:42:57.828958 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-05 17:42:57.829562 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-05 17:42:57.830137 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-05 17:42:57.833507 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:42:57.836297 (Thread-1): finished collecting timing info
2022-06-05 17:42:57.836880 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: Close
2022-06-05 17:42:57.838293 (Thread-1): 17:42:57 | 2 of 2 OK loaded seed file dbt.source_orders......................... [CREATE 99 in 0.07s]
2022-06-05 17:42:57.839054 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_orders
2022-06-05 17:42:57.842180 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:42:57.842814 (MainThread): Using postgres connection "master".
2022-06-05 17:42:57.843221 (MainThread): On master: BEGIN
2022-06-05 17:42:57.843631 (MainThread): Opening a new connection, currently in state closed
2022-06-05 17:42:57.849324 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:42:57.849907 (MainThread): On master: COMMIT
2022-06-05 17:42:57.850240 (MainThread): Using postgres connection "master".
2022-06-05 17:42:57.850553 (MainThread): On master: COMMIT
2022-06-05 17:42:57.851180 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:42:57.851566 (MainThread): On master: Close
2022-06-05 17:42:57.852333 (MainThread): 17:42:57 | 
2022-06-05 17:42:57.853007 (MainThread): 17:42:57 | Finished running 2 seeds in 0.39s.
2022-06-05 17:42:57.854136 (MainThread): Connection 'master' was properly closed.
2022-06-05 17:42:57.854934 (MainThread): Connection 'seed.jaffle_shop_dbtvault.source_orders' was properly closed.
2022-06-05 17:42:57.995969 (MainThread): 
2022-06-05 17:42:57.996769 (MainThread): Completed successfully
2022-06-05 17:42:57.997719 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-05 17:42:57.999128 (MainThread): Flushing usage events
2022-06-05 17:43:14.402853 (MainThread): Running with dbt=0.19.0
2022-06-05 17:43:14.546766 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-05 17:43:14.550998 (MainThread): Tracking: do not track
2022-06-05 17:43:15.171300 (MainThread): Got an acceptable cached parse result
2022-06-05 17:43:16.507322 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-05 17:43:16.509556 (MainThread): 
2022-06-05 17:43:16.510717 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:43:16.517061 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-05 17:43:16.531471 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-05 17:43:16.532031 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-05 17:43:16.532418 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-05 17:43:16.539151 (ThreadPoolExecutor-0_0): SQL status: SELECT 7 in 0.01 seconds
2022-06-05 17:43:16.542536 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-05 17:43:16.561223 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-05 17:43:16.571573 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:43:16.572356 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-05 17:43:16.572726 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-05 17:43:16.588105 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-06-05 17:43:16.588655 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:43:16.588975 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-05 17:43:16.592464 (ThreadPoolExecutor-1_0): SQL status: SELECT 7 in 0.00 seconds
2022-06-05 17:43:16.599749 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-05 17:43:16.600506 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-05 17:43:16.622126 (MainThread): Using postgres connection "master".
2022-06-05 17:43:16.622618 (MainThread): On master: BEGIN
2022-06-05 17:43:16.622890 (MainThread): Opening a new connection, currently in state init
2022-06-05 17:43:16.628107 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:43:16.628644 (MainThread): Using postgres connection "master".
2022-06-05 17:43:16.628925 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-05 17:43:16.638222 (MainThread): SQL status: SELECT 0 in 0.01 seconds
2022-06-05 17:43:16.639042 (MainThread): On master: ROLLBACK
2022-06-05 17:43:16.639634 (MainThread): Using postgres connection "master".
2022-06-05 17:43:16.639973 (MainThread): On master: BEGIN
2022-06-05 17:43:16.640784 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:43:16.641282 (MainThread): On master: COMMIT
2022-06-05 17:43:16.641611 (MainThread): Using postgres connection "master".
2022-06-05 17:43:16.641884 (MainThread): On master: COMMIT
2022-06-05 17:43:16.642374 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:16.642690 (MainThread): On master: Close
2022-06-05 17:43:16.643323 (MainThread): 17:43:16 | Concurrency: 1 threads (target='dev')
2022-06-05 17:43:16.643873 (MainThread): 17:43:16 | 
2022-06-05 17:43:16.648362 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-05 17:43:16.650279 (Thread-1): 17:43:16 | 1 of 2 START view model dbt.v_stg_customers.......................... [RUN]
2022-06-05 17:43:16.651192 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.651799 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers
2022-06-05 17:43:16.734081 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.734588 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: BEGIN
2022-06-05 17:43:16.734920 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:43:16.741878 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:43:16.742451 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.742772 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:16.750105 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-05 17:43:16.802270 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.802777 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:16.806484 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:43:16.856862 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-05 17:43:16.866548 (Thread-1): finished collecting timing info
2022-06-05 17:43:16.906034 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.906591 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_tmp" cascade
2022-06-05 17:43:16.907361 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:43:16.911686 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.912181 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-05 17:43:16.912908 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:43:16.919647 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-05 17:43:16.928413 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.929002 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

  create view "postgres"."dbt"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."dbt"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-05 17:43:16.939294 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-05 17:43:16.948841 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.949400 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
alter table "postgres"."dbt"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-06-05 17:43:16.950551 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-05 17:43:16.960537 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-05 17:43:16.961059 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.961336 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-05 17:43:16.963426 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:16.969357 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-05 17:43:16.969852 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-05 17:43:16.970572 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:43:16.974129 (Thread-1): finished collecting timing info
2022-06-05 17:43:16.974772 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: Close
2022-06-05 17:43:16.977133 (Thread-1): 17:43:16 | 1 of 2 OK created view model dbt.v_stg_customers..................... [CREATE VIEW in 0.32s]
2022-06-05 17:43:16.977848 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-05 17:43:16.979097 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-05 17:43:16.981596 (Thread-1): 17:43:16 | 2 of 2 START view model dbt.v_stg_orders............................. [RUN]
2022-06-05 17:43:16.982598 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:16.983209 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_orders
2022-06-05 17:43:17.003419 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:17.004065 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: BEGIN
2022-06-05 17:43:17.004434 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:43:17.009711 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:43:17.010227 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:17.010516 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:17.017111 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-05 17:43:17.024685 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:17.025508 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:17.030050 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:43:17.036846 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-05 17:43:17.045719 (Thread-1): finished collecting timing info
2022-06-05 17:43:17.056744 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:17.057338 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_tmp" cascade
2022-06-05 17:43:17.058153 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:43:17.063323 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:17.064001 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-05 17:43:17.064949 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:43:17.067226 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-05 17:43:17.079252 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:17.079838 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

  create view "postgres"."dbt"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."dbt"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-05 17:43:17.088225 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-05 17:43:17.092377 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:17.092988 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
alter table "postgres"."dbt"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-06-05 17:43:17.094135 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-05 17:43:17.095774 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-05 17:43:17.096281 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:17.096639 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-05 17:43:17.098510 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:17.103309 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-05 17:43:17.104083 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-05 17:43:17.105241 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-05 17:43:17.108754 (Thread-1): finished collecting timing info
2022-06-05 17:43:17.109486 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: Close
2022-06-05 17:43:17.112714 (Thread-1): 17:43:17 | 2 of 2 OK created view model dbt.v_stg_orders........................ [CREATE VIEW in 0.13s]
2022-06-05 17:43:17.113374 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-05 17:43:17.116602 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:43:17.117237 (MainThread): Using postgres connection "master".
2022-06-05 17:43:17.117659 (MainThread): On master: BEGIN
2022-06-05 17:43:17.118050 (MainThread): Opening a new connection, currently in state closed
2022-06-05 17:43:17.124962 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:43:17.125536 (MainThread): On master: COMMIT
2022-06-05 17:43:17.125868 (MainThread): Using postgres connection "master".
2022-06-05 17:43:17.126151 (MainThread): On master: COMMIT
2022-06-05 17:43:17.126732 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:17.127176 (MainThread): On master: Close
2022-06-05 17:43:17.127977 (MainThread): 17:43:17 | 
2022-06-05 17:43:17.128518 (MainThread): 17:43:17 | Finished running 2 view models in 0.62s.
2022-06-05 17:43:17.129074 (MainThread): Connection 'master' was properly closed.
2022-06-05 17:43:17.129691 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_stg_orders' was properly closed.
2022-06-05 17:43:17.279271 (MainThread): 
2022-06-05 17:43:17.280072 (MainThread): Completed successfully
2022-06-05 17:43:17.281214 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-05 17:43:17.282594 (MainThread): Flushing usage events
2022-06-05 17:43:38.774771 (MainThread): Running with dbt=0.19.0
2022-06-05 17:43:38.904976 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:raw_vault'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-05 17:43:38.908929 (MainThread): Tracking: do not track
2022-06-05 17:43:39.533290 (MainThread): Got an acceptable cached parse result
2022-06-05 17:43:40.850517 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-05 17:43:40.853238 (MainThread): 
2022-06-05 17:43:40.854453 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:43:40.865555 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-05 17:43:40.879449 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-05 17:43:40.879973 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-05 17:43:40.880282 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-05 17:43:40.898297 (ThreadPoolExecutor-0_0): SQL status: SELECT 7 in 0.02 seconds
2022-06-05 17:43:40.901561 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-05 17:43:40.919325 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-05 17:43:40.927922 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:43:40.928431 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-05 17:43:40.928743 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-05 17:43:40.933867 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:43:40.934616 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-05 17:43:40.935019 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-05 17:43:40.937571 (ThreadPoolExecutor-1_0): SQL status: SELECT 9 in 0.00 seconds
2022-06-05 17:43:40.946451 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-05 17:43:40.947219 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-05 17:43:40.967887 (MainThread): Using postgres connection "master".
2022-06-05 17:43:40.968390 (MainThread): On master: BEGIN
2022-06-05 17:43:40.968743 (MainThread): Opening a new connection, currently in state init
2022-06-05 17:43:40.973859 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:43:40.974390 (MainThread): Using postgres connection "master".
2022-06-05 17:43:40.974695 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-05 17:43:40.988151 (MainThread): SQL status: SELECT 2 in 0.01 seconds
2022-06-05 17:43:40.991747 (MainThread): On master: ROLLBACK
2022-06-05 17:43:40.992486 (MainThread): Using postgres connection "master".
2022-06-05 17:43:40.992900 (MainThread): On master: BEGIN
2022-06-05 17:43:40.993665 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:43:40.994150 (MainThread): On master: COMMIT
2022-06-05 17:43:40.994463 (MainThread): Using postgres connection "master".
2022-06-05 17:43:40.994751 (MainThread): On master: COMMIT
2022-06-05 17:43:40.995370 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:40.995704 (MainThread): On master: Close
2022-06-05 17:43:40.996356 (MainThread): 17:43:40 | Concurrency: 1 threads (target='dev')
2022-06-05 17:43:40.996915 (MainThread): 17:43:40 | 
2022-06-05 17:43:41.002168 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_customer
2022-06-05 17:43:41.003904 (Thread-1): 17:43:40 | 1 of 5 START incremental model dbt.hub_customer...................... [RUN]
2022-06-05 17:43:41.004932 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:43:41.005506 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_customer
2022-06-05 17:43:41.107031 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-06-05 17:43:41.117829 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.174891 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:43:41.175469 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

    

  create temporary table "hub_customer__dbt_tmp174341161735"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_customers"

) as h
WHERE row_number = 1
),

row_rank_2 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

stage_union AS (
    SELECT * FROM row_rank_1
    UNION ALL
    SELECT * FROM row_rank_2
),

row_rank_union AS (

SELECT * FROM (

    SELECT *,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE, RECORD_SOURCE ASC
           ) AS row_rank_number
    FROM stage_union
    WHERE CUSTOMER_PK IS NOT NULL
) as h 
WHERE row_rank_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_union AS a
    LEFT JOIN "postgres"."dbt"."hub_customer" AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:43:41.175807 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:43:41.188962 (Thread-1): SQL status: SELECT 0 in 0.01 seconds
2022-06-05 17:43:41.202468 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:43:41.202990 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: BEGIN
2022-06-05 17:43:41.203902 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:43:41.204286 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:43:41.204578 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer__dbt_tmp174341161735'
        
      order by ordinal_position

  
2022-06-05 17:43:41.210501 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-05 17:43:41.219157 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:43:41.219660 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.223031 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:43:41.232975 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:43:41.233490 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.237400 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:43:41.238993 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-06-05 17:43:41.250379 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:43:41.250950 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      

    insert into "postgres"."dbt"."hub_customer" ("customer_pk", "customer_key", "load_date", "record_source")
    (
       select "customer_pk", "customer_key", "load_date", "record_source"
       from "hub_customer__dbt_tmp174341161735"
    );
  
2022-06-05 17:43:41.252150 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-05 17:43:41.263760 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-06-05 17:43:41.264298 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-05 17:43:41.264603 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-06-05 17:43:41.267297 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:41.270307 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.271086 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: Close
2022-06-05 17:43:41.273440 (Thread-1): 17:43:41 | 1 of 5 OK created incremental model dbt.hub_customer................. [INSERT 0 0 in 0.27s]
2022-06-05 17:43:41.274158 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_customer
2022-06-05 17:43:41.275298 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_order
2022-06-05 17:43:41.277938 (Thread-1): 17:43:41 | 2 of 5 START incremental model dbt.hub_order......................... [RUN]
2022-06-05 17:43:41.278836 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:43:41.279540 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_order
2022-06-05 17:43:41.294746 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-06-05 17:43:41.305163 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.315515 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:43:41.316108 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

    

  create temporary table "hub_order__dbt_tmp174341313140"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT ORDER_PK, ORDER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."dbt"."hub_order" AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:43:41.316531 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:43:41.325791 (Thread-1): SQL status: SELECT 0 in 0.01 seconds
2022-06-05 17:43:41.330655 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:43:41.331131 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: BEGIN
2022-06-05 17:43:41.331863 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:43:41.332259 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:43:41.332543 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_order__dbt_tmp174341313140'
        
      order by ordinal_position

  
2022-06-05 17:43:41.338882 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-05 17:43:41.344121 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:43:41.344709 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.348487 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:43:41.355903 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:43:41.356361 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.359192 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-05 17:43:41.360611 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-06-05 17:43:41.369905 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:43:41.370357 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      

    insert into "postgres"."dbt"."hub_order" ("order_pk", "order_key", "load_date", "record_source")
    (
       select "order_pk", "order_key", "load_date", "record_source"
       from "hub_order__dbt_tmp174341313140"
    );
  
2022-06-05 17:43:41.371263 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-05 17:43:41.373066 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-06-05 17:43:41.373887 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-05 17:43:41.374431 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-06-05 17:43:41.376264 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:41.378990 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.379571 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: Close
2022-06-05 17:43:41.381829 (Thread-1): 17:43:41 | 2 of 5 OK created incremental model dbt.hub_order.................... [INSERT 0 0 in 0.10s]
2022-06-05 17:43:41.382468 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_order
2022-06-05 17:43:41.383830 (Thread-1): Began running node model.jaffle_shop_dbtvault.link_customer_order
2022-06-05 17:43:41.386189 (Thread-1): 17:43:41 | 3 of 5 START incremental model dbt.link_customer_order............... [RUN]
2022-06-05 17:43:41.387094 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:43:41.387825 (Thread-1): Compiling model.jaffle_shop_dbtvault.link_customer_order
2022-06-05 17:43:41.428314 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.link_customer_order"
2022-06-05 17:43:41.439366 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.449528 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:43:41.450105 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

    

  create temporary table "link_customer_order__dbt_tmp174341447626"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_CUSTOMER_ORDER_PK, CUSTOMER_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_CUSTOMER_ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_CUSTOMER_ORDER_PK, a.CUSTOMER_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."dbt"."link_customer_order" AS d
    ON a.LINK_CUSTOMER_ORDER_PK = d.LINK_CUSTOMER_ORDER_PK
    WHERE d.LINK_CUSTOMER_ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:43:41.450514 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:43:41.463242 (Thread-1): SQL status: SELECT 0 in 0.01 seconds
2022-06-05 17:43:41.468399 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:43:41.468873 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: BEGIN
2022-06-05 17:43:41.469727 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:43:41.470208 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:43:41.470521 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'link_customer_order__dbt_tmp174341447626'
        
      order by ordinal_position

  
2022-06-05 17:43:41.476285 (Thread-1): SQL status: SELECT 5 in 0.01 seconds
2022-06-05 17:43:41.481859 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:43:41.482360 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'link_customer_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.485822 (Thread-1): SQL status: SELECT 5 in 0.00 seconds
2022-06-05 17:43:41.491263 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:43:41.491765 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'link_customer_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.494650 (Thread-1): SQL status: SELECT 5 in 0.00 seconds
2022-06-05 17:43:41.496274 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.link_customer_order"
2022-06-05 17:43:41.505880 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:43:41.506455 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      

    insert into "postgres"."dbt"."link_customer_order" ("link_customer_order_pk", "customer_pk", "order_pk", "load_date", "record_source")
    (
       select "link_customer_order_pk", "customer_pk", "order_pk", "load_date", "record_source"
       from "link_customer_order__dbt_tmp174341447626"
    );
  
2022-06-05 17:43:41.507472 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-05 17:43:41.510190 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: COMMIT
2022-06-05 17:43:41.510865 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-05 17:43:41.511312 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: COMMIT
2022-06-05 17:43:41.513796 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:41.516717 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.517331 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: Close
2022-06-05 17:43:41.519666 (Thread-1): 17:43:41 | 3 of 5 OK created incremental model dbt.link_customer_order.......... [INSERT 0 0 in 0.13s]
2022-06-05 17:43:41.520339 (Thread-1): Finished running node model.jaffle_shop_dbtvault.link_customer_order
2022-06-05 17:43:41.521192 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_customer_details
2022-06-05 17:43:41.523390 (Thread-1): 17:43:41 | 4 of 5 START incremental model dbt.sat_customer_details.............. [RUN]
2022-06-05 17:43:41.524332 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:43:41.525221 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_customer_details
2022-06-05 17:43:41.595245 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-06-05 17:43:41.606472 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.617954 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:43:41.618488 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

    

  create temporary table "sat_customer_details__dbt_tmp174341616142"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_customers" AS a
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."sat_customer_details" as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.first_name, e.last_name, e.email, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:43:41.618853 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:43:41.628954 (Thread-1): SQL status: SELECT 1 in 0.01 seconds
2022-06-05 17:43:41.633964 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:43:41.634443 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: BEGIN
2022-06-05 17:43:41.635288 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:43:41.635727 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:43:41.636012 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details__dbt_tmp174341616142'
        
      order by ordinal_position

  
2022-06-05 17:43:41.643112 (Thread-1): SQL status: SELECT 8 in 0.01 seconds
2022-06-05 17:43:41.648812 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:43:41.649420 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.652705 (Thread-1): SQL status: SELECT 8 in 0.00 seconds
2022-06-05 17:43:41.660242 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:43:41.660791 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.664046 (Thread-1): SQL status: SELECT 8 in 0.00 seconds
2022-06-05 17:43:41.665812 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-06-05 17:43:41.675511 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:43:41.675989 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      

    insert into "postgres"."dbt"."sat_customer_details" ("customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source")
    (
       select "customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source"
       from "sat_customer_details__dbt_tmp174341616142"
    );
  
2022-06-05 17:43:41.677052 (Thread-1): SQL status: INSERT 0 1 in 0.00 seconds
2022-06-05 17:43:41.678791 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-06-05 17:43:41.679375 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-05 17:43:41.679886 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-06-05 17:43:41.681919 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:41.684543 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.685116 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: Close
2022-06-05 17:43:41.687643 (Thread-1): 17:43:41 | 4 of 5 OK created incremental model dbt.sat_customer_details......... [INSERT 0 1 in 0.16s]
2022-06-05 17:43:41.688452 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_customer_details
2022-06-05 17:43:41.689502 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_order_details
2022-06-05 17:43:41.692244 (Thread-1): 17:43:41 | 5 of 5 START incremental model dbt.sat_order_details................. [RUN]
2022-06-05 17:43:41.693185 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:43:41.693890 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_order_details
2022-06-05 17:43:41.717498 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-06-05 17:43:41.728832 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.740989 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:43:41.741454 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

    

  create temporary table "sat_order_details__dbt_tmp174341738679"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_orders" AS a
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."sat_order_details" as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.order_date, e.status, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-05 17:43:41.741781 (Thread-1): Opening a new connection, currently in state closed
2022-06-05 17:43:41.756929 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-06-05 17:43:41.762573 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:43:41.763184 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: BEGIN
2022-06-05 17:43:41.763981 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-05 17:43:41.764503 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:43:41.764991 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details__dbt_tmp174341738679'
        
      order by ordinal_position

  
2022-06-05 17:43:41.771477 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-06-05 17:43:41.777505 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:43:41.778011 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.781372 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-06-05 17:43:41.787681 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:43:41.788318 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-05 17:43:41.791879 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-06-05 17:43:41.793533 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-06-05 17:43:41.803432 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:43:41.803897 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      

    insert into "postgres"."dbt"."sat_order_details" ("order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source")
    (
       select "order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source"
       from "sat_order_details__dbt_tmp174341738679"
    );
  
2022-06-05 17:43:41.804904 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-05 17:43:41.806809 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-06-05 17:43:41.807408 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-05 17:43:41.807870 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-06-05 17:43:41.809562 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:41.812093 (Thread-1): finished collecting timing info
2022-06-05 17:43:41.812665 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: Close
2022-06-05 17:43:41.815069 (Thread-1): 17:43:41 | 5 of 5 OK created incremental model dbt.sat_order_details............ [INSERT 0 0 in 0.12s]
2022-06-05 17:43:41.815774 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_order_details
2022-06-05 17:43:41.818873 (MainThread): Acquiring new postgres connection "master".
2022-06-05 17:43:41.819448 (MainThread): Using postgres connection "master".
2022-06-05 17:43:41.819882 (MainThread): On master: BEGIN
2022-06-05 17:43:41.820214 (MainThread): Opening a new connection, currently in state closed
2022-06-05 17:43:41.828706 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-05 17:43:41.829271 (MainThread): On master: COMMIT
2022-06-05 17:43:41.829632 (MainThread): Using postgres connection "master".
2022-06-05 17:43:41.829974 (MainThread): On master: COMMIT
2022-06-05 17:43:41.830507 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-05 17:43:41.830856 (MainThread): On master: Close
2022-06-05 17:43:41.831572 (MainThread): 17:43:41 | 
2022-06-05 17:43:41.832174 (MainThread): 17:43:41 | Finished running 5 incremental models in 0.98s.
2022-06-05 17:43:41.832998 (MainThread): Connection 'master' was properly closed.
2022-06-05 17:43:41.833802 (MainThread): Connection 'model.jaffle_shop_dbtvault.sat_order_details' was properly closed.
2022-06-05 17:43:41.963802 (MainThread): 
2022-06-05 17:43:41.964464 (MainThread): Completed successfully
2022-06-05 17:43:41.966602 (MainThread): 
Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
2022-06-05 17:43:41.967994 (MainThread): Flushing usage events
2022-06-11 15:14:44.567062 (MainThread): Running with dbt=0.19.0
2022-06-11 15:14:44.846588 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=True, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-06-11 15:14:44.890928 (MainThread): Tracking: do not track
2022-06-11 15:14:45.313515 (MainThread): For key jaffle_shop_dbtvault, hash mismatch (FileHash(name='sha256', checksum='30e76e616644f0f85f9fdbc5ceea8abf82c0835381f99a4e1e907c2233e4a58f') -> FileHash(name='sha256', checksum='4f685e0b133fd24d2d258631d2e3c20bb52319435f844b78e6f8cd7fcc2483db')), cache invalidated
2022-06-11 15:14:45.328237 (MainThread): Parsing macros/adapters.sql
2022-06-11 15:14:45.378946 (MainThread): Parsing macros/catalog.sql
2022-06-11 15:14:45.384604 (MainThread): Parsing macros/relations.sql
2022-06-11 15:14:45.388580 (MainThread): Parsing macros/materializations/snapshot_merge.sql
2022-06-11 15:14:45.404682 (MainThread): Parsing macros/core.sql
2022-06-11 15:14:45.412436 (MainThread): Parsing macros/adapters/common.sql
2022-06-11 15:14:45.466560 (MainThread): Parsing macros/etc/get_custom_schema.sql
2022-06-11 15:14:45.470434 (MainThread): Parsing macros/etc/get_custom_database.sql
2022-06-11 15:14:45.473791 (MainThread): Parsing macros/etc/datetime.sql
2022-06-11 15:14:45.486668 (MainThread): Parsing macros/etc/is_incremental.sql
2022-06-11 15:14:45.490052 (MainThread): Parsing macros/etc/query.sql
2022-06-11 15:14:45.492777 (MainThread): Parsing macros/etc/get_custom_alias.sql
2022-06-11 15:14:45.495173 (MainThread): Parsing macros/materializations/helpers.sql
2022-06-11 15:14:45.507599 (MainThread): Parsing macros/materializations/seed/seed.sql
2022-06-11 15:14:45.534906 (MainThread): Parsing macros/materializations/snapshot/snapshot_merge.sql
2022-06-11 15:14:45.538565 (MainThread): Parsing macros/materializations/snapshot/snapshot.sql
2022-06-11 15:14:45.581724 (MainThread): Parsing macros/materializations/snapshot/strategies.sql
2022-06-11 15:14:45.608177 (MainThread): Parsing macros/materializations/incremental/incremental.sql
2022-06-11 15:14:45.629581 (MainThread): Parsing macros/materializations/incremental/helpers.sql
2022-06-11 15:14:45.638758 (MainThread): Parsing macros/materializations/common/merge.sql
2022-06-11 15:14:45.687489 (MainThread): Parsing macros/materializations/view/create_or_replace_view.sql
2022-06-11 15:14:45.705931 (MainThread): Parsing macros/materializations/view/view.sql
2022-06-11 15:14:45.729201 (MainThread): Parsing macros/materializations/table/table.sql
2022-06-11 15:14:45.745932 (MainThread): Parsing macros/schema_tests/unique.sql
2022-06-11 15:14:45.749493 (MainThread): Parsing macros/schema_tests/not_null.sql
2022-06-11 15:14:45.752680 (MainThread): Parsing macros/schema_tests/relationships.sql
2022-06-11 15:14:45.756413 (MainThread): Parsing macros/schema_tests/accepted_values.sql
2022-06-11 15:14:45.875180 (MainThread): Parsing macros/internal/alias.sql
2022-06-11 15:14:45.915979 (MainThread): Parsing macros/internal/alias_all.sql
2022-06-11 15:14:45.949706 (MainThread): Parsing macros/internal/as_constant.sql
2022-06-11 15:14:45.988355 (MainThread): Parsing macros/internal/expand_column_list.sql
2022-06-11 15:14:46.029039 (MainThread): Parsing macros/internal/get_package_namespaces.sql
2022-06-11 15:14:46.059751 (MainThread): Parsing macros/internal/is_checks.sql
2022-06-11 15:14:46.099663 (MainThread): Parsing macros/internal/multikey.sql
2022-06-11 15:14:46.146229 (MainThread): Parsing macros/internal/prepend_generated_by.sql
2022-06-11 15:14:46.178667 (MainThread): Parsing macros/internal/stage_processing_macros.sql
2022-06-11 15:14:46.250460 (MainThread): Parsing macros/materialisations/period_mat_helpers.sql
2022-06-11 15:14:46.333027 (MainThread): Parsing macros/materialisations/rank_mat_helpers.sql
2022-06-11 15:14:46.372890 (MainThread): Parsing macros/materialisations/shared_helpers.sql
2022-06-11 15:14:46.406516 (MainThread): Parsing macros/materialisations/vault_insert_by_period_materialization.sql
2022-06-11 15:14:46.499511 (MainThread): Parsing macros/materialisations/vault_insert_by_rank_materialization.sql
2022-06-11 15:14:46.581457 (MainThread): Parsing macros/staging/derive_columns.sql
2022-06-11 15:14:46.634997 (MainThread): Parsing macros/staging/hash_columns.sql
2022-06-11 15:14:46.675082 (MainThread): Parsing macros/staging/rank_columns.sql
2022-06-11 15:14:46.711367 (MainThread): Parsing macros/staging/source_columns.sql
2022-06-11 15:14:46.745736 (MainThread): Parsing macros/staging/stage.sql
2022-06-11 15:14:46.809311 (MainThread): Parsing macros/supporting/hash.sql
2022-06-11 15:14:46.863965 (MainThread): Parsing macros/supporting/prefix.sql
2022-06-11 15:14:46.914315 (MainThread): Parsing macros/tables/eff_sat.sql
2022-06-11 15:14:46.976452 (MainThread): Parsing macros/tables/hub.sql
2022-06-11 15:14:47.026038 (MainThread): Parsing macros/tables/link.sql
2022-06-11 15:14:47.093516 (MainThread): Parsing macros/tables/sat.sql
2022-06-11 15:14:47.148535 (MainThread): Parsing macros/tables/t_link.sql
2022-06-11 15:14:47.371262 (MainThread): Parsing macros/cross_db_utils/concat.sql
2022-06-11 15:14:47.408173 (MainThread): Parsing macros/cross_db_utils/current_timestamp.sql
2022-06-11 15:14:47.449493 (MainThread): Parsing macros/cross_db_utils/datatypes.sql
2022-06-11 15:14:47.500826 (MainThread): Parsing macros/cross_db_utils/dateadd.sql
2022-06-11 15:14:47.540265 (MainThread): Parsing macros/cross_db_utils/datediff.sql
2022-06-11 15:14:47.600912 (MainThread): Parsing macros/cross_db_utils/date_trunc.sql
2022-06-11 15:14:47.633994 (MainThread): Parsing macros/cross_db_utils/except.sql
2022-06-11 15:14:47.665633 (MainThread): Parsing macros/cross_db_utils/hash.sql
2022-06-11 15:14:47.703341 (MainThread): Parsing macros/cross_db_utils/identifier.sql
2022-06-11 15:14:47.735944 (MainThread): Parsing macros/cross_db_utils/intersect.sql
2022-06-11 15:14:47.768766 (MainThread): Parsing macros/cross_db_utils/last_day.sql
2022-06-11 15:14:47.802113 (MainThread): Parsing macros/cross_db_utils/length.sql
2022-06-11 15:14:47.832797 (MainThread): Parsing macros/cross_db_utils/literal.sql
2022-06-11 15:14:47.861766 (MainThread): Parsing macros/cross_db_utils/position.sql
2022-06-11 15:14:47.891898 (MainThread): Parsing macros/cross_db_utils/replace.sql
2022-06-11 15:14:47.921698 (MainThread): Parsing macros/cross_db_utils/right.sql
2022-06-11 15:14:47.954710 (MainThread): Parsing macros/cross_db_utils/safe_cast.sql
2022-06-11 15:14:47.988942 (MainThread): Parsing macros/cross_db_utils/split_part.sql
2022-06-11 15:14:48.022761 (MainThread): Parsing macros/cross_db_utils/width_bucket.sql
2022-06-11 15:14:48.064114 (MainThread): Parsing macros/cross_db_utils/_get_utils_namespaces.sql
2022-06-11 15:14:48.091366 (MainThread): Parsing macros/cross_db_utils/_is_ephemeral.sql
2022-06-11 15:14:48.120152 (MainThread): Parsing macros/cross_db_utils/_is_relation.sql
2022-06-11 15:14:48.147722 (MainThread): Parsing macros/datetime/date_spine.sql
2022-06-11 15:14:48.191663 (MainThread): Parsing macros/geo/haversine_distance.sql
2022-06-11 15:14:48.222589 (MainThread): Parsing macros/logger/log_info.sql
2022-06-11 15:14:48.253005 (MainThread): Parsing macros/logger/pretty_log_format.sql
2022-06-11 15:14:48.283078 (MainThread): Parsing macros/logger/pretty_time.sql
2022-06-11 15:14:48.355703 (MainThread): Parsing macros/materializations/insert_by_period_materialization.sql
2022-06-11 15:14:48.456945 (MainThread): Parsing macros/schema_tests/at_least_one.sql
2022-06-11 15:14:48.489865 (MainThread): Parsing macros/schema_tests/cardinality_equality.sql
2022-06-11 15:14:48.524676 (MainThread): Parsing macros/schema_tests/equality.sql
2022-06-11 15:14:48.563502 (MainThread): Parsing macros/schema_tests/equal_rowcount.sql
2022-06-11 15:14:48.594100 (MainThread): Parsing macros/schema_tests/expression_is_true.sql
2022-06-11 15:14:48.625559 (MainThread): Parsing macros/schema_tests/mutually_exclusive_ranges.sql
2022-06-11 15:14:48.671377 (MainThread): Parsing macros/schema_tests/not_constant.sql
2022-06-11 15:14:48.700091 (MainThread): Parsing macros/schema_tests/recency.sql
2022-06-11 15:14:48.731882 (MainThread): Parsing macros/schema_tests/relationships_where.sql
2022-06-11 15:14:48.822775 (MainThread): Parsing macros/schema_tests/test_not_null_where.sql
2022-06-11 15:14:48.856318 (MainThread): Parsing macros/schema_tests/test_unique_where.sql
2022-06-11 15:14:48.889891 (MainThread): Parsing macros/schema_tests/unique_combination_of_columns.sql
2022-06-11 15:14:48.926678 (MainThread): Parsing macros/sql/generate_series.sql
2022-06-11 15:14:48.967565 (MainThread): Parsing macros/sql/get_column_values.sql
2022-06-11 15:14:49.007124 (MainThread): Parsing macros/sql/get_query_results_as_dict.sql
2022-06-11 15:14:49.039530 (MainThread): Parsing macros/sql/get_relations_by_pattern.sql
2022-06-11 15:14:49.073878 (MainThread): Parsing macros/sql/get_relations_by_prefix.sql
2022-06-11 15:14:49.110085 (MainThread): Parsing macros/sql/get_tables_by_pattern_sql.sql
2022-06-11 15:14:49.152449 (MainThread): Parsing macros/sql/get_tables_by_prefix_sql.sql
2022-06-11 15:14:49.181271 (MainThread): Parsing macros/sql/groupby.sql
2022-06-11 15:14:49.208561 (MainThread): Parsing macros/sql/nullcheck.sql
2022-06-11 15:14:49.239426 (MainThread): Parsing macros/sql/nullcheck_table.sql
2022-06-11 15:14:49.275788 (MainThread): Parsing macros/sql/pivot.sql
2022-06-11 15:14:49.314120 (MainThread): Parsing macros/sql/safe_add.sql
2022-06-11 15:14:49.343026 (MainThread): Parsing macros/sql/star.sql
2022-06-11 15:14:49.382859 (MainThread): Parsing macros/sql/surrogate_key.sql
2022-06-11 15:14:49.420922 (MainThread): Parsing macros/sql/union.sql
2022-06-11 15:14:49.479272 (MainThread): Parsing macros/sql/unpivot.sql
2022-06-11 15:14:49.523054 (MainThread): Parsing macros/web/get_url_host.sql
2022-06-11 15:14:49.552336 (MainThread): Parsing macros/web/get_url_parameter.sql
2022-06-11 15:14:49.581552 (MainThread): Parsing macros/web/get_url_path.sql
2022-06-11 15:14:49.666336 (MainThread): For key jaffle_shop_dbtvault, hash mismatch (FileHash(name='sha256', checksum='30e76e616644f0f85f9fdbc5ceea8abf82c0835381f99a4e1e907c2233e4a58f') -> FileHash(name='sha256', checksum='4f685e0b133fd24d2d258631d2e3c20bb52319435f844b78e6f8cd7fcc2483db')), cache invalidated
2022-06-11 15:14:49.933292 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-11 15:14:50.163956 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-11 15:14:50.231644 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-11 15:14:50.384435 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-11 15:14:50.545774 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-11 15:14:50.651040 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-11 15:14:50.935775 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-11 15:14:54.102195 (MainThread): [WARNING]: Configuration paths exist in your dbt_project.yml file which do not apply to any resources.
There are 1 unused configuration paths:
- models.jaffle_shop_dbtvault.marts

2022-06-11 15:14:54.351888 (MainThread): Found 7 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-11 15:14:54.356517 (MainThread): 
2022-06-11 15:14:54.360590 (MainThread): Acquiring new postgres connection "master".
2022-06-11 15:14:54.375801 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-11 15:14:54.405593 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-11 15:14:54.406543 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-11 15:14:54.407400 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-11 15:14:54.454339 (ThreadPoolExecutor-0_0): SQL status: SELECT 9 in 0.05 seconds
2022-06-11 15:14:54.462783 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-11 15:14:54.499279 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-11 15:14:54.526450 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-11 15:14:54.527557 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-11 15:14:54.528361 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-11 15:14:54.547277 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-06-11 15:14:54.548373 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-11 15:14:54.549381 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-11 15:14:54.569274 (ThreadPoolExecutor-1_0): SQL status: SELECT 9 in 0.02 seconds
2022-06-11 15:14:54.590619 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-11 15:14:54.592212 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-11 15:14:54.642329 (MainThread): Using postgres connection "master".
2022-06-11 15:14:54.643468 (MainThread): On master: BEGIN
2022-06-11 15:14:54.644264 (MainThread): Opening a new connection, currently in state init
2022-06-11 15:14:54.658781 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-11 15:14:54.659929 (MainThread): Using postgres connection "master".
2022-06-11 15:14:54.660813 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-11 15:14:54.711142 (MainThread): SQL status: SELECT 2 in 0.05 seconds
2022-06-11 15:14:54.721101 (MainThread): On master: ROLLBACK
2022-06-11 15:14:54.722910 (MainThread): Using postgres connection "master".
2022-06-11 15:14:54.723952 (MainThread): On master: BEGIN
2022-06-11 15:14:54.726044 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-11 15:14:54.727244 (MainThread): On master: COMMIT
2022-06-11 15:14:54.728149 (MainThread): Using postgres connection "master".
2022-06-11 15:14:54.729079 (MainThread): On master: COMMIT
2022-06-11 15:14:54.730591 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-11 15:14:54.731675 (MainThread): On master: Close
2022-06-11 15:14:54.733252 (MainThread): 15:14:54 | Concurrency: 1 threads (target='dev')
2022-06-11 15:14:54.734471 (MainThread): 15:14:54 | 
2022-06-11 15:14:54.744398 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_customers
2022-06-11 15:14:54.748901 (Thread-1): 15:14:54 | 1 of 2 START seed file dbt.source_customers.......................... [RUN]
2022-06-11 15:14:54.750463 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:14:54.751688 (Thread-1): finished collecting timing info
2022-06-11 15:14:54.843159 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:14:54.844040 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */
drop table if exists "postgres"."dbt"."source_customers" cascade
2022-06-11 15:14:54.844727 (Thread-1): Opening a new connection, currently in state closed
2022-06-11 15:14:54.875183 (Thread-1): SQL status: DROP TABLE in 0.03 seconds
2022-06-11 15:14:54.902658 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-06-11 15:14:54.904840 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:14:54.906667 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: BEGIN
2022-06-11 15:14:54.909811 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-11 15:14:54.911255 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:14:54.912477 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */

    create table "postgres"."dbt"."source_customers" (id integer,first_name text,last_name text,email text)
  
2022-06-11 15:14:54.944295 (Thread-1): SQL status: CREATE TABLE in 0.03 seconds
2022-06-11 15:14:54.992878 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:14:54.993992 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: 
            insert into "postgres"."dbt"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%...
2022-06-11 15:14:54.998920 (Thread-1): SQL status: INSERT 0 102 in 0.00 seconds
2022-06-11 15:14:55.013432 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_customers"
2022-06-11 15:14:55.060895 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-11 15:14:55.062157 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:14:55.063104 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-11 15:14:55.087479 (Thread-1): SQL status: COMMIT in 0.02 seconds
2022-06-11 15:14:55.093452 (Thread-1): finished collecting timing info
2022-06-11 15:14:55.094915 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: Close
2022-06-11 15:14:55.097578 (Thread-1): 15:14:55 | 1 of 2 OK loaded seed file dbt.source_customers...................... [CREATE 102 in 0.35s]
2022-06-11 15:14:55.098741 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_customers
2022-06-11 15:14:55.100890 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_orders
2022-06-11 15:14:55.109154 (Thread-1): 15:14:55 | 2 of 2 START seed file dbt.source_orders............................. [RUN]
2022-06-11 15:14:55.111201 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:14:55.112601 (Thread-1): finished collecting timing info
2022-06-11 15:14:55.161614 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:14:55.162762 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */
drop table if exists "postgres"."dbt"."source_orders" cascade
2022-06-11 15:14:55.163639 (Thread-1): Opening a new connection, currently in state closed
2022-06-11 15:14:55.181227 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-06-11 15:14:55.186933 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:14:55.188054 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: BEGIN
2022-06-11 15:14:55.189754 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-11 15:14:55.190807 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:14:55.191621 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */

    create table "postgres"."dbt"."source_orders" (id integer,user_id integer,order_date date,status text)
  
2022-06-11 15:14:55.238322 (Thread-1): SQL status: CREATE TABLE in 0.05 seconds
2022-06-11 15:14:55.252805 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:14:55.254030 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: 
            insert into "postgres"."dbt"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s...
2022-06-11 15:14:55.260369 (Thread-1): SQL status: INSERT 0 99 in 0.01 seconds
2022-06-11 15:14:55.262170 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_orders"
2022-06-11 15:14:55.293410 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-11 15:14:55.294801 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:14:55.295819 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-11 15:14:55.302408 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-06-11 15:14:55.308510 (Thread-1): finished collecting timing info
2022-06-11 15:14:55.310090 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: Close
2022-06-11 15:14:55.312564 (Thread-1): 15:14:55 | 2 of 2 OK loaded seed file dbt.source_orders......................... [CREATE 99 in 0.20s]
2022-06-11 15:14:55.314072 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_orders
2022-06-11 15:14:55.321384 (MainThread): Acquiring new postgres connection "master".
2022-06-11 15:14:55.323152 (MainThread): Using postgres connection "master".
2022-06-11 15:14:55.324185 (MainThread): On master: BEGIN
2022-06-11 15:14:55.325409 (MainThread): Opening a new connection, currently in state closed
2022-06-11 15:14:55.339680 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-11 15:14:55.340980 (MainThread): On master: COMMIT
2022-06-11 15:14:55.341910 (MainThread): Using postgres connection "master".
2022-06-11 15:14:55.342800 (MainThread): On master: COMMIT
2022-06-11 15:14:55.344560 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-11 15:14:55.345701 (MainThread): On master: Close
2022-06-11 15:14:55.347522 (MainThread): 15:14:55 | 
2022-06-11 15:14:55.348808 (MainThread): 15:14:55 | Finished running 2 seeds in 0.99s.
2022-06-11 15:14:55.350394 (MainThread): Connection 'master' was properly closed.
2022-06-11 15:14:55.352839 (MainThread): Connection 'seed.jaffle_shop_dbtvault.source_orders' was properly closed.
2022-06-11 15:14:55.639489 (MainThread): 
2022-06-11 15:14:55.640808 (MainThread): Completed successfully
2022-06-11 15:14:55.642175 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-11 15:14:55.644602 (MainThread): Flushing usage events
2022-06-11 15:21:35.426077 (MainThread): Running with dbt=0.19.0
2022-06-11 15:21:35.612946 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=True, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-06-11 15:21:35.619449 (MainThread): Tracking: do not track
2022-06-11 15:21:37.352826 (MainThread): Got an acceptable cached parse result
2022-06-11 15:21:37.584853 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.martscode".
2022-06-11 15:21:39.940239 (MainThread): Found 8 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-11 15:21:39.943607 (MainThread): 
2022-06-11 15:21:39.945036 (MainThread): Acquiring new postgres connection "master".
2022-06-11 15:21:39.951537 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-11 15:21:39.967901 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-11 15:21:39.968621 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-11 15:21:39.969241 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-11 15:21:39.981266 (ThreadPoolExecutor-0_0): SQL status: SELECT 9 in 0.01 seconds
2022-06-11 15:21:39.987478 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-11 15:21:40.005839 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-11 15:21:40.014266 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-11 15:21:40.015176 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-11 15:21:40.015675 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-11 15:21:40.028662 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-11 15:21:40.029518 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-11 15:21:40.030232 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-11 15:21:40.034211 (ThreadPoolExecutor-1_0): SQL status: SELECT 7 in 0.00 seconds
2022-06-11 15:21:40.049654 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-11 15:21:40.051470 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-11 15:21:40.105012 (MainThread): Using postgres connection "master".
2022-06-11 15:21:40.106343 (MainThread): On master: BEGIN
2022-06-11 15:21:40.107179 (MainThread): Opening a new connection, currently in state init
2022-06-11 15:21:40.153495 (MainThread): SQL status: BEGIN in 0.05 seconds
2022-06-11 15:21:40.154513 (MainThread): Using postgres connection "master".
2022-06-11 15:21:40.155383 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-11 15:21:40.177148 (MainThread): SQL status: SELECT 0 in 0.02 seconds
2022-06-11 15:21:40.178849 (MainThread): On master: ROLLBACK
2022-06-11 15:21:40.180615 (MainThread): Using postgres connection "master".
2022-06-11 15:21:40.181803 (MainThread): On master: BEGIN
2022-06-11 15:21:40.184144 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-11 15:21:40.185412 (MainThread): On master: COMMIT
2022-06-11 15:21:40.186381 (MainThread): Using postgres connection "master".
2022-06-11 15:21:40.187290 (MainThread): On master: COMMIT
2022-06-11 15:21:40.189261 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-11 15:21:40.190376 (MainThread): On master: Close
2022-06-11 15:21:40.192149 (MainThread): 15:21:40 | Concurrency: 1 threads (target='dev')
2022-06-11 15:21:40.193413 (MainThread): 15:21:40 | 
2022-06-11 15:21:40.205491 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_customers
2022-06-11 15:21:40.209630 (Thread-1): 15:21:40 | 1 of 2 START seed file dbt.source_customers.......................... [RUN]
2022-06-11 15:21:40.211376 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:21:40.212552 (Thread-1): finished collecting timing info
2022-06-11 15:21:40.305157 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:21:40.305976 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */
drop table if exists "postgres"."dbt"."source_customers" cascade
2022-06-11 15:21:40.306550 (Thread-1): Opening a new connection, currently in state closed
2022-06-11 15:21:40.317783 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-06-11 15:21:40.328923 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-06-11 15:21:40.330257 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:21:40.330924 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: BEGIN
2022-06-11 15:21:40.334179 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-11 15:21:40.335604 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:21:40.336870 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */

    create table "postgres"."dbt"."source_customers" (id integer,first_name text,last_name text,email text)
  
2022-06-11 15:21:40.346711 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-06-11 15:21:40.373435 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:21:40.374331 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: 
            insert into "postgres"."dbt"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%...
2022-06-11 15:21:40.377740 (Thread-1): SQL status: INSERT 0 102 in 0.00 seconds
2022-06-11 15:21:40.387874 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_customers"
2022-06-11 15:21:40.426712 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-11 15:21:40.427797 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-11 15:21:40.428558 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-11 15:21:40.432220 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-11 15:21:40.435583 (Thread-1): finished collecting timing info
2022-06-11 15:21:40.436551 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: Close
2022-06-11 15:21:40.438277 (Thread-1): 15:21:40 | 1 of 2 OK loaded seed file dbt.source_customers...................... [CREATE 102 in 0.23s]
2022-06-11 15:21:40.439527 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_customers
2022-06-11 15:21:40.441050 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_orders
2022-06-11 15:21:40.443754 (Thread-1): 15:21:40 | 2 of 2 START seed file dbt.source_orders............................. [RUN]
2022-06-11 15:21:40.445026 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:21:40.445912 (Thread-1): finished collecting timing info
2022-06-11 15:21:40.487064 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:21:40.488042 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */
drop table if exists "postgres"."dbt"."source_orders" cascade
2022-06-11 15:21:40.488754 (Thread-1): Opening a new connection, currently in state closed
2022-06-11 15:21:40.499932 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-06-11 15:21:40.503238 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:21:40.504135 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: BEGIN
2022-06-11 15:21:40.506142 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-11 15:21:40.507343 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:21:40.508430 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */

    create table "postgres"."dbt"."source_orders" (id integer,user_id integer,order_date date,status text)
  
2022-06-11 15:21:40.518238 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-06-11 15:21:40.524837 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:21:40.525699 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: 
            insert into "postgres"."dbt"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s...
2022-06-11 15:21:40.530209 (Thread-1): SQL status: INSERT 0 99 in 0.00 seconds
2022-06-11 15:21:40.532049 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_orders"
2022-06-11 15:21:40.558717 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-11 15:21:40.559904 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-11 15:21:40.560895 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-11 15:21:40.565108 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-11 15:21:40.572098 (Thread-1): finished collecting timing info
2022-06-11 15:21:40.573796 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: Close
2022-06-11 15:21:40.576528 (Thread-1): 15:21:40 | 2 of 2 OK loaded seed file dbt.source_orders......................... [CREATE 99 in 0.13s]
2022-06-11 15:21:40.577863 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_orders
2022-06-11 15:21:40.583096 (MainThread): Acquiring new postgres connection "master".
2022-06-11 15:21:40.584827 (MainThread): Using postgres connection "master".
2022-06-11 15:21:40.586295 (MainThread): On master: BEGIN
2022-06-11 15:21:40.587599 (MainThread): Opening a new connection, currently in state closed
2022-06-11 15:21:40.604915 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-06-11 15:21:40.606247 (MainThread): On master: COMMIT
2022-06-11 15:21:40.607456 (MainThread): Using postgres connection "master".
2022-06-11 15:21:40.608683 (MainThread): On master: COMMIT
2022-06-11 15:21:40.610438 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-11 15:21:40.611877 (MainThread): On master: Close
2022-06-11 15:21:40.613617 (MainThread): 15:21:40 | 
2022-06-11 15:21:40.614862 (MainThread): 15:21:40 | Finished running 2 seeds in 0.67s.
2022-06-11 15:21:40.616097 (MainThread): Connection 'master' was properly closed.
2022-06-11 15:21:40.617123 (MainThread): Connection 'seed.jaffle_shop_dbtvault.source_orders' was properly closed.
2022-06-11 15:21:40.874967 (MainThread): 
2022-06-11 15:21:40.876316 (MainThread): Completed successfully
2022-06-11 15:21:40.877481 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-11 15:21:40.879236 (MainThread): Flushing usage events
2022-06-11 15:22:39.300680 (MainThread): Running with dbt=0.19.0
2022-06-11 15:22:39.601519 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-11 15:22:39.611094 (MainThread): Tracking: do not track
2022-06-11 15:22:40.822248 (MainThread): Got an acceptable cached parse result
2022-06-11 15:22:43.063448 (MainThread): Found 8 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-11 15:22:43.071297 (MainThread): 
2022-06-11 15:22:43.073890 (MainThread): Acquiring new postgres connection "master".
2022-06-11 15:22:43.080613 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-11 15:22:43.113933 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-11 15:22:43.115074 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-11 15:22:43.116045 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-11 15:22:43.166341 (ThreadPoolExecutor-0_0): SQL status: SELECT 9 in 0.05 seconds
2022-06-11 15:22:43.173953 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-11 15:22:43.215064 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-11 15:22:43.235593 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-11 15:22:43.236653 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-11 15:22:43.237552 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-11 15:22:43.251396 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-11 15:22:43.252421 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-11 15:22:43.253146 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-11 15:22:43.259959 (ThreadPoolExecutor-1_0): SQL status: SELECT 7 in 0.01 seconds
2022-06-11 15:22:43.278072 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-11 15:22:43.279826 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-11 15:22:43.326832 (MainThread): Using postgres connection "master".
2022-06-11 15:22:43.327815 (MainThread): On master: BEGIN
2022-06-11 15:22:43.328561 (MainThread): Opening a new connection, currently in state init
2022-06-11 15:22:43.340659 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-11 15:22:43.341643 (MainThread): Using postgres connection "master".
2022-06-11 15:22:43.342311 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-11 15:22:43.358198 (MainThread): SQL status: SELECT 0 in 0.02 seconds
2022-06-11 15:22:43.359810 (MainThread): On master: ROLLBACK
2022-06-11 15:22:43.361211 (MainThread): Using postgres connection "master".
2022-06-11 15:22:43.362029 (MainThread): On master: BEGIN
2022-06-11 15:22:43.363835 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-11 15:22:43.364765 (MainThread): On master: COMMIT
2022-06-11 15:22:43.365578 (MainThread): Using postgres connection "master".
2022-06-11 15:22:43.366284 (MainThread): On master: COMMIT
2022-06-11 15:22:43.368513 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-11 15:22:43.369411 (MainThread): On master: Close
2022-06-11 15:22:43.370826 (MainThread): 15:22:43 | Concurrency: 1 threads (target='dev')
2022-06-11 15:22:43.371626 (MainThread): 15:22:43 | 
2022-06-11 15:22:43.378326 (Thread-1): Began running node model.jaffle_shop_dbtvault.martscode
2022-06-11 15:22:43.381034 (Thread-1): 15:22:43 | 1 of 1 START view model dbt.martscode................................ [RUN]
2022-06-11 15:22:43.382210 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.martscode".
2022-06-11 15:22:43.382932 (Thread-1): Compiling model.jaffle_shop_dbtvault.martscode
2022-06-11 15:22:43.440319 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.martscode"
2022-06-11 15:22:43.479379 (Thread-1): finished collecting timing info
2022-06-11 15:22:43.531367 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.martscode".
2022-06-11 15:22:43.532275 (Thread-1): On model.jaffle_shop_dbtvault.martscode: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.martscode"} */
drop view if exists "postgres"."dbt"."martscode__dbt_tmp" cascade
2022-06-11 15:22:43.533094 (Thread-1): Opening a new connection, currently in state closed
2022-06-11 15:22:43.542938 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-11 15:22:43.550832 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.martscode".
2022-06-11 15:22:43.551775 (Thread-1): On model.jaffle_shop_dbtvault.martscode: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.martscode"} */
drop view if exists "postgres"."dbt"."martscode__dbt_backup" cascade
2022-06-11 15:22:43.553105 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-11 15:22:43.566534 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.martscode"
2022-06-11 15:22:43.606988 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.martscode".
2022-06-11 15:22:43.607977 (Thread-1): On model.jaffle_shop_dbtvault.martscode: BEGIN
2022-06-11 15:22:43.609947 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-11 15:22:43.611264 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.martscode".
2022-06-11 15:22:43.612481 (Thread-1): On model.jaffle_shop_dbtvault.martscode: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.martscode"} */

  create view "postgres"."dbt"."martscode__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-11 15:22:43.628220 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-11 15:22:43.648669 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.martscode".
2022-06-11 15:22:43.649863 (Thread-1): On model.jaffle_shop_dbtvault.martscode: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.martscode"} */
alter table "postgres"."dbt"."martscode__dbt_tmp" rename to "martscode"
2022-06-11 15:22:43.652214 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-11 15:22:43.669615 (Thread-1): On model.jaffle_shop_dbtvault.martscode: COMMIT
2022-06-11 15:22:43.670829 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.martscode".
2022-06-11 15:22:43.671565 (Thread-1): On model.jaffle_shop_dbtvault.martscode: COMMIT
2022-06-11 15:22:43.674504 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-11 15:22:43.681939 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.martscode".
2022-06-11 15:22:43.683003 (Thread-1): On model.jaffle_shop_dbtvault.martscode: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.martscode"} */
drop view if exists "postgres"."dbt"."martscode__dbt_backup" cascade
2022-06-11 15:22:43.684767 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-11 15:22:43.691035 (Thread-1): finished collecting timing info
2022-06-11 15:22:43.692467 (Thread-1): On model.jaffle_shop_dbtvault.martscode: Close
2022-06-11 15:22:43.696884 (Thread-1): 15:22:43 | 1 of 1 OK created view model dbt.martscode........................... [CREATE VIEW in 0.31s]
2022-06-11 15:22:43.698070 (Thread-1): Finished running node model.jaffle_shop_dbtvault.martscode
2022-06-11 15:22:43.702857 (MainThread): Acquiring new postgres connection "master".
2022-06-11 15:22:43.703917 (MainThread): Using postgres connection "master".
2022-06-11 15:22:43.704682 (MainThread): On master: BEGIN
2022-06-11 15:22:43.705719 (MainThread): Opening a new connection, currently in state closed
2022-06-11 15:22:43.718212 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-11 15:22:43.719246 (MainThread): On master: COMMIT
2022-06-11 15:22:43.720004 (MainThread): Using postgres connection "master".
2022-06-11 15:22:43.720726 (MainThread): On master: COMMIT
2022-06-11 15:22:43.722024 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-11 15:22:43.722862 (MainThread): On master: Close
2022-06-11 15:22:43.724167 (MainThread): 15:22:43 | 
2022-06-11 15:22:43.725187 (MainThread): 15:22:43 | Finished running 1 view model in 0.65s.
2022-06-11 15:22:43.726260 (MainThread): Connection 'master' was properly closed.
2022-06-11 15:22:43.727467 (MainThread): Connection 'model.jaffle_shop_dbtvault.martscode' was properly closed.
2022-06-11 15:22:43.966105 (MainThread): 
2022-06-11 15:22:43.967420 (MainThread): Completed successfully
2022-06-11 15:22:43.968679 (MainThread): 
Done. PASS=1 WARN=0 ERROR=0 SKIP=0 TOTAL=1
2022-06-11 15:22:43.972060 (MainThread): Flushing usage events
2022-06-12 17:25:38.870282 (MainThread): Running with dbt=0.19.0
2022-06-12 17:25:39.257920 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=True, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-06-12 17:25:39.269704 (MainThread): Tracking: do not track
2022-06-12 17:25:41.406893 (MainThread): Got an acceptable cached parse result
2022-06-12 17:25:43.715424 (MainThread): Found 8 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-12 17:25:43.720614 (MainThread): 
2022-06-12 17:25:43.722694 (MainThread): Acquiring new postgres connection "master".
2022-06-12 17:25:43.729650 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-12 17:25:43.745679 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-12 17:25:43.746188 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-12 17:25:43.746573 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-12 17:25:43.785062 (ThreadPoolExecutor-0_0): SQL status: SELECT 9 in 0.04 seconds
2022-06-12 17:25:43.792458 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-12 17:25:43.822843 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-12 17:25:43.838166 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-12 17:25:43.838839 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-12 17:25:43.839553 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-12 17:25:43.850027 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:25:43.850705 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-12 17:25:43.851134 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-12 17:25:43.862061 (ThreadPoolExecutor-1_0): SQL status: SELECT 8 in 0.01 seconds
2022-06-12 17:25:43.872166 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-12 17:25:43.873095 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-12 17:25:43.899595 (MainThread): Using postgres connection "master".
2022-06-12 17:25:43.900426 (MainThread): On master: BEGIN
2022-06-12 17:25:43.901064 (MainThread): Opening a new connection, currently in state init
2022-06-12 17:25:43.911407 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:25:43.912007 (MainThread): Using postgres connection "master".
2022-06-12 17:25:43.912375 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-12 17:25:43.933123 (MainThread): SQL status: SELECT 1 in 0.02 seconds
2022-06-12 17:25:43.936040 (MainThread): On master: ROLLBACK
2022-06-12 17:25:43.936881 (MainThread): Using postgres connection "master".
2022-06-12 17:25:43.937268 (MainThread): On master: BEGIN
2022-06-12 17:25:43.938182 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:25:43.938815 (MainThread): On master: COMMIT
2022-06-12 17:25:43.939252 (MainThread): Using postgres connection "master".
2022-06-12 17:25:43.939685 (MainThread): On master: COMMIT
2022-06-12 17:25:43.940518 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:25:43.941025 (MainThread): On master: Close
2022-06-12 17:25:43.941778 (MainThread): 17:25:43 | Concurrency: 1 threads (target='dev')
2022-06-12 17:25:43.942308 (MainThread): 17:25:43 | 
2022-06-12 17:25:43.948581 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_customers
2022-06-12 17:25:43.950823 (Thread-1): 17:25:43 | 1 of 2 START seed file dbt.source_customers.......................... [RUN]
2022-06-12 17:25:43.951661 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-12 17:25:43.952362 (Thread-1): finished collecting timing info
2022-06-12 17:25:44.010985 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-12 17:25:44.011493 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */
drop table if exists "postgres"."dbt"."source_customers" cascade
2022-06-12 17:25:44.011920 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 17:25:44.030755 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-06-12 17:25:44.043948 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-06-12 17:25:44.044904 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-12 17:25:44.045471 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: BEGIN
2022-06-12 17:25:44.046602 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:25:44.047230 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-12 17:25:44.047736 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */

    create table "postgres"."dbt"."source_customers" (id integer,first_name text,last_name text,email text)
  
2022-06-12 17:25:44.060137 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-06-12 17:25:44.082481 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-12 17:25:44.083005 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: 
            insert into "postgres"."dbt"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%...
2022-06-12 17:25:44.086711 (Thread-1): SQL status: INSERT 0 102 in 0.00 seconds
2022-06-12 17:25:44.094747 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_customers"
2022-06-12 17:25:44.116934 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-12 17:25:44.117528 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-12 17:25:44.118185 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-12 17:25:44.134601 (Thread-1): SQL status: COMMIT in 0.02 seconds
2022-06-12 17:25:44.139517 (Thread-1): finished collecting timing info
2022-06-12 17:25:44.140543 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: Close
2022-06-12 17:25:44.143063 (Thread-1): 17:25:44 | 1 of 2 OK loaded seed file dbt.source_customers...................... [CREATE 102 in 0.19s]
2022-06-12 17:25:44.144144 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_customers
2022-06-12 17:25:44.145175 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_orders
2022-06-12 17:25:44.150371 (Thread-1): 17:25:44 | 2 of 2 START seed file dbt.source_orders............................. [RUN]
2022-06-12 17:25:44.151580 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-12 17:25:44.152498 (Thread-1): finished collecting timing info
2022-06-12 17:25:44.178317 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-12 17:25:44.178810 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */
drop table if exists "postgres"."dbt"."source_orders" cascade
2022-06-12 17:25:44.179437 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 17:25:44.189818 (Thread-1): SQL status: DROP TABLE in 0.01 seconds
2022-06-12 17:25:44.193321 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-12 17:25:44.194007 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: BEGIN
2022-06-12 17:25:44.194999 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:25:44.195723 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-12 17:25:44.196299 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */

    create table "postgres"."dbt"."source_orders" (id integer,user_id integer,order_date date,status text)
  
2022-06-12 17:25:44.203256 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-06-12 17:25:44.209694 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-12 17:25:44.210225 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: 
            insert into "postgres"."dbt"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s...
2022-06-12 17:25:44.213442 (Thread-1): SQL status: INSERT 0 99 in 0.00 seconds
2022-06-12 17:25:44.214674 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_orders"
2022-06-12 17:25:44.227989 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-12 17:25:44.228555 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-12 17:25:44.228978 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-12 17:25:44.231938 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:25:44.235334 (Thread-1): finished collecting timing info
2022-06-12 17:25:44.236200 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: Close
2022-06-12 17:25:44.237884 (Thread-1): 17:25:44 | 2 of 2 OK loaded seed file dbt.source_orders......................... [CREATE 99 in 0.09s]
2022-06-12 17:25:44.238951 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_orders
2022-06-12 17:25:44.241462 (MainThread): Acquiring new postgres connection "master".
2022-06-12 17:25:44.242059 (MainThread): Using postgres connection "master".
2022-06-12 17:25:44.242670 (MainThread): On master: BEGIN
2022-06-12 17:25:44.243490 (MainThread): Opening a new connection, currently in state closed
2022-06-12 17:25:44.252043 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:25:44.252697 (MainThread): On master: COMMIT
2022-06-12 17:25:44.253142 (MainThread): Using postgres connection "master".
2022-06-12 17:25:44.253531 (MainThread): On master: COMMIT
2022-06-12 17:25:44.254248 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:25:44.254778 (MainThread): On master: Close
2022-06-12 17:25:44.255680 (MainThread): 17:25:44 | 
2022-06-12 17:25:44.256451 (MainThread): 17:25:44 | Finished running 2 seeds in 0.53s.
2022-06-12 17:25:44.257411 (MainThread): Connection 'master' was properly closed.
2022-06-12 17:25:44.258472 (MainThread): Connection 'seed.jaffle_shop_dbtvault.source_orders' was properly closed.
2022-06-12 17:25:44.408817 (MainThread): 
2022-06-12 17:25:44.409550 (MainThread): Completed successfully
2022-06-12 17:25:44.410439 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-12 17:25:44.411942 (MainThread): Flushing usage events
2022-06-12 17:26:28.703962 (MainThread): Running with dbt=0.19.0
2022-06-12 17:26:28.840865 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-12 17:26:28.845440 (MainThread): Tracking: do not track
2022-06-12 17:26:29.553866 (MainThread): Got an acceptable cached parse result
2022-06-12 17:26:30.952984 (MainThread): Found 8 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-12 17:26:30.956488 (MainThread): 
2022-06-12 17:26:30.960346 (MainThread): Acquiring new postgres connection "master".
2022-06-12 17:26:30.966554 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-12 17:26:30.983224 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-12 17:26:30.983768 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-12 17:26:30.984155 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-12 17:26:30.999064 (ThreadPoolExecutor-0_0): SQL status: SELECT 9 in 0.01 seconds
2022-06-12 17:26:31.002224 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-12 17:26:31.023898 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-12 17:26:31.033563 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-12 17:26:31.034182 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-12 17:26:31.034548 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-12 17:26:31.045436 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:26:31.045935 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-12 17:26:31.046210 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-12 17:26:31.048951 (ThreadPoolExecutor-1_0): SQL status: SELECT 8 in 0.00 seconds
2022-06-12 17:26:31.056908 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-12 17:26:31.057727 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-12 17:26:31.079133 (MainThread): Using postgres connection "master".
2022-06-12 17:26:31.079646 (MainThread): On master: BEGIN
2022-06-12 17:26:31.079961 (MainThread): Opening a new connection, currently in state init
2022-06-12 17:26:31.090252 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:26:31.091327 (MainThread): Using postgres connection "master".
2022-06-12 17:26:31.091798 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-12 17:26:31.102772 (MainThread): SQL status: SELECT 1 in 0.01 seconds
2022-06-12 17:26:31.105825 (MainThread): On master: ROLLBACK
2022-06-12 17:26:31.106685 (MainThread): Using postgres connection "master".
2022-06-12 17:26:31.107182 (MainThread): On master: BEGIN
2022-06-12 17:26:31.108149 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:26:31.108621 (MainThread): On master: COMMIT
2022-06-12 17:26:31.108925 (MainThread): Using postgres connection "master".
2022-06-12 17:26:31.109199 (MainThread): On master: COMMIT
2022-06-12 17:26:31.109699 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:26:31.110072 (MainThread): On master: Close
2022-06-12 17:26:31.110945 (MainThread): 17:26:31 | Concurrency: 1 threads (target='dev')
2022-06-12 17:26:31.111580 (MainThread): 17:26:31 | 
2022-06-12 17:26:31.123621 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-12 17:26:31.126449 (Thread-1): 17:26:31 | 1 of 2 START view model dbt.v_stg_customers.......................... [RUN]
2022-06-12 17:26:31.127747 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.128718 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers
2022-06-12 17:26:31.257958 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.258707 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: BEGIN
2022-06-12 17:26:31.260484 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 17:26:31.269206 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:26:31.269720 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.270050 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:26:31.295208 (Thread-1): SQL status: SELECT 4 in 0.02 seconds
2022-06-12 17:26:31.344530 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.345139 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:26:31.349349 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-12 17:26:31.404101 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-12 17:26:31.418126 (Thread-1): finished collecting timing info
2022-06-12 17:26:31.453837 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.454409 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_tmp" cascade
2022-06-12 17:26:31.455556 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 17:26:31.461027 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.461517 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-12 17:26:31.462191 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 17:26:31.468096 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-12 17:26:31.478219 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.478938 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

  create view "postgres"."dbt"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."dbt"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-12 17:26:31.490422 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-12 17:26:31.498820 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.499344 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
alter table "postgres"."dbt"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-06-12 17:26:31.500895 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-12 17:26:31.510016 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-12 17:26:31.510534 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.510814 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-12 17:26:31.513028 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:26:31.519567 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-12 17:26:31.520105 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-12 17:26:31.520845 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 17:26:31.524463 (Thread-1): finished collecting timing info
2022-06-12 17:26:31.525065 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: Close
2022-06-12 17:26:31.527374 (Thread-1): 17:26:31 | 1 of 2 OK created view model dbt.v_stg_customers..................... [CREATE VIEW in 0.40s]
2022-06-12 17:26:31.527993 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-12 17:26:31.528698 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-12 17:26:31.530792 (Thread-1): 17:26:31 | 2 of 2 START view model dbt.v_stg_orders............................. [RUN]
2022-06-12 17:26:31.531749 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.532546 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_orders
2022-06-12 17:26:31.552168 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.552978 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: BEGIN
2022-06-12 17:26:31.553658 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 17:26:31.558835 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:26:31.559342 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.559630 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:26:31.566240 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-12 17:26:31.573379 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.573988 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:26:31.577552 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-12 17:26:31.584968 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-12 17:26:31.595230 (Thread-1): finished collecting timing info
2022-06-12 17:26:31.610329 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.610808 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_tmp" cascade
2022-06-12 17:26:31.611593 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 17:26:31.615258 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.615798 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-12 17:26:31.616483 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 17:26:31.618329 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-12 17:26:31.627362 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.627847 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

  create view "postgres"."dbt"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."dbt"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-12 17:26:31.633612 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-12 17:26:31.640096 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.640627 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
alter table "postgres"."dbt"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-06-12 17:26:31.641623 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-12 17:26:31.643155 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-12 17:26:31.643599 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.643860 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-12 17:26:31.645520 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:26:31.648797 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-12 17:26:31.649242 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-12 17:26:31.649935 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 17:26:31.653001 (Thread-1): finished collecting timing info
2022-06-12 17:26:31.653657 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: Close
2022-06-12 17:26:31.655967 (Thread-1): 17:26:31 | 2 of 2 OK created view model dbt.v_stg_orders........................ [CREATE VIEW in 0.12s]
2022-06-12 17:26:31.656552 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-12 17:26:31.659035 (MainThread): Acquiring new postgres connection "master".
2022-06-12 17:26:31.659573 (MainThread): Using postgres connection "master".
2022-06-12 17:26:31.659878 (MainThread): On master: BEGIN
2022-06-12 17:26:31.660298 (MainThread): Opening a new connection, currently in state closed
2022-06-12 17:26:31.666008 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:26:31.666541 (MainThread): On master: COMMIT
2022-06-12 17:26:31.666849 (MainThread): Using postgres connection "master".
2022-06-12 17:26:31.667101 (MainThread): On master: COMMIT
2022-06-12 17:26:31.667683 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:26:31.668071 (MainThread): On master: Close
2022-06-12 17:26:31.669013 (MainThread): 17:26:31 | 
2022-06-12 17:26:31.669748 (MainThread): 17:26:31 | Finished running 2 view models in 0.71s.
2022-06-12 17:26:31.670733 (MainThread): Connection 'master' was properly closed.
2022-06-12 17:26:31.671721 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_stg_orders' was properly closed.
2022-06-12 17:26:31.804267 (MainThread): 
2022-06-12 17:26:31.805099 (MainThread): Completed successfully
2022-06-12 17:26:31.805861 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-12 17:26:31.807672 (MainThread): Flushing usage events
2022-06-12 17:27:07.060818 (MainThread): Running with dbt=0.19.0
2022-06-12 17:27:07.194254 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:raw_vault'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-12 17:27:07.198977 (MainThread): Tracking: do not track
2022-06-12 17:27:07.838123 (MainThread): Got an acceptable cached parse result
2022-06-12 17:27:09.265257 (MainThread): Found 8 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-12 17:27:09.267852 (MainThread): 
2022-06-12 17:27:09.269014 (MainThread): Acquiring new postgres connection "master".
2022-06-12 17:27:09.288671 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-12 17:27:09.303369 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-12 17:27:09.303986 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-12 17:27:09.304384 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-12 17:27:09.313652 (ThreadPoolExecutor-0_0): SQL status: SELECT 9 in 0.01 seconds
2022-06-12 17:27:09.318411 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-12 17:27:09.335997 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-12 17:27:09.346376 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-12 17:27:09.346899 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-12 17:27:09.347269 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-12 17:27:09.354727 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:27:09.355257 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-12 17:27:09.355541 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-12 17:27:09.359314 (ThreadPoolExecutor-1_0): SQL status: SELECT 10 in 0.00 seconds
2022-06-12 17:27:09.369578 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-12 17:27:09.370445 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-12 17:27:09.391419 (MainThread): Using postgres connection "master".
2022-06-12 17:27:09.391927 (MainThread): On master: BEGIN
2022-06-12 17:27:09.392234 (MainThread): Opening a new connection, currently in state init
2022-06-12 17:27:09.398195 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:27:09.398694 (MainThread): Using postgres connection "master".
2022-06-12 17:27:09.399005 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-12 17:27:09.413393 (MainThread): SQL status: SELECT 3 in 0.01 seconds
2022-06-12 17:27:09.420063 (MainThread): On master: ROLLBACK
2022-06-12 17:27:09.420877 (MainThread): Using postgres connection "master".
2022-06-12 17:27:09.421241 (MainThread): On master: BEGIN
2022-06-12 17:27:09.421998 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:27:09.422429 (MainThread): On master: COMMIT
2022-06-12 17:27:09.422708 (MainThread): Using postgres connection "master".
2022-06-12 17:27:09.422957 (MainThread): On master: COMMIT
2022-06-12 17:27:09.423456 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:27:09.423773 (MainThread): On master: Close
2022-06-12 17:27:09.424437 (MainThread): 17:27:09 | Concurrency: 1 threads (target='dev')
2022-06-12 17:27:09.424953 (MainThread): 17:27:09 | 
2022-06-12 17:27:09.432396 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_customer
2022-06-12 17:27:09.434835 (Thread-1): 17:27:09 | 1 of 5 START incremental model dbt.hub_customer...................... [RUN]
2022-06-12 17:27:09.436034 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-12 17:27:09.436991 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_customer
2022-06-12 17:27:09.536592 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-06-12 17:27:09.549315 (Thread-1): finished collecting timing info
2022-06-12 17:27:09.605926 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-12 17:27:09.606456 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

    

  create temporary table "hub_customer__dbt_tmp172709595711"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_customers"

) as h
WHERE row_number = 1
),

row_rank_2 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

stage_union AS (
    SELECT * FROM row_rank_1
    UNION ALL
    SELECT * FROM row_rank_2
),

row_rank_union AS (

SELECT * FROM (

    SELECT *,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE, RECORD_SOURCE ASC
           ) AS row_rank_number
    FROM stage_union
    WHERE CUSTOMER_PK IS NOT NULL
) as h 
WHERE row_rank_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_union AS a
    LEFT JOIN "postgres"."dbt"."hub_customer" AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-12 17:27:09.606883 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 17:27:09.647220 (Thread-1): SQL status: SELECT 0 in 0.04 seconds
2022-06-12 17:27:09.661643 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-12 17:27:09.662159 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: BEGIN
2022-06-12 17:27:09.662839 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:27:09.663385 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-12 17:27:09.663724 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer__dbt_tmp172709595711'
        
      order by ordinal_position

  
2022-06-12 17:27:09.669881 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-12 17:27:09.678674 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-12 17:27:09.679321 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:09.683279 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-12 17:27:09.694105 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-12 17:27:09.694699 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:09.697702 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-12 17:27:09.699450 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-06-12 17:27:09.711043 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-12 17:27:09.711479 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      

    insert into "postgres"."dbt"."hub_customer" ("customer_pk", "customer_key", "load_date", "record_source")
    (
       select "customer_pk", "customer_key", "load_date", "record_source"
       from "hub_customer__dbt_tmp172709595711"
    );
  
2022-06-12 17:27:09.712399 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-12 17:27:09.721417 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-06-12 17:27:09.721928 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-12 17:27:09.722225 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-06-12 17:27:09.724819 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:27:09.727638 (Thread-1): finished collecting timing info
2022-06-12 17:27:09.728275 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: Close
2022-06-12 17:27:09.730336 (Thread-1): 17:27:09 | 1 of 5 OK created incremental model dbt.hub_customer................. [INSERT 0 0 in 0.29s]
2022-06-12 17:27:09.731041 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_customer
2022-06-12 17:27:09.731904 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_order
2022-06-12 17:27:09.734568 (Thread-1): 17:27:09 | 2 of 5 START incremental model dbt.hub_order......................... [RUN]
2022-06-12 17:27:09.735621 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-12 17:27:09.736193 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_order
2022-06-12 17:27:09.751237 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-06-12 17:27:09.763349 (Thread-1): finished collecting timing info
2022-06-12 17:27:09.775197 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-12 17:27:09.775765 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

    

  create temporary table "hub_order__dbt_tmp172709772782"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT ORDER_PK, ORDER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."dbt"."hub_order" AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-12 17:27:09.776145 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 17:27:09.790393 (Thread-1): SQL status: SELECT 0 in 0.01 seconds
2022-06-12 17:27:09.795528 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-12 17:27:09.796078 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: BEGIN
2022-06-12 17:27:09.796869 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:27:09.797453 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-12 17:27:09.797768 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_order__dbt_tmp172709772782'
        
      order by ordinal_position

  
2022-06-12 17:27:09.804214 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-12 17:27:09.811059 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-12 17:27:09.811559 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:09.814773 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-12 17:27:09.821894 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-12 17:27:09.822405 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:09.826066 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-12 17:27:09.827815 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-06-12 17:27:09.838959 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-12 17:27:09.839413 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      

    insert into "postgres"."dbt"."hub_order" ("order_pk", "order_key", "load_date", "record_source")
    (
       select "order_pk", "order_key", "load_date", "record_source"
       from "hub_order__dbt_tmp172709772782"
    );
  
2022-06-12 17:27:09.840503 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-12 17:27:09.842568 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-06-12 17:27:09.843255 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-12 17:27:09.843702 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-06-12 17:27:09.845730 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:27:09.848601 (Thread-1): finished collecting timing info
2022-06-12 17:27:09.849202 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: Close
2022-06-12 17:27:09.851593 (Thread-1): 17:27:09 | 2 of 5 OK created incremental model dbt.hub_order.................... [INSERT 0 0 in 0.11s]
2022-06-12 17:27:09.852379 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_order
2022-06-12 17:27:09.853448 (Thread-1): Began running node model.jaffle_shop_dbtvault.link_customer_order
2022-06-12 17:27:09.856566 (Thread-1): 17:27:09 | 3 of 5 START incremental model dbt.link_customer_order............... [RUN]
2022-06-12 17:27:09.857703 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-12 17:27:09.858354 (Thread-1): Compiling model.jaffle_shop_dbtvault.link_customer_order
2022-06-12 17:27:09.900484 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.link_customer_order"
2022-06-12 17:27:09.913703 (Thread-1): finished collecting timing info
2022-06-12 17:27:09.925837 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-12 17:27:09.926432 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

    

  create temporary table "link_customer_order__dbt_tmp172709923695"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (
   
SELECT * FROM (
    SELECT LINK_CUSTOMER_ORDER_PK, CUSTOMER_PK, ORDER_PK, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY LINK_CUSTOMER_ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as l
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.LINK_CUSTOMER_ORDER_PK, a.CUSTOMER_PK, a.ORDER_PK, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."dbt"."link_customer_order" AS d
    ON a.LINK_CUSTOMER_ORDER_PK = d.LINK_CUSTOMER_ORDER_PK
    WHERE d.LINK_CUSTOMER_ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-12 17:27:09.926891 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 17:27:09.939847 (Thread-1): SQL status: SELECT 0 in 0.01 seconds
2022-06-12 17:27:09.945282 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-12 17:27:09.945827 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: BEGIN
2022-06-12 17:27:09.946642 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:27:09.947075 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-12 17:27:09.947419 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'link_customer_order__dbt_tmp172709923695'
        
      order by ordinal_position

  
2022-06-12 17:27:09.953722 (Thread-1): SQL status: SELECT 5 in 0.01 seconds
2022-06-12 17:27:09.959777 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-12 17:27:09.960270 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'link_customer_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:09.963771 (Thread-1): SQL status: SELECT 5 in 0.00 seconds
2022-06-12 17:27:09.969557 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-12 17:27:09.970024 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'link_customer_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:09.973336 (Thread-1): SQL status: SELECT 5 in 0.00 seconds
2022-06-12 17:27:09.975569 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.link_customer_order"
2022-06-12 17:27:09.986856 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-12 17:27:09.987460 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.link_customer_order"} */

      

    insert into "postgres"."dbt"."link_customer_order" ("link_customer_order_pk", "customer_pk", "order_pk", "load_date", "record_source")
    (
       select "link_customer_order_pk", "customer_pk", "order_pk", "load_date", "record_source"
       from "link_customer_order__dbt_tmp172709923695"
    );
  
2022-06-12 17:27:09.988579 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-12 17:27:09.990766 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: COMMIT
2022-06-12 17:27:09.991318 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.link_customer_order".
2022-06-12 17:27:09.991682 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: COMMIT
2022-06-12 17:27:09.993615 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:27:09.996315 (Thread-1): finished collecting timing info
2022-06-12 17:27:09.996897 (Thread-1): On model.jaffle_shop_dbtvault.link_customer_order: Close
2022-06-12 17:27:09.999371 (Thread-1): 17:27:09 | 3 of 5 OK created incremental model dbt.link_customer_order.......... [INSERT 0 0 in 0.14s]
2022-06-12 17:27:10.000138 (Thread-1): Finished running node model.jaffle_shop_dbtvault.link_customer_order
2022-06-12 17:27:10.001083 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_customer_details
2022-06-12 17:27:10.003678 (Thread-1): 17:27:09 | 4 of 5 START incremental model dbt.sat_customer_details.............. [RUN]
2022-06-12 17:27:10.004700 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-12 17:27:10.005529 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_customer_details
2022-06-12 17:27:10.071543 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-06-12 17:27:10.083735 (Thread-1): finished collecting timing info
2022-06-12 17:27:10.096674 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-12 17:27:10.097248 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

    

  create temporary table "sat_customer_details__dbt_tmp172710094622"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_customers" AS a
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."sat_customer_details" as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.first_name, e.last_name, e.email, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-12 17:27:10.097711 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 17:27:10.108995 (Thread-1): SQL status: SELECT 1 in 0.01 seconds
2022-06-12 17:27:10.116955 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-12 17:27:10.117838 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: BEGIN
2022-06-12 17:27:10.119196 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:27:10.119841 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-12 17:27:10.120383 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details__dbt_tmp172710094622'
        
      order by ordinal_position

  
2022-06-12 17:27:10.126766 (Thread-1): SQL status: SELECT 8 in 0.01 seconds
2022-06-12 17:27:10.133118 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-12 17:27:10.133741 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:10.139092 (Thread-1): SQL status: SELECT 8 in 0.00 seconds
2022-06-12 17:27:10.145605 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-12 17:27:10.146093 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:10.150648 (Thread-1): SQL status: SELECT 8 in 0.00 seconds
2022-06-12 17:27:10.152582 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-06-12 17:27:10.163716 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-12 17:27:10.164252 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      

    insert into "postgres"."dbt"."sat_customer_details" ("customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source")
    (
       select "customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source"
       from "sat_customer_details__dbt_tmp172710094622"
    );
  
2022-06-12 17:27:10.165402 (Thread-1): SQL status: INSERT 0 1 in 0.00 seconds
2022-06-12 17:27:10.167468 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-06-12 17:27:10.167988 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-12 17:27:10.168467 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-06-12 17:27:10.170649 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:27:10.173490 (Thread-1): finished collecting timing info
2022-06-12 17:27:10.174134 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: Close
2022-06-12 17:27:10.176847 (Thread-1): 17:27:10 | 4 of 5 OK created incremental model dbt.sat_customer_details......... [INSERT 0 1 in 0.17s]
2022-06-12 17:27:10.177487 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_customer_details
2022-06-12 17:27:10.178272 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_order_details
2022-06-12 17:27:10.180962 (Thread-1): 17:27:10 | 5 of 5 START incremental model dbt.sat_order_details................. [RUN]
2022-06-12 17:27:10.181844 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-12 17:27:10.182421 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_order_details
2022-06-12 17:27:10.205927 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-06-12 17:27:10.217761 (Thread-1): finished collecting timing info
2022-06-12 17:27:10.230566 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-12 17:27:10.231113 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

    

  create temporary table "sat_order_details__dbt_tmp172710228200"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_orders" AS a
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."sat_order_details" as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.order_date, e.status, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-12 17:27:10.231549 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 17:27:10.245377 (Thread-1): SQL status: SELECT 0 in 0.01 seconds
2022-06-12 17:27:10.250786 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-12 17:27:10.251328 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: BEGIN
2022-06-12 17:27:10.252201 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-12 17:27:10.252646 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-12 17:27:10.253002 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details__dbt_tmp172710228200'
        
      order by ordinal_position

  
2022-06-12 17:27:10.260041 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-06-12 17:27:10.267007 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-12 17:27:10.267634 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:10.271520 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-06-12 17:27:10.278151 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-12 17:27:10.278672 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-12 17:27:10.282619 (Thread-1): SQL status: SELECT 7 in 0.00 seconds
2022-06-12 17:27:10.284598 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-06-12 17:27:10.296928 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-12 17:27:10.297502 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      

    insert into "postgres"."dbt"."sat_order_details" ("order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source")
    (
       select "order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source"
       from "sat_order_details__dbt_tmp172710228200"
    );
  
2022-06-12 17:27:10.298596 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-12 17:27:10.300530 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-06-12 17:27:10.301239 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-12 17:27:10.301753 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-06-12 17:27:10.303669 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:27:10.306221 (Thread-1): finished collecting timing info
2022-06-12 17:27:10.306820 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: Close
2022-06-12 17:27:10.309136 (Thread-1): 17:27:10 | 5 of 5 OK created incremental model dbt.sat_order_details............ [INSERT 0 0 in 0.13s]
2022-06-12 17:27:10.309762 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_order_details
2022-06-12 17:27:10.312852 (MainThread): Acquiring new postgres connection "master".
2022-06-12 17:27:10.313466 (MainThread): Using postgres connection "master".
2022-06-12 17:27:10.313883 (MainThread): On master: BEGIN
2022-06-12 17:27:10.314257 (MainThread): Opening a new connection, currently in state closed
2022-06-12 17:27:10.319474 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-12 17:27:10.320029 (MainThread): On master: COMMIT
2022-06-12 17:27:10.320416 (MainThread): Using postgres connection "master".
2022-06-12 17:27:10.320667 (MainThread): On master: COMMIT
2022-06-12 17:27:10.321199 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-12 17:27:10.321558 (MainThread): On master: Close
2022-06-12 17:27:10.322271 (MainThread): 17:27:10 | 
2022-06-12 17:27:10.322844 (MainThread): 17:27:10 | Finished running 5 incremental models in 1.05s.
2022-06-12 17:27:10.323982 (MainThread): Connection 'master' was properly closed.
2022-06-12 17:27:10.324864 (MainThread): Connection 'model.jaffle_shop_dbtvault.sat_order_details' was properly closed.
2022-06-12 17:27:10.519834 (MainThread): 
2022-06-12 17:27:10.521639 (MainThread): Completed successfully
2022-06-12 17:27:10.522671 (MainThread): 
Done. PASS=5 WARN=0 ERROR=0 SKIP=0 TOTAL=5
2022-06-12 17:27:10.524072 (MainThread): Flushing usage events
2022-06-12 20:26:10.237576 (MainThread): Running with dbt=0.19.0
2022-06-12 20:26:10.434176 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-12 20:26:10.440165 (MainThread): Tracking: do not track
2022-06-12 20:26:11.328646 (MainThread): Got an acceptable cached parse result
2022-06-12 20:26:11.489210 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-12 20:26:11.529789 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-12 20:26:13.547787 (MainThread): Found 9 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 2 seed files, 2 sources, 0 exposures
2022-06-12 20:26:13.550786 (MainThread): 
2022-06-12 20:26:13.552194 (MainThread): Acquiring new postgres connection "master".
2022-06-12 20:26:13.560514 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-12 20:26:13.579319 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-12 20:26:13.580055 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-12 20:26:13.580778 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-12 20:26:13.632967 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.05 seconds
2022-06-12 20:26:13.638736 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-12 20:26:13.670053 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-12 20:26:13.682673 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-12 20:26:13.683472 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-12 20:26:13.684288 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-12 20:26:13.698472 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-12 20:26:13.702230 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-12 20:26:13.702983 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-12 20:26:13.721301 (ThreadPoolExecutor-1_0): SQL status: SELECT 10 in 0.02 seconds
2022-06-12 20:26:13.736276 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-12 20:26:13.737373 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-12 20:26:13.772717 (MainThread): Using postgres connection "master".
2022-06-12 20:26:13.773361 (MainThread): On master: BEGIN
2022-06-12 20:26:13.773785 (MainThread): Opening a new connection, currently in state init
2022-06-12 20:26:13.786604 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-12 20:26:13.787525 (MainThread): Using postgres connection "master".
2022-06-12 20:26:13.788554 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-12 20:26:13.824028 (MainThread): SQL status: SELECT 3 in 0.03 seconds
2022-06-12 20:26:13.831105 (MainThread): On master: ROLLBACK
2022-06-12 20:26:13.833546 (MainThread): Using postgres connection "master".
2022-06-12 20:26:13.834359 (MainThread): On master: BEGIN
2022-06-12 20:26:13.835940 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-12 20:26:13.836687 (MainThread): On master: COMMIT
2022-06-12 20:26:13.837639 (MainThread): Using postgres connection "master".
2022-06-12 20:26:13.838159 (MainThread): On master: COMMIT
2022-06-12 20:26:13.839315 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-12 20:26:13.840023 (MainThread): On master: Close
2022-06-12 20:26:13.841345 (MainThread): 20:26:13 | Concurrency: 1 threads (target='dev')
2022-06-12 20:26:13.842313 (MainThread): 20:26:13 | 
2022-06-12 20:26:13.852789 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-12 20:26:13.856184 (Thread-1): 20:26:13 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-12 20:26:13.857763 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-12 20:26:13.858833 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-12 20:26:13.894883 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-12 20:26:13.915427 (Thread-1): finished collecting timing info
2022-06-12 20:26:13.992197 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-12 20:26:13.993219 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-12 20:26:13.994102 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 20:26:14.007603 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-12 20:26:14.014773 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-12 20:26:14.015631 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-12 20:26:14.016870 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 20:26:14.026546 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-12 20:26:14.045233 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-12 20:26:14.046158 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-12 20:26:14.047536 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-12 20:26:14.048522 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-12 20:26:14.049240 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

select customer_pk, first_name, last_name, email, effective_from,
COALESCE ((
select min(scd.effective_from)
from dbt.sat_customer_details scd
where s.effective_from < scd.effective_from
and s.customer_pk = scd.customer_pk
), '9999-01-31 00:00:00') effective_to
from dbt.sat_customer_details s
  );

2022-06-12 20:26:14.069011 (Thread-1): SQL status: CREATE VIEW in 0.02 seconds
2022-06-12 20:26:14.082649 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-12 20:26:14.083507 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
alter table "postgres"."dbt"."v_pit_customer__dbt_tmp" rename to "v_pit_customer"
2022-06-12 20:26:14.085957 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-12 20:26:14.101225 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-12 20:26:14.102040 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-12 20:26:14.102791 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-12 20:26:14.108706 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 20:26:14.116376 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-12 20:26:14.117184 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-12 20:26:14.118411 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 20:26:14.123250 (Thread-1): finished collecting timing info
2022-06-12 20:26:14.124433 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-12 20:26:14.128008 (Thread-1): 20:26:14 | 1 of 2 OK created view model dbt.v_pit_customer...................... [CREATE VIEW in 0.27s]
2022-06-12 20:26:14.129069 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-12 20:26:14.130186 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-12 20:26:14.133139 (Thread-1): 20:26:14 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-12 20:26:14.134755 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-12 20:26:14.135891 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-12 20:26:14.156955 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-12 20:26:14.171768 (Thread-1): finished collecting timing info
2022-06-12 20:26:14.192487 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-12 20:26:14.193453 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-12 20:26:14.194174 (Thread-1): Opening a new connection, currently in state closed
2022-06-12 20:26:14.203277 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-12 20:26:14.214810 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-12 20:26:14.215526 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-12 20:26:14.216702 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 20:26:14.219941 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-12 20:26:14.235934 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-12 20:26:14.236787 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-12 20:26:14.238119 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-12 20:26:14.239010 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-12 20:26:14.240020 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-12 20:26:14.246614 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-12 20:26:14.254606 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-12 20:26:14.256397 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-12 20:26:14.258141 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-12 20:26:14.261042 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-12 20:26:14.262013 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-12 20:26:14.262841 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-12 20:26:14.265360 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-12 20:26:14.272133 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-12 20:26:14.273137 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-12 20:26:14.274389 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-12 20:26:14.279113 (Thread-1): finished collecting timing info
2022-06-12 20:26:14.280942 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-12 20:26:14.284329 (Thread-1): 20:26:14 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.15s]
2022-06-12 20:26:14.285077 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-12 20:26:14.288852 (MainThread): Acquiring new postgres connection "master".
2022-06-12 20:26:14.289849 (MainThread): Using postgres connection "master".
2022-06-12 20:26:14.290419 (MainThread): On master: BEGIN
2022-06-12 20:26:14.291225 (MainThread): Opening a new connection, currently in state closed
2022-06-12 20:26:14.299779 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-12 20:26:14.300464 (MainThread): On master: COMMIT
2022-06-12 20:26:14.300948 (MainThread): Using postgres connection "master".
2022-06-12 20:26:14.301341 (MainThread): On master: COMMIT
2022-06-12 20:26:14.302109 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-12 20:26:14.302999 (MainThread): On master: Close
2022-06-12 20:26:14.304754 (MainThread): 20:26:14 | 
2022-06-12 20:26:14.305612 (MainThread): 20:26:14 | Finished running 2 view models in 0.75s.
2022-06-12 20:26:14.306601 (MainThread): Connection 'master' was properly closed.
2022-06-12 20:26:14.307418 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-12 20:26:14.473280 (MainThread): 
2022-06-12 20:26:14.473909 (MainThread): Completed successfully
2022-06-12 20:26:14.474701 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-12 20:26:14.475891 (MainThread): Flushing usage events
2022-06-13 14:36:01.361271 (MainThread): Running with dbt=0.19.0
2022-06-13 14:36:01.575343 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.seed.SeedTask'>, debug=False, defer=None, exclude=None, full_refresh=True, log_cache_events=False, log_format='default', models=None, partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='seed', selector_name=None, show=False, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='seed', write_json=True)
2022-06-13 14:36:01.581217 (MainThread): Tracking: do not track
2022-06-13 14:36:02.971716 (MainThread): Got an acceptable cached parse result
2022-06-13 14:36:03.242246 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:05.199785 (MainThread): Found 10 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-13 14:36:05.202829 (MainThread): 
2022-06-13 14:36:05.204726 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:36:05.213211 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-13 14:36:05.230013 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-13 14:36:05.230565 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-13 14:36:05.231081 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-13 14:36:05.298145 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.07 seconds
2022-06-13 14:36:05.303214 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-13 14:36:05.327400 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-13 14:36:05.337592 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:36:05.338114 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-13 14:36:05.338443 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-13 14:36:05.346393 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:05.348039 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:36:05.348571 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-13 14:36:05.360431 (ThreadPoolExecutor-1_0): SQL status: SELECT 12 in 0.01 seconds
2022-06-13 14:36:05.371811 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-13 14:36:05.372643 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-13 14:36:05.402817 (MainThread): Using postgres connection "master".
2022-06-13 14:36:05.403361 (MainThread): On master: BEGIN
2022-06-13 14:36:05.403723 (MainThread): Opening a new connection, currently in state init
2022-06-13 14:36:05.411708 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:05.412196 (MainThread): Using postgres connection "master".
2022-06-13 14:36:05.412477 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-13 14:36:05.445024 (MainThread): SQL status: SELECT 5 in 0.03 seconds
2022-06-13 14:36:05.453956 (MainThread): On master: ROLLBACK
2022-06-13 14:36:05.454689 (MainThread): Using postgres connection "master".
2022-06-13 14:36:05.455038 (MainThread): On master: BEGIN
2022-06-13 14:36:05.455737 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-13 14:36:05.456674 (MainThread): On master: COMMIT
2022-06-13 14:36:05.457140 (MainThread): Using postgres connection "master".
2022-06-13 14:36:05.457447 (MainThread): On master: COMMIT
2022-06-13 14:36:05.458051 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:36:05.458414 (MainThread): On master: Close
2022-06-13 14:36:05.459085 (MainThread): 14:36:05 | Concurrency: 1 threads (target='dev')
2022-06-13 14:36:05.459626 (MainThread): 14:36:05 | 
2022-06-13 14:36:05.466353 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_customers
2022-06-13 14:36:05.468060 (Thread-1): 14:36:05 | 1 of 3 START seed file dbt.source_customers.......................... [RUN]
2022-06-13 14:36:05.469178 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-13 14:36:05.469756 (Thread-1): finished collecting timing info
2022-06-13 14:36:05.524733 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-13 14:36:05.525343 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */
drop table if exists "postgres"."dbt"."source_customers" cascade
2022-06-13 14:36:05.525697 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:36:05.551644 (Thread-1): SQL status: DROP TABLE in 0.03 seconds
2022-06-13 14:36:05.563413 (Thread-1): * Deprecation Warning: The quote_columns parameter was not set for seeds, so the
default value of False was chosen. The default will change to True in a future
release.

For more information, see:
https://docs.getdbt.com/v0.15/docs/seeds#section-specify-column-quoting
2022-06-13 14:36:05.566231 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-13 14:36:05.566989 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: BEGIN
2022-06-13 14:36:05.568397 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-13 14:36:05.568881 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-13 14:36:05.569162 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers"} */

    create table "postgres"."dbt"."source_customers" (id integer,first_name text,last_name text,email text)
  
2022-06-13 14:36:05.589832 (Thread-1): SQL status: CREATE TABLE in 0.02 seconds
2022-06-13 14:36:05.613957 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-13 14:36:05.614535 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: 
            insert into "postgres"."dbt"."source_customers" (id, first_name, last_name, email) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%...
2022-06-13 14:36:05.619285 (Thread-1): SQL status: INSERT 0 102 in 0.00 seconds
2022-06-13 14:36:05.624965 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_customers"
2022-06-13 14:36:05.654825 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-13 14:36:05.655746 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers".
2022-06-13 14:36:05.656438 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: COMMIT
2022-06-13 14:36:05.673104 (Thread-1): SQL status: COMMIT in 0.02 seconds
2022-06-13 14:36:05.675942 (Thread-1): finished collecting timing info
2022-06-13 14:36:05.676657 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers: Close
2022-06-13 14:36:05.677976 (Thread-1): 14:36:05 | 1 of 3 OK loaded seed file dbt.source_customers...................... [CREATE 102 in 0.21s]
2022-06-13 14:36:05.678695 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_customers
2022-06-13 14:36:05.679400 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_customers_crm
2022-06-13 14:36:05.682138 (Thread-1): 14:36:05 | 2 of 3 START seed file dbt.source_customers_crm...................... [RUN]
2022-06-13 14:36:05.683152 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_customers_crm".
2022-06-13 14:36:05.683810 (Thread-1): finished collecting timing info
2022-06-13 14:36:05.697877 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers_crm".
2022-06-13 14:36:05.698320 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers_crm: BEGIN
2022-06-13 14:36:05.698644 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:36:05.705851 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:05.706484 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers_crm".
2022-06-13 14:36:05.706849 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_customers_crm"} */

    create table "postgres"."dbt"."source_customers_crm" (id integer,country text,age integer)
  
2022-06-13 14:36:05.714622 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-06-13 14:36:05.717144 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers_crm".
2022-06-13 14:36:05.717639 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers_crm: 
            insert into "postgres"."dbt"."source_customers_crm" (id, country, age) values
            (%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s),(%s,%s,%s)
        ...
2022-06-13 14:36:05.719246 (Thread-1): SQL status: INSERT 0 5 in 0.00 seconds
2022-06-13 14:36:05.720074 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_customers_crm"
2022-06-13 14:36:05.735535 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers_crm: COMMIT
2022-06-13 14:36:05.736156 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_customers_crm".
2022-06-13 14:36:05.736559 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers_crm: COMMIT
2022-06-13 14:36:05.738523 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:36:05.742332 (Thread-1): finished collecting timing info
2022-06-13 14:36:05.743124 (Thread-1): On seed.jaffle_shop_dbtvault.source_customers_crm: Close
2022-06-13 14:36:05.744876 (Thread-1): 14:36:05 | 2 of 3 OK loaded seed file dbt.source_customers_crm.................. [CREATE 5 in 0.06s]
2022-06-13 14:36:05.745946 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_customers_crm
2022-06-13 14:36:05.746927 (Thread-1): Began running node seed.jaffle_shop_dbtvault.source_orders
2022-06-13 14:36:05.750073 (Thread-1): 14:36:05 | 3 of 3 START seed file dbt.source_orders............................. [RUN]
2022-06-13 14:36:05.751347 (Thread-1): Acquiring new postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-13 14:36:05.752129 (Thread-1): finished collecting timing info
2022-06-13 14:36:05.794153 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-13 14:36:05.794820 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */
drop table if exists "postgres"."dbt"."source_orders" cascade
2022-06-13 14:36:05.795394 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:36:05.814489 (Thread-1): SQL status: DROP TABLE in 0.02 seconds
2022-06-13 14:36:05.819357 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-13 14:36:05.819969 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: BEGIN
2022-06-13 14:36:05.820919 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-13 14:36:05.821620 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-13 14:36:05.822200 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "seed.jaffle_shop_dbtvault.source_orders"} */

    create table "postgres"."dbt"."source_orders" (id integer,user_id integer,order_date date,status text)
  
2022-06-13 14:36:05.829337 (Thread-1): SQL status: CREATE TABLE in 0.01 seconds
2022-06-13 14:36:05.837004 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-13 14:36:05.837830 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: 
            insert into "postgres"."dbt"."source_orders" (id, user_id, order_date, status) values
            (%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s,%s),(%s,%s,%s...
2022-06-13 14:36:05.840901 (Thread-1): SQL status: INSERT 0 99 in 0.00 seconds
2022-06-13 14:36:05.842046 (Thread-1): Writing runtime SQL for node "seed.jaffle_shop_dbtvault.source_orders"
2022-06-13 14:36:05.863388 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-13 14:36:05.864205 (Thread-1): Using postgres connection "seed.jaffle_shop_dbtvault.source_orders".
2022-06-13 14:36:05.865055 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: COMMIT
2022-06-13 14:36:05.868637 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:36:05.872622 (Thread-1): finished collecting timing info
2022-06-13 14:36:05.873398 (Thread-1): On seed.jaffle_shop_dbtvault.source_orders: Close
2022-06-13 14:36:05.875188 (Thread-1): 14:36:05 | 3 of 3 OK loaded seed file dbt.source_orders......................... [CREATE 99 in 0.12s]
2022-06-13 14:36:05.876113 (Thread-1): Finished running node seed.jaffle_shop_dbtvault.source_orders
2022-06-13 14:36:05.879644 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:36:05.881202 (MainThread): Using postgres connection "master".
2022-06-13 14:36:05.881860 (MainThread): On master: BEGIN
2022-06-13 14:36:05.882374 (MainThread): Opening a new connection, currently in state closed
2022-06-13 14:36:05.892494 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:05.893225 (MainThread): On master: COMMIT
2022-06-13 14:36:05.893821 (MainThread): Using postgres connection "master".
2022-06-13 14:36:05.894333 (MainThread): On master: COMMIT
2022-06-13 14:36:05.895173 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:36:05.895779 (MainThread): On master: Close
2022-06-13 14:36:05.896901 (MainThread): 14:36:05 | 
2022-06-13 14:36:05.897568 (MainThread): 14:36:05 | Finished running 3 seeds in 0.69s.
2022-06-13 14:36:05.898392 (MainThread): Connection 'master' was properly closed.
2022-06-13 14:36:05.899224 (MainThread): Connection 'seed.jaffle_shop_dbtvault.source_orders' was properly closed.
2022-06-13 14:36:06.124654 (MainThread): 
2022-06-13 14:36:06.125734 (MainThread): Completed successfully
2022-06-13 14:36:06.126880 (MainThread): 
Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
2022-06-13 14:36:06.128878 (MainThread): Flushing usage events
2022-06-13 14:36:22.983169 (MainThread): Running with dbt=0.19.0
2022-06-13 14:36:23.130921 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-13 14:36:23.135207 (MainThread): Tracking: do not track
2022-06-13 14:36:23.785098 (MainThread): Got an acceptable cached parse result
2022-06-13 14:36:25.248886 (MainThread): Found 10 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-13 14:36:25.252724 (MainThread): 
2022-06-13 14:36:25.255019 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:36:25.265604 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-13 14:36:25.281982 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-13 14:36:25.283132 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-13 14:36:25.283630 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-13 14:36:25.297669 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.01 seconds
2022-06-13 14:36:25.302398 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-13 14:36:25.324256 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-13 14:36:25.333979 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:36:25.334489 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-13 14:36:25.334835 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-13 14:36:25.343293 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:25.343912 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:36:25.344340 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-13 14:36:25.347106 (ThreadPoolExecutor-1_0): SQL status: SELECT 11 in 0.00 seconds
2022-06-13 14:36:25.357422 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-13 14:36:25.358254 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-13 14:36:25.384976 (MainThread): Using postgres connection "master".
2022-06-13 14:36:25.385495 (MainThread): On master: BEGIN
2022-06-13 14:36:25.385824 (MainThread): Opening a new connection, currently in state init
2022-06-13 14:36:25.398639 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:25.399421 (MainThread): Using postgres connection "master".
2022-06-13 14:36:25.399897 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-13 14:36:25.419590 (MainThread): SQL status: SELECT 3 in 0.02 seconds
2022-06-13 14:36:25.424734 (MainThread): On master: ROLLBACK
2022-06-13 14:36:25.425552 (MainThread): Using postgres connection "master".
2022-06-13 14:36:25.425907 (MainThread): On master: BEGIN
2022-06-13 14:36:25.426884 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-13 14:36:25.427507 (MainThread): On master: COMMIT
2022-06-13 14:36:25.427935 (MainThread): Using postgres connection "master".
2022-06-13 14:36:25.428287 (MainThread): On master: COMMIT
2022-06-13 14:36:25.429038 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:36:25.429507 (MainThread): On master: Close
2022-06-13 14:36:25.430933 (MainThread): 14:36:25 | Concurrency: 1 threads (target='dev')
2022-06-13 14:36:25.431910 (MainThread): 14:36:25 | 
2022-06-13 14:36:25.438928 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-13 14:36:25.441889 (Thread-1): 14:36:25 | 1 of 3 START view model dbt.v_stg_customers.......................... [RUN]
2022-06-13 14:36:25.443158 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.443895 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers
2022-06-13 14:36:25.530913 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.531436 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: BEGIN
2022-06-13 14:36:25.531753 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:36:25.539686 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:25.540322 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.540721 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:36:25.569267 (Thread-1): SQL status: SELECT 4 in 0.03 seconds
2022-06-13 14:36:25.616069 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.616573 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:36:25.620823 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:36:25.671445 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-13 14:36:25.684762 (Thread-1): finished collecting timing info
2022-06-13 14:36:25.720968 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.721538 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_tmp" cascade
2022-06-13 14:36:25.722449 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:36:25.727667 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.728170 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-13 14:36:25.729338 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:36:25.734975 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-13 14:36:25.747149 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.747608 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

  create view "postgres"."dbt"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."dbt"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-13 14:36:25.760080 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-13 14:36:25.768367 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.768831 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
alter table "postgres"."dbt"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-06-13 14:36:25.770527 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:36:25.780127 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-13 14:36:25.780677 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.780993 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-13 14:36:25.783595 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:36:25.789871 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:36:25.790876 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-13 14:36:25.791796 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:36:25.795279 (Thread-1): finished collecting timing info
2022-06-13 14:36:25.795883 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: Close
2022-06-13 14:36:25.798067 (Thread-1): 14:36:25 | 1 of 3 OK created view model dbt.v_stg_customers..................... [CREATE VIEW in 0.35s]
2022-06-13 14:36:25.798623 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-13 14:36:25.799285 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers_crm
2022-06-13 14:36:25.801172 (Thread-1): 14:36:25 | 2 of 3 START view model dbt.v_stg_customers_crm...................... [RUN]
2022-06-13 14:36:25.801986 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.802536 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers_crm
2022-06-13 14:36:25.821122 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.821792 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: BEGIN
2022-06-13 14:36:25.822485 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:36:25.827556 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:25.828076 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.828368 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:36:25.834794 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-13 14:36:25.845792 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.846420 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:36:25.850653 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:36:25.856158 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers_crm"
2022-06-13 14:36:25.866611 (Thread-1): finished collecting timing info
2022-06-13 14:36:25.879894 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.880425 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
drop view if exists "postgres"."dbt"."v_stg_customers_crm__dbt_tmp" cascade
2022-06-13 14:36:25.881389 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:36:25.887450 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.888045 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
drop view if exists "postgres"."dbt"."v_stg_customers_crm__dbt_backup" cascade
2022-06-13 14:36:25.888822 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:36:25.890529 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers_crm"
2022-06-13 14:36:25.902610 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.903199 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */

  create view "postgres"."dbt"."v_stg_customers_crm__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."dbt"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS_CRM'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *,
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-13 14:36:25.906210 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-06-13 14:36:25.911724 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.912270 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
alter table "postgres"."dbt"."v_stg_customers_crm__dbt_tmp" rename to "v_stg_customers_crm"
2022-06-13 14:36:25.913538 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:36:25.915747 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: COMMIT
2022-06-13 14:36:25.916289 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.916607 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: COMMIT
2022-06-13 14:36:25.918206 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:36:25.922619 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:36:25.923181 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
drop view if exists "postgres"."dbt"."v_stg_customers_crm__dbt_backup" cascade
2022-06-13 14:36:25.924065 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:36:25.927329 (Thread-1): finished collecting timing info
2022-06-13 14:36:25.927938 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: Close
2022-06-13 14:36:25.930118 (Thread-1): 14:36:25 | 2 of 3 OK created view model dbt.v_stg_customers_crm................. [CREATE VIEW in 0.13s]
2022-06-13 14:36:25.930784 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers_crm
2022-06-13 14:36:25.931717 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-13 14:36:25.933961 (Thread-1): 14:36:25 | 3 of 3 START view model dbt.v_stg_orders............................. [RUN]
2022-06-13 14:36:25.934870 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:25.935707 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_orders
2022-06-13 14:36:25.956095 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:25.956640 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: BEGIN
2022-06-13 14:36:25.957030 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:36:25.962897 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:25.963479 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:25.963832 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:36:25.972013 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-13 14:36:25.979352 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:25.979866 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:36:25.983788 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:36:25.996810 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-13 14:36:26.007902 (Thread-1): finished collecting timing info
2022-06-13 14:36:26.021659 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:26.022223 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_tmp" cascade
2022-06-13 14:36:26.023010 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:36:26.027817 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:26.028486 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-13 14:36:26.029283 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:36:26.031089 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-13 14:36:26.041524 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:26.042126 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

  create view "postgres"."dbt"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."dbt"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-13 14:36:26.049060 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-13 14:36:26.055283 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:26.055778 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
alter table "postgres"."dbt"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-06-13 14:36:26.056787 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:36:26.058505 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-13 14:36:26.058896 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:26.059168 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-13 14:36:26.060950 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:36:26.064445 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:36:26.064986 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-13 14:36:26.065642 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:36:26.068729 (Thread-1): finished collecting timing info
2022-06-13 14:36:26.069560 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: Close
2022-06-13 14:36:26.071892 (Thread-1): 14:36:26 | 3 of 3 OK created view model dbt.v_stg_orders........................ [CREATE VIEW in 0.14s]
2022-06-13 14:36:26.072616 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-13 14:36:26.075374 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:36:26.075912 (MainThread): Using postgres connection "master".
2022-06-13 14:36:26.076447 (MainThread): On master: BEGIN
2022-06-13 14:36:26.076913 (MainThread): Opening a new connection, currently in state closed
2022-06-13 14:36:26.084102 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:36:26.084680 (MainThread): On master: COMMIT
2022-06-13 14:36:26.085022 (MainThread): Using postgres connection "master".
2022-06-13 14:36:26.085288 (MainThread): On master: COMMIT
2022-06-13 14:36:26.085768 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:36:26.086145 (MainThread): On master: Close
2022-06-13 14:36:26.086896 (MainThread): 14:36:26 | 
2022-06-13 14:36:26.087457 (MainThread): 14:36:26 | Finished running 3 view models in 0.83s.
2022-06-13 14:36:26.088284 (MainThread): Connection 'master' was properly closed.
2022-06-13 14:36:26.088944 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_stg_orders' was properly closed.
2022-06-13 14:36:26.231851 (MainThread): 
2022-06-13 14:36:26.232943 (MainThread): Completed successfully
2022-06-13 14:36:26.234308 (MainThread): 
Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
2022-06-13 14:36:26.235741 (MainThread): Flushing usage events
2022-06-13 14:38:25.188982 (MainThread): Running with dbt=0.19.0
2022-06-13 14:38:25.321605 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-13 14:38:25.326350 (MainThread): Tracking: do not track
2022-06-13 14:38:26.343275 (MainThread): Got an acceptable cached parse result
2022-06-13 14:38:26.651102 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:28.460165 (MainThread): Found 10 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-13 14:38:28.466074 (MainThread): 
2022-06-13 14:38:28.467593 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:38:28.479810 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-13 14:38:28.500907 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-13 14:38:28.501617 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-13 14:38:28.502112 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-13 14:38:28.512952 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.01 seconds
2022-06-13 14:38:28.517064 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-13 14:38:28.554239 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-13 14:38:28.564578 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:38:28.565215 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-13 14:38:28.565889 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-13 14:38:28.572786 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:38:28.573380 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:38:28.573822 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-13 14:38:28.577241 (ThreadPoolExecutor-1_0): SQL status: SELECT 14 in 0.00 seconds
2022-06-13 14:38:28.601952 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-13 14:38:28.603218 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-13 14:38:28.634725 (MainThread): Using postgres connection "master".
2022-06-13 14:38:28.635252 (MainThread): On master: BEGIN
2022-06-13 14:38:28.635589 (MainThread): Opening a new connection, currently in state init
2022-06-13 14:38:28.642132 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:38:28.642638 (MainThread): Using postgres connection "master".
2022-06-13 14:38:28.642928 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-13 14:38:28.675062 (MainThread): SQL status: SELECT 6 in 0.03 seconds
2022-06-13 14:38:28.684339 (MainThread): On master: ROLLBACK
2022-06-13 14:38:28.685115 (MainThread): Using postgres connection "master".
2022-06-13 14:38:28.685522 (MainThread): On master: BEGIN
2022-06-13 14:38:28.686355 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-13 14:38:28.686795 (MainThread): On master: COMMIT
2022-06-13 14:38:28.687083 (MainThread): Using postgres connection "master".
2022-06-13 14:38:28.687364 (MainThread): On master: COMMIT
2022-06-13 14:38:28.687918 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:38:28.688476 (MainThread): On master: Close
2022-06-13 14:38:28.689636 (MainThread): 14:38:28 | Concurrency: 1 threads (target='dev')
2022-06-13 14:38:28.690518 (MainThread): 14:38:28 | 
2022-06-13 14:38:28.698821 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-13 14:38:28.701327 (Thread-1): 14:38:28 | 1 of 3 START view model dbt.v_stg_customers.......................... [RUN]
2022-06-13 14:38:28.703056 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.704007 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers
2022-06-13 14:38:28.744255 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.744910 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: BEGIN
2022-06-13 14:38:28.745468 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:38:28.763460 (Thread-1): SQL status: BEGIN in 0.02 seconds
2022-06-13 14:38:28.764210 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.764635 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:38:28.773443 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-13 14:38:28.786456 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.786997 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:38:28.792079 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:38:28.799412 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-13 14:38:28.808759 (Thread-1): finished collecting timing info
2022-06-13 14:38:28.846847 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.847400 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_tmp" cascade
2022-06-13 14:38:28.848195 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:38:28.854324 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.854912 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-13 14:38:28.855862 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:38:28.862028 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-13 14:38:28.873273 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.873749 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

  create view "postgres"."dbt"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."dbt"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-13 14:38:28.878325 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-06-13 14:38:28.890680 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.891248 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
alter table "postgres"."dbt"."v_stg_customers" rename to "v_stg_customers__dbt_backup"
2022-06-13 14:38:28.892636 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:38:28.897745 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.898398 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
alter table "postgres"."dbt"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-06-13 14:38:28.899851 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:38:28.909858 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-13 14:38:28.910400 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.910988 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-13 14:38:28.912934 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:38:28.918610 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:38:28.919108 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-13 14:38:28.922320 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:38:28.926266 (Thread-1): finished collecting timing info
2022-06-13 14:38:28.926994 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: Close
2022-06-13 14:38:28.930357 (Thread-1): 14:38:28 | 1 of 3 OK created view model dbt.v_stg_customers..................... [CREATE VIEW in 0.23s]
2022-06-13 14:38:28.930983 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-13 14:38:28.931677 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers_crm
2022-06-13 14:38:28.934073 (Thread-1): 14:38:28 | 2 of 3 START view model dbt.v_stg_customers_crm...................... [RUN]
2022-06-13 14:38:28.935195 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:28.935875 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers_crm
2022-06-13 14:38:28.957215 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:28.957762 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: BEGIN
2022-06-13 14:38:28.958090 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:38:28.964839 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:38:28.965394 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:28.965684 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:38:28.973238 (Thread-1): SQL status: SELECT 3 in 0.01 seconds
2022-06-13 14:38:28.982421 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:28.982928 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:38:28.986514 (Thread-1): SQL status: SELECT 3 in 0.00 seconds
2022-06-13 14:38:28.991329 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers_crm"
2022-06-13 14:38:29.001168 (Thread-1): finished collecting timing info
2022-06-13 14:38:29.018068 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:29.018634 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
drop view if exists "postgres"."dbt"."v_stg_customers_crm__dbt_tmp" cascade
2022-06-13 14:38:29.019633 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:38:29.024064 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:29.024533 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
drop view if exists "postgres"."dbt"."v_stg_customers_crm__dbt_backup" cascade
2022-06-13 14:38:29.025213 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:38:29.026929 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers_crm"
2022-06-13 14:38:29.037576 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:29.038091 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */

  create view "postgres"."dbt"."v_stg_customers_crm__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    country,
    age

    FROM "postgres"."dbt"."source_customers_crm"
),

derived_columns AS (

    SELECT

    id,
    country,
    age,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS_CRM'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *,
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-13 14:38:29.041721 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-06-13 14:38:29.049806 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:29.050426 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
alter table "postgres"."dbt"."v_stg_customers_crm" rename to "v_stg_customers_crm__dbt_backup"
2022-06-13 14:38:29.051691 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:38:29.057562 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:29.058122 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
alter table "postgres"."dbt"."v_stg_customers_crm__dbt_tmp" rename to "v_stg_customers_crm"
2022-06-13 14:38:29.059164 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:38:29.061077 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: COMMIT
2022-06-13 14:38:29.061478 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:29.061756 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: COMMIT
2022-06-13 14:38:29.064092 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:38:29.068119 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:38:29.068622 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
drop view if exists "postgres"."dbt"."v_stg_customers_crm__dbt_backup" cascade
2022-06-13 14:38:29.071833 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:38:29.075358 (Thread-1): finished collecting timing info
2022-06-13 14:38:29.076292 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: Close
2022-06-13 14:38:29.079485 (Thread-1): 14:38:29 | 2 of 3 OK created view model dbt.v_stg_customers_crm................. [CREATE VIEW in 0.14s]
2022-06-13 14:38:29.080179 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers_crm
2022-06-13 14:38:29.081029 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-13 14:38:29.083293 (Thread-1): 14:38:29 | 3 of 3 START view model dbt.v_stg_orders............................. [RUN]
2022-06-13 14:38:29.085913 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.087011 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_orders
2022-06-13 14:38:29.109153 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.109774 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: BEGIN
2022-06-13 14:38:29.110326 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:38:29.117568 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:38:29.118134 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.118549 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:38:29.127123 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-13 14:38:29.137913 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.138489 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:38:29.142389 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:38:29.149808 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-13 14:38:29.161598 (Thread-1): finished collecting timing info
2022-06-13 14:38:29.173463 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.174087 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_tmp" cascade
2022-06-13 14:38:29.175055 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:38:29.179348 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.179816 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-13 14:38:29.180721 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:38:29.183123 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-13 14:38:29.193469 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.193943 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

  create view "postgres"."dbt"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."dbt"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-13 14:38:29.197776 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-06-13 14:38:29.204610 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.205224 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
alter table "postgres"."dbt"."v_stg_orders" rename to "v_stg_orders__dbt_backup"
2022-06-13 14:38:29.206742 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:38:29.211392 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.211913 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
alter table "postgres"."dbt"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-06-13 14:38:29.213362 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:38:29.215172 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-13 14:38:29.215678 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.216044 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-13 14:38:29.217920 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:38:29.221498 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:38:29.222034 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-13 14:38:29.224902 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:38:29.228359 (Thread-1): finished collecting timing info
2022-06-13 14:38:29.229163 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: Close
2022-06-13 14:38:29.231828 (Thread-1): 14:38:29 | 3 of 3 OK created view model dbt.v_stg_orders........................ [CREATE VIEW in 0.15s]
2022-06-13 14:38:29.232465 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-13 14:38:29.235008 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:38:29.235510 (MainThread): Using postgres connection "master".
2022-06-13 14:38:29.235788 (MainThread): On master: BEGIN
2022-06-13 14:38:29.236120 (MainThread): Opening a new connection, currently in state closed
2022-06-13 14:38:29.243143 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:38:29.243973 (MainThread): On master: COMMIT
2022-06-13 14:38:29.244446 (MainThread): Using postgres connection "master".
2022-06-13 14:38:29.244875 (MainThread): On master: COMMIT
2022-06-13 14:38:29.245488 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:38:29.245910 (MainThread): On master: Close
2022-06-13 14:38:29.246675 (MainThread): 14:38:29 | 
2022-06-13 14:38:29.247223 (MainThread): 14:38:29 | Finished running 3 view models in 0.78s.
2022-06-13 14:38:29.247968 (MainThread): Connection 'master' was properly closed.
2022-06-13 14:38:29.249358 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_stg_orders' was properly closed.
2022-06-13 14:38:29.407287 (MainThread): 
2022-06-13 14:38:29.408491 (MainThread): Completed successfully
2022-06-13 14:38:29.409992 (MainThread): 
Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
2022-06-13 14:38:29.411456 (MainThread): Flushing usage events
2022-06-13 14:45:33.601462 (MainThread): Running with dbt=0.19.0
2022-06-13 14:45:33.757284 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:hub'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-13 14:45:33.761366 (MainThread): Tracking: do not track
2022-06-13 14:45:34.519699 (MainThread): Got an acceptable cached parse result
2022-06-13 14:45:34.684687 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-13 14:45:36.046313 (MainThread): Found 10 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-13 14:45:36.049728 (MainThread): 
2022-06-13 14:45:36.051936 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:45:36.056563 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-13 14:45:36.072709 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-13 14:45:36.073279 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-13 14:45:36.073681 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-13 14:45:36.085117 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.01 seconds
2022-06-13 14:45:36.089881 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-13 14:45:36.115205 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-13 14:45:36.127680 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:45:36.128246 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-13 14:45:36.129003 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-13 14:45:36.137037 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:45:36.137531 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:45:36.137798 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-13 14:45:36.141230 (ThreadPoolExecutor-1_0): SQL status: SELECT 14 in 0.00 seconds
2022-06-13 14:45:36.155732 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-13 14:45:36.156489 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-13 14:45:36.187781 (MainThread): Using postgres connection "master".
2022-06-13 14:45:36.188296 (MainThread): On master: BEGIN
2022-06-13 14:45:36.188589 (MainThread): Opening a new connection, currently in state init
2022-06-13 14:45:36.193689 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:45:36.194299 (MainThread): Using postgres connection "master".
2022-06-13 14:45:36.194613 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-13 14:45:36.231448 (MainThread): SQL status: SELECT 6 in 0.04 seconds
2022-06-13 14:45:36.242486 (MainThread): On master: ROLLBACK
2022-06-13 14:45:36.243548 (MainThread): Using postgres connection "master".
2022-06-13 14:45:36.244244 (MainThread): On master: BEGIN
2022-06-13 14:45:36.245965 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-13 14:45:36.246473 (MainThread): On master: COMMIT
2022-06-13 14:45:36.246775 (MainThread): Using postgres connection "master".
2022-06-13 14:45:36.247106 (MainThread): On master: COMMIT
2022-06-13 14:45:36.247691 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:45:36.248077 (MainThread): On master: Close
2022-06-13 14:45:36.250794 (MainThread): 14:45:36 | Concurrency: 1 threads (target='dev')
2022-06-13 14:45:36.251460 (MainThread): 14:45:36 | 
2022-06-13 14:45:36.259425 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_customer
2022-06-13 14:45:36.261663 (Thread-1): 14:45:36 | 1 of 2 START incremental model dbt.hub_customer...................... [RUN]
2022-06-13 14:45:36.263417 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-13 14:45:36.264345 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_customer
2022-06-13 14:45:36.306141 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-06-13 14:45:36.321368 (Thread-1): finished collecting timing info
2022-06-13 14:45:36.386748 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-13 14:45:36.387358 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

    

  create temporary table "hub_customer__dbt_tmp144536374230"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_customers"

) as h
WHERE row_number = 1
),

row_rank_2 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

row_rank_3 AS (

SELECT * FROM (
    SELECT CUSTOMER_PK, CUSTOMER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_customers_crm"

) as h
WHERE row_number = 1
),

stage_union AS (
    SELECT * FROM row_rank_1
    UNION ALL
    SELECT * FROM row_rank_2
    UNION ALL
    SELECT * FROM row_rank_3
),

row_rank_union AS (

SELECT * FROM (

    SELECT *,
           ROW_NUMBER() OVER(
               PARTITION BY CUSTOMER_PK
               ORDER BY LOAD_DATE, RECORD_SOURCE ASC
           ) AS row_rank_number
    FROM stage_union
    WHERE CUSTOMER_PK IS NOT NULL
) as h 
WHERE row_rank_number = 1
),

records_to_insert AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_union AS a
    LEFT JOIN "postgres"."dbt"."hub_customer" AS d
    ON a.CUSTOMER_PK = d.CUSTOMER_PK
    WHERE d.CUSTOMER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-13 14:45:36.387829 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:45:36.408137 (Thread-1): SQL status: SELECT 1 in 0.02 seconds
2022-06-13 14:45:36.420870 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-13 14:45:36.421410 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: BEGIN
2022-06-13 14:45:36.422188 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-13 14:45:36.422627 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-13 14:45:36.422949 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer__dbt_tmp144536374230'
        
      order by ordinal_position

  
2022-06-13 14:45:36.430587 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-13 14:45:36.455384 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-13 14:45:36.456530 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:45:36.463219 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-13 14:45:36.489359 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-13 14:45:36.489938 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_customer'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:45:36.493734 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:45:36.496562 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_customer"
2022-06-13 14:45:36.513265 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-13 14:45:36.514008 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_customer"} */

      

    insert into "postgres"."dbt"."hub_customer" ("customer_pk", "customer_key", "load_date", "record_source")
    (
       select "customer_pk", "customer_key", "load_date", "record_source"
       from "hub_customer__dbt_tmp144536374230"
    );
  
2022-06-13 14:45:36.515361 (Thread-1): SQL status: INSERT 0 1 in 0.00 seconds
2022-06-13 14:45:36.533502 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-06-13 14:45:36.534164 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_customer".
2022-06-13 14:45:36.534550 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: COMMIT
2022-06-13 14:45:36.538056 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:45:36.541753 (Thread-1): finished collecting timing info
2022-06-13 14:45:36.542448 (Thread-1): On model.jaffle_shop_dbtvault.hub_customer: Close
2022-06-13 14:45:36.544856 (Thread-1): 14:45:36 | 1 of 2 OK created incremental model dbt.hub_customer................. [INSERT 0 1 in 0.28s]
2022-06-13 14:45:36.545510 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_customer
2022-06-13 14:45:36.546274 (Thread-1): Began running node model.jaffle_shop_dbtvault.hub_order
2022-06-13 14:45:36.549320 (Thread-1): 14:45:36 | 2 of 2 START incremental model dbt.hub_order......................... [RUN]
2022-06-13 14:45:36.550416 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-13 14:45:36.551179 (Thread-1): Compiling model.jaffle_shop_dbtvault.hub_order
2022-06-13 14:45:36.570333 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-06-13 14:45:36.584953 (Thread-1): finished collecting timing info
2022-06-13 14:45:36.598911 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-13 14:45:36.599511 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

    

  create temporary table "hub_order__dbt_tmp144536596135"
  as (
    -- Generated by dbtvault.

WITH row_rank_1 AS (

SELECT * FROM (
    SELECT ORDER_PK, ORDER_KEY, LOAD_DATE, RECORD_SOURCE,
           ROW_NUMBER() OVER(
               PARTITION BY ORDER_PK
               ORDER BY LOAD_DATE ASC
           ) AS row_number
    FROM "postgres"."dbt"."v_stg_orders"

) as h
WHERE row_number = 1
),

records_to_insert AS (
    SELECT a.ORDER_PK, a.ORDER_KEY, a.LOAD_DATE, a.RECORD_SOURCE
    FROM row_rank_1 AS a
    LEFT JOIN "postgres"."dbt"."hub_order" AS d
    ON a.ORDER_PK = d.ORDER_PK
    WHERE d.ORDER_PK IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-13 14:45:36.599975 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:45:36.617742 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-06-13 14:45:36.623081 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-13 14:45:36.623639 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: BEGIN
2022-06-13 14:45:36.624698 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-13 14:45:36.625240 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-13 14:45:36.625601 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'hub_order__dbt_tmp144536596135'
        
      order by ordinal_position

  
2022-06-13 14:45:36.631978 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-13 14:45:36.637941 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-13 14:45:36.638572 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:45:36.642992 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:45:36.649476 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-13 14:45:36.650016 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'hub_order'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:45:36.654312 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:45:36.657046 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.hub_order"
2022-06-13 14:45:36.670762 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-13 14:45:36.671715 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.hub_order"} */

      

    insert into "postgres"."dbt"."hub_order" ("order_pk", "order_key", "load_date", "record_source")
    (
       select "order_pk", "order_key", "load_date", "record_source"
       from "hub_order__dbt_tmp144536596135"
    );
  
2022-06-13 14:45:36.672830 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-13 14:45:36.675108 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-06-13 14:45:36.675668 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.hub_order".
2022-06-13 14:45:36.676073 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: COMMIT
2022-06-13 14:45:36.678482 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:45:36.681828 (Thread-1): finished collecting timing info
2022-06-13 14:45:36.682539 (Thread-1): On model.jaffle_shop_dbtvault.hub_order: Close
2022-06-13 14:45:36.684916 (Thread-1): 14:45:36 | 2 of 2 OK created incremental model dbt.hub_order.................... [INSERT 0 0 in 0.13s]
2022-06-13 14:45:36.686558 (Thread-1): Finished running node model.jaffle_shop_dbtvault.hub_order
2022-06-13 14:45:36.690050 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:45:36.690662 (MainThread): Using postgres connection "master".
2022-06-13 14:45:36.690978 (MainThread): On master: BEGIN
2022-06-13 14:45:36.691371 (MainThread): Opening a new connection, currently in state closed
2022-06-13 14:45:36.700215 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:45:36.700880 (MainThread): On master: COMMIT
2022-06-13 14:45:36.701364 (MainThread): Using postgres connection "master".
2022-06-13 14:45:36.701753 (MainThread): On master: COMMIT
2022-06-13 14:45:36.702411 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:45:36.702794 (MainThread): On master: Close
2022-06-13 14:45:36.703586 (MainThread): 14:45:36 | 
2022-06-13 14:45:36.704187 (MainThread): 14:45:36 | Finished running 2 incremental models in 0.65s.
2022-06-13 14:45:36.704843 (MainThread): Connection 'master' was properly closed.
2022-06-13 14:45:36.705719 (MainThread): Connection 'model.jaffle_shop_dbtvault.hub_order' was properly closed.
2022-06-13 14:45:36.847684 (MainThread): 
2022-06-13 14:45:36.848623 (MainThread): Completed successfully
2022-06-13 14:45:36.849456 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-13 14:45:36.850805 (MainThread): Flushing usage events
2022-06-13 14:53:17.144338 (MainThread): Running with dbt=0.19.0
2022-06-13 14:53:17.271771 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:stage'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-13 14:53:17.276049 (MainThread): Tracking: do not track
2022-06-13 14:53:18.178401 (MainThread): Got an acceptable cached parse result
2022-06-13 14:53:18.372732 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:20.656600 (MainThread): Found 10 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-13 14:53:20.660892 (MainThread): 
2022-06-13 14:53:20.663352 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:53:20.673537 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-13 14:53:20.704958 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-13 14:53:20.705665 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-13 14:53:20.706148 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-13 14:53:20.715210 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.01 seconds
2022-06-13 14:53:20.719480 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-13 14:53:20.754257 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-13 14:53:20.764561 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:53:20.765478 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-13 14:53:20.765957 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-13 14:53:20.773229 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:53:20.773896 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 14:53:20.774518 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-13 14:53:20.777940 (ThreadPoolExecutor-1_0): SQL status: SELECT 14 in 0.00 seconds
2022-06-13 14:53:20.797145 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-13 14:53:20.798314 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-13 14:53:20.845578 (MainThread): Using postgres connection "master".
2022-06-13 14:53:20.846362 (MainThread): On master: BEGIN
2022-06-13 14:53:20.847152 (MainThread): Opening a new connection, currently in state init
2022-06-13 14:53:20.856146 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:53:20.856754 (MainThread): Using postgres connection "master".
2022-06-13 14:53:20.857244 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-13 14:53:20.896784 (MainThread): SQL status: SELECT 6 in 0.04 seconds
2022-06-13 14:53:20.912046 (MainThread): On master: ROLLBACK
2022-06-13 14:53:20.913795 (MainThread): Using postgres connection "master".
2022-06-13 14:53:20.914484 (MainThread): On master: BEGIN
2022-06-13 14:53:20.915845 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-13 14:53:20.916527 (MainThread): On master: COMMIT
2022-06-13 14:53:20.917060 (MainThread): Using postgres connection "master".
2022-06-13 14:53:20.917541 (MainThread): On master: COMMIT
2022-06-13 14:53:20.918457 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:53:20.919337 (MainThread): On master: Close
2022-06-13 14:53:20.920818 (MainThread): 14:53:20 | Concurrency: 1 threads (target='dev')
2022-06-13 14:53:20.921742 (MainThread): 14:53:20 | 
2022-06-13 14:53:20.931223 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-13 14:53:20.935407 (Thread-1): 14:53:20 | 1 of 3 START view model dbt.v_stg_customers.......................... [RUN]
2022-06-13 14:53:20.937287 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:20.938467 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers
2022-06-13 14:53:21.032778 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.033710 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: BEGIN
2022-06-13 14:53:21.034275 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:53:21.044212 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:53:21.044956 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.045471 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:53:21.059704 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-13 14:53:21.076304 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.077223 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:53:21.082823 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:53:21.095192 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-13 14:53:21.114404 (Thread-1): finished collecting timing info
2022-06-13 14:53:21.173874 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.174549 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_tmp" cascade
2022-06-13 14:53:21.175665 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:53:21.180249 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.180806 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-13 14:53:21.181664 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:53:21.187989 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers"
2022-06-13 14:53:21.198985 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.199533 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */

  create view "postgres"."dbt"."v_stg_customers__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    first_name,
    last_name,
    email

    FROM "postgres"."dbt"."source_customers"
),

derived_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(email AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(first_name AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(last_name AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    first_name,
    last_name,
    email,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-13 14:53:21.208361 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-13 14:53:21.225585 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.226298 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
alter table "postgres"."dbt"."v_stg_customers" rename to "v_stg_customers__dbt_backup"
2022-06-13 14:53:21.228432 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:53:21.236275 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.236941 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
alter table "postgres"."dbt"."v_stg_customers__dbt_tmp" rename to "v_stg_customers"
2022-06-13 14:53:21.238605 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:53:21.254825 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-13 14:53:21.255616 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.256275 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: COMMIT
2022-06-13 14:53:21.263226 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-06-13 14:53:21.270084 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers".
2022-06-13 14:53:21.270789 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers"} */
drop view if exists "postgres"."dbt"."v_stg_customers__dbt_backup" cascade
2022-06-13 14:53:21.274251 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:53:21.279009 (Thread-1): finished collecting timing info
2022-06-13 14:53:21.280217 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers: Close
2022-06-13 14:53:21.283414 (Thread-1): 14:53:21 | 1 of 3 OK created view model dbt.v_stg_customers..................... [CREATE VIEW in 0.34s]
2022-06-13 14:53:21.284136 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers
2022-06-13 14:53:21.285047 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_customers_crm
2022-06-13 14:53:21.288491 (Thread-1): 14:53:21 | 2 of 3 START view model dbt.v_stg_customers_crm...................... [RUN]
2022-06-13 14:53:21.289802 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.290732 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_customers_crm
2022-06-13 14:53:21.327550 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.328274 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: BEGIN
2022-06-13 14:53:21.328968 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:53:21.338603 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:53:21.339289 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.339876 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:53:21.350050 (Thread-1): SQL status: SELECT 3 in 0.01 seconds
2022-06-13 14:53:21.359594 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.360426 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_customers_crm'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:53:21.364771 (Thread-1): SQL status: SELECT 3 in 0.00 seconds
2022-06-13 14:53:21.372383 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_customers_crm"
2022-06-13 14:53:21.382831 (Thread-1): finished collecting timing info
2022-06-13 14:53:21.396668 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.397302 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
drop view if exists "postgres"."dbt"."v_stg_customers_crm__dbt_tmp" cascade
2022-06-13 14:53:21.398252 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:53:21.403483 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.404067 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
drop view if exists "postgres"."dbt"."v_stg_customers_crm__dbt_backup" cascade
2022-06-13 14:53:21.404806 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:53:21.407055 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_customers_crm"
2022-06-13 14:53:21.417559 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.418091 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */

  create view "postgres"."dbt"."v_stg_customers_crm__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    country,
    age

    FROM "postgres"."dbt"."source_customers_crm"
),

derived_columns AS (

    SELECT

    id,
    country,
    age,
    id::TEXT AS CUSTOMER_KEY,
    'CSV_CUSTOMERS_CRM'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(age AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(country AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS CUSTOMER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    country,
    age,
    CUSTOMER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    CUSTOMER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *,
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-13 14:53:21.421473 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-06-13 14:53:21.428182 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.428727 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
alter table "postgres"."dbt"."v_stg_customers_crm" rename to "v_stg_customers_crm__dbt_backup"
2022-06-13 14:53:21.429841 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:53:21.434721 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.435285 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
alter table "postgres"."dbt"."v_stg_customers_crm__dbt_tmp" rename to "v_stg_customers_crm"
2022-06-13 14:53:21.436580 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:53:21.439797 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: COMMIT
2022-06-13 14:53:21.440660 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.441383 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: COMMIT
2022-06-13 14:53:21.445146 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:53:21.449158 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_customers_crm".
2022-06-13 14:53:21.449707 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_customers_crm"} */
drop view if exists "postgres"."dbt"."v_stg_customers_crm__dbt_backup" cascade
2022-06-13 14:53:21.452584 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:53:21.456362 (Thread-1): finished collecting timing info
2022-06-13 14:53:21.457078 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_customers_crm: Close
2022-06-13 14:53:21.459273 (Thread-1): 14:53:21 | 2 of 3 OK created view model dbt.v_stg_customers_crm................. [CREATE VIEW in 0.17s]
2022-06-13 14:53:21.459890 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_customers_crm
2022-06-13 14:53:21.460538 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-13 14:53:21.463105 (Thread-1): 14:53:21 | 3 of 3 START view model dbt.v_stg_orders............................. [RUN]
2022-06-13 14:53:21.464000 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.464545 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_stg_orders
2022-06-13 14:53:21.485418 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.486056 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: BEGIN
2022-06-13 14:53:21.486462 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 14:53:21.495092 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:53:21.495685 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.495996 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:53:21.503532 (Thread-1): SQL status: SELECT 4 in 0.01 seconds
2022-06-13 14:53:21.514474 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.515145 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'source_orders'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 14:53:21.518659 (Thread-1): SQL status: SELECT 4 in 0.00 seconds
2022-06-13 14:53:21.526495 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-13 14:53:21.537929 (Thread-1): finished collecting timing info
2022-06-13 14:53:21.550371 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.550930 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_tmp" cascade
2022-06-13 14:53:21.551717 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:53:21.555516 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.555974 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-13 14:53:21.556646 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:53:21.558305 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_stg_orders"
2022-06-13 14:53:21.570098 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.570581 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */

  create view "postgres"."dbt"."v_stg_orders__dbt_tmp" as (
    








WITH staging AS (
-- Generated by dbtvault.



WITH source_data AS (

    SELECT

    id,
    user_id,
    order_date,
    status

    FROM "postgres"."dbt"."source_orders"
),

derived_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    user_id::TEXT AS CUSTOMER_KEY,
    id::TEXT AS ORDER_KEY,
    'CSV_ORDERS'::TEXT AS RECORD_SOURCE

    FROM source_data
),

hashed_columns AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,

    CAST((MD5(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''))) AS TEXT) AS CUSTOMER_PK,
    CAST((MD5(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''))) AS TEXT) AS ORDER_PK,
    CAST(MD5(NULLIF(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(user_id AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(id AS VARCHAR))), ''), '^^')
    ), '^^||^^')) AS TEXT) AS LINK_CUSTOMER_ORDER_PK,
    CAST(MD5(CONCAT_WS('||',
        COALESCE(NULLIF(UPPER(TRIM(CAST(order_date AS VARCHAR))), ''), '^^'),
        COALESCE(NULLIF(UPPER(TRIM(CAST(status AS VARCHAR))), ''), '^^')
    )) AS TEXT) AS ORDER_HASHDIFF

    FROM derived_columns
),

columns_to_select AS (

    SELECT

    id,
    user_id,
    order_date,
    status,
    CUSTOMER_KEY,
    ORDER_KEY,
    RECORD_SOURCE,
    CUSTOMER_PK,
    ORDER_PK,
    LINK_CUSTOMER_ORDER_PK,
    ORDER_HASHDIFF

    FROM hashed_columns
)

SELECT * FROM columns_to_select
)

SELECT *, 
       current_timestamp AS LOAD_DATE,
       current_timestamp AS EFFECTIVE_FROM
FROM staging
  );

2022-06-13 14:53:21.576117 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-13 14:53:21.582603 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.583107 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
alter table "postgres"."dbt"."v_stg_orders" rename to "v_stg_orders__dbt_backup"
2022-06-13 14:53:21.584331 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:53:21.588556 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.589039 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
alter table "postgres"."dbt"."v_stg_orders__dbt_tmp" rename to "v_stg_orders"
2022-06-13 14:53:21.590144 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-13 14:53:21.591971 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-13 14:53:21.592454 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.593184 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: COMMIT
2022-06-13 14:53:21.595209 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:53:21.598471 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_stg_orders".
2022-06-13 14:53:21.598913 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_stg_orders"} */
drop view if exists "postgres"."dbt"."v_stg_orders__dbt_backup" cascade
2022-06-13 14:53:21.601438 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-13 14:53:21.604798 (Thread-1): finished collecting timing info
2022-06-13 14:53:21.605379 (Thread-1): On model.jaffle_shop_dbtvault.v_stg_orders: Close
2022-06-13 14:53:21.607546 (Thread-1): 14:53:21 | 3 of 3 OK created view model dbt.v_stg_orders........................ [CREATE VIEW in 0.14s]
2022-06-13 14:53:21.608177 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_stg_orders
2022-06-13 14:53:21.611170 (MainThread): Acquiring new postgres connection "master".
2022-06-13 14:53:21.611738 (MainThread): Using postgres connection "master".
2022-06-13 14:53:21.612106 (MainThread): On master: BEGIN
2022-06-13 14:53:21.612458 (MainThread): Opening a new connection, currently in state closed
2022-06-13 14:53:21.617829 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-13 14:53:21.618358 (MainThread): On master: COMMIT
2022-06-13 14:53:21.618612 (MainThread): Using postgres connection "master".
2022-06-13 14:53:21.618855 (MainThread): On master: COMMIT
2022-06-13 14:53:21.619364 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 14:53:21.619686 (MainThread): On master: Close
2022-06-13 14:53:21.620411 (MainThread): 14:53:21 | 
2022-06-13 14:53:21.620916 (MainThread): 14:53:21 | Finished running 3 view models in 0.96s.
2022-06-13 14:53:21.622066 (MainThread): Connection 'master' was properly closed.
2022-06-13 14:53:21.622973 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_stg_orders' was properly closed.
2022-06-13 14:53:21.768356 (MainThread): 
2022-06-13 14:53:21.768849 (MainThread): Completed successfully
2022-06-13 14:53:21.769828 (MainThread): 
Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
2022-06-13 14:53:21.770981 (MainThread): Flushing usage events
2022-06-13 19:55:03.809192 (MainThread): Running with dbt=0.19.0
2022-06-13 19:55:04.169721 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:satellite'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-13 19:55:04.181322 (MainThread): Tracking: do not track
2022-06-13 19:55:05.861287 (MainThread): Got an acceptable cached parse result
2022-06-13 19:55:06.183073 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_customer_crm".
2022-06-13 19:55:08.704428 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-13 19:55:08.712072 (MainThread): 
2022-06-13 19:55:08.718059 (MainThread): Acquiring new postgres connection "master".
2022-06-13 19:55:08.734058 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-13 19:55:08.782202 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-13 19:55:08.783460 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-13 19:55:08.785104 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-13 19:55:08.861418 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.08 seconds
2022-06-13 19:55:08.874884 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-13 19:55:08.932648 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-13 19:55:08.946604 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 19:55:08.947331 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-13 19:55:08.947765 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-13 19:55:08.960253 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-13 19:55:08.961034 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-13 19:55:08.961712 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-13 19:55:08.975548 (ThreadPoolExecutor-1_0): SQL status: SELECT 14 in 0.01 seconds
2022-06-13 19:55:09.003660 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-13 19:55:09.005431 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-13 19:55:09.102089 (MainThread): Using postgres connection "master".
2022-06-13 19:55:09.103440 (MainThread): On master: BEGIN
2022-06-13 19:55:09.104264 (MainThread): Opening a new connection, currently in state init
2022-06-13 19:55:09.150323 (MainThread): SQL status: BEGIN in 0.05 seconds
2022-06-13 19:55:09.151125 (MainThread): Using postgres connection "master".
2022-06-13 19:55:09.151568 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-13 19:55:09.227056 (MainThread): SQL status: SELECT 6 in 0.07 seconds
2022-06-13 19:55:09.256956 (MainThread): On master: ROLLBACK
2022-06-13 19:55:09.259287 (MainThread): Using postgres connection "master".
2022-06-13 19:55:09.260940 (MainThread): On master: BEGIN
2022-06-13 19:55:09.263741 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-13 19:55:09.264631 (MainThread): On master: COMMIT
2022-06-13 19:55:09.265958 (MainThread): Using postgres connection "master".
2022-06-13 19:55:09.266900 (MainThread): On master: COMMIT
2022-06-13 19:55:09.268004 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 19:55:09.268716 (MainThread): On master: Close
2022-06-13 19:55:09.270527 (MainThread): 19:55:09 | Concurrency: 1 threads (target='dev')
2022-06-13 19:55:09.271907 (MainThread): 19:55:09 | 
2022-06-13 19:55:09.281648 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_customer_crm
2022-06-13 19:55:09.285222 (Thread-1): 19:55:09 | 1 of 3 START incremental model dbt.sat_customer_crm.................. [RUN]
2022-06-13 19:55:09.286885 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_customer_crm".
2022-06-13 19:55:09.288027 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_customer_crm
2022-06-13 19:55:09.351905 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_customer_crm"
2022-06-13 19:55:09.369598 (Thread-1): finished collecting timing info
2022-06-13 19:55:09.462344 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_customer_crm"
2022-06-13 19:55:09.490282 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_crm".
2022-06-13 19:55:09.491503 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_crm: BEGIN
2022-06-13 19:55:09.492696 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 19:55:09.506308 (Thread-1): SQL status: BEGIN in 0.01 seconds
2022-06-13 19:55:09.507357 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_crm".
2022-06-13 19:55:09.508266 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_crm: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_crm"} */

      

  create  table "postgres"."dbt"."sat_customer_crm"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.country, a.age, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_customers_crm" AS a
),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.country, e.age, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
)

SELECT * FROM records_to_insert
  );
  
2022-06-13 19:55:09.542479 (Thread-1): SQL status: SELECT 5 in 0.03 seconds
2022-06-13 19:55:09.569415 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_crm: COMMIT
2022-06-13 19:55:09.570434 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_crm".
2022-06-13 19:55:09.571269 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_crm: COMMIT
2022-06-13 19:55:09.575568 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 19:55:09.582082 (Thread-1): finished collecting timing info
2022-06-13 19:55:09.583207 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_crm: Close
2022-06-13 19:55:09.588979 (Thread-1): 19:55:09 | 1 of 3 OK created incremental model dbt.sat_customer_crm............. [SELECT 5 in 0.30s]
2022-06-13 19:55:09.589979 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_customer_crm
2022-06-13 19:55:09.591172 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_customer_details
2022-06-13 19:55:09.595968 (Thread-1): 19:55:09 | 2 of 3 START incremental model dbt.sat_customer_details.............. [RUN]
2022-06-13 19:55:09.597590 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-13 19:55:09.598705 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_customer_details
2022-06-13 19:55:09.682475 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-06-13 19:55:09.718682 (Thread-1): finished collecting timing info
2022-06-13 19:55:09.757691 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-13 19:55:09.758530 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

    

  create temporary table "sat_customer_details__dbt_tmp195509747296"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_customers" AS a
),

update_records AS (
    SELECT a.CUSTOMER_PK, a.CUSTOMER_HASHDIFF, a.first_name, a.last_name, a.email, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."sat_customer_details" as a
    JOIN source_data as b
    ON a.CUSTOMER_PK = b.CUSTOMER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.CUSTOMER_PK, c.CUSTOMER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.CUSTOMER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.CUSTOMER_PK, e.CUSTOMER_HASHDIFF, e.first_name, e.last_name, e.email, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.CUSTOMER_HASHDIFF = e.CUSTOMER_HASHDIFF
    WHERE latest_records.CUSTOMER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-13 19:55:09.759092 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 19:55:09.783316 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-06-13 19:55:09.806298 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-13 19:55:09.807359 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: BEGIN
2022-06-13 19:55:09.809564 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-13 19:55:09.810757 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-13 19:55:09.812064 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details__dbt_tmp195509747296'
        
      order by ordinal_position

  
2022-06-13 19:55:09.837651 (Thread-1): SQL status: SELECT 8 in 0.02 seconds
2022-06-13 19:55:09.859507 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-13 19:55:09.860530 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 19:55:09.868614 (Thread-1): SQL status: SELECT 8 in 0.01 seconds
2022-06-13 19:55:09.894950 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-13 19:55:09.896538 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_customer_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 19:55:09.909561 (Thread-1): SQL status: SELECT 8 in 0.01 seconds
2022-06-13 19:55:09.914077 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_customer_details"
2022-06-13 19:55:09.959879 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-13 19:55:09.963797 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_customer_details"} */

      

    insert into "postgres"."dbt"."sat_customer_details" ("customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source")
    (
       select "customer_pk", "customer_hashdiff", "first_name", "last_name", "email", "effective_from", "load_date", "record_source"
       from "sat_customer_details__dbt_tmp195509747296"
    );
  
2022-06-13 19:55:09.969358 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-13 19:55:09.981408 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-06-13 19:55:09.985805 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_customer_details".
2022-06-13 19:55:09.989299 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: COMMIT
2022-06-13 19:55:09.995321 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 19:55:10.001921 (Thread-1): finished collecting timing info
2022-06-13 19:55:10.003329 (Thread-1): On model.jaffle_shop_dbtvault.sat_customer_details: Close
2022-06-13 19:55:10.010375 (Thread-1): 19:55:09 | 2 of 3 OK created incremental model dbt.sat_customer_details......... [INSERT 0 0 in 0.41s]
2022-06-13 19:55:10.011995 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_customer_details
2022-06-13 19:55:10.014032 (Thread-1): Began running node model.jaffle_shop_dbtvault.sat_order_details
2022-06-13 19:55:10.020694 (Thread-1): 19:55:10 | 3 of 3 START incremental model dbt.sat_order_details................. [RUN]
2022-06-13 19:55:10.022543 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-13 19:55:10.023864 (Thread-1): Compiling model.jaffle_shop_dbtvault.sat_order_details
2022-06-13 19:55:10.073640 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-06-13 19:55:10.089064 (Thread-1): finished collecting timing info
2022-06-13 19:55:10.123700 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-13 19:55:10.124857 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

    

  create temporary table "sat_order_details__dbt_tmp195510118417"
  as (
    -- Generated by dbtvault.

WITH source_data AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."v_stg_orders" AS a
),

update_records AS (
    SELECT a.ORDER_PK, a.ORDER_HASHDIFF, a.order_date, a.status, a.EFFECTIVE_FROM, a.LOAD_DATE, a.RECORD_SOURCE
    FROM "postgres"."dbt"."sat_order_details" as a
    JOIN source_data as b
    ON a.ORDER_PK = b.ORDER_PK
),

latest_records AS (

SELECT * FROM (    
    SELECT c.ORDER_PK, c.ORDER_HASHDIFF, c.LOAD_DATE,
           CASE WHEN RANK()
           OVER (PARTITION BY c.ORDER_PK
           ORDER BY c.LOAD_DATE DESC) = 1
    THEN 'Y' ELSE 'N' END AS latest
    FROM update_records as c
) as s
WHERE latest = 'Y'

),

records_to_insert AS (
    SELECT DISTINCT e.ORDER_PK, e.ORDER_HASHDIFF, e.order_date, e.status, e.EFFECTIVE_FROM, e.LOAD_DATE, e.RECORD_SOURCE
    FROM source_data AS e
    LEFT JOIN latest_records
    ON latest_records.ORDER_HASHDIFF = e.ORDER_HASHDIFF
    WHERE latest_records.ORDER_HASHDIFF IS NULL
)

SELECT * FROM records_to_insert
  );
  
2022-06-13 19:55:10.125786 (Thread-1): Opening a new connection, currently in state closed
2022-06-13 19:55:10.150121 (Thread-1): SQL status: SELECT 0 in 0.02 seconds
2022-06-13 19:55:10.164356 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-13 19:55:10.165588 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: BEGIN
2022-06-13 19:55:10.167559 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-13 19:55:10.168717 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-13 19:55:10.169515 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details__dbt_tmp195510118417'
        
      order by ordinal_position

  
2022-06-13 19:55:10.184679 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-06-13 19:55:10.196575 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-13 19:55:10.197957 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 19:55:10.204496 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-06-13 19:55:10.217080 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-13 19:55:10.218442 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "postgres".INFORMATION_SCHEMA.columns
      where table_name = 'sat_order_details'
        
        and table_schema = 'dbt'
        
      order by ordinal_position

  
2022-06-13 19:55:10.226473 (Thread-1): SQL status: SELECT 7 in 0.01 seconds
2022-06-13 19:55:10.228846 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.sat_order_details"
2022-06-13 19:55:10.248836 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-13 19:55:10.249927 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.sat_order_details"} */

      

    insert into "postgres"."dbt"."sat_order_details" ("order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source")
    (
       select "order_pk", "order_hashdiff", "order_date", "status", "effective_from", "load_date", "record_source"
       from "sat_order_details__dbt_tmp195510118417"
    );
  
2022-06-13 19:55:10.252399 (Thread-1): SQL status: INSERT 0 0 in 0.00 seconds
2022-06-13 19:55:10.256668 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-06-13 19:55:10.257946 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.sat_order_details".
2022-06-13 19:55:10.259156 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: COMMIT
2022-06-13 19:55:10.262390 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-13 19:55:10.266789 (Thread-1): finished collecting timing info
2022-06-13 19:55:10.267866 (Thread-1): On model.jaffle_shop_dbtvault.sat_order_details: Close
2022-06-13 19:55:10.271796 (Thread-1): 19:55:10 | 3 of 3 OK created incremental model dbt.sat_order_details............ [INSERT 0 0 in 0.25s]
2022-06-13 19:55:10.273003 (Thread-1): Finished running node model.jaffle_shop_dbtvault.sat_order_details
2022-06-13 19:55:10.282207 (MainThread): Acquiring new postgres connection "master".
2022-06-13 19:55:10.283334 (MainThread): Using postgres connection "master".
2022-06-13 19:55:10.284433 (MainThread): On master: BEGIN
2022-06-13 19:55:10.285472 (MainThread): Opening a new connection, currently in state closed
2022-06-13 19:55:10.300922 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-06-13 19:55:10.302122 (MainThread): On master: COMMIT
2022-06-13 19:55:10.303230 (MainThread): Using postgres connection "master".
2022-06-13 19:55:10.304442 (MainThread): On master: COMMIT
2022-06-13 19:55:10.306183 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-13 19:55:10.307221 (MainThread): On master: Close
2022-06-13 19:55:10.308989 (MainThread): 19:55:10 | 
2022-06-13 19:55:10.310344 (MainThread): 19:55:10 | Finished running 3 incremental models in 1.59s.
2022-06-13 19:55:10.311766 (MainThread): Connection 'master' was properly closed.
2022-06-13 19:55:10.312974 (MainThread): Connection 'model.jaffle_shop_dbtvault.sat_order_details' was properly closed.
2022-06-13 19:55:10.600647 (MainThread): 
2022-06-13 19:55:10.601804 (MainThread): Completed successfully
2022-06-13 19:55:10.603057 (MainThread): 
Done. PASS=3 WARN=0 ERROR=0 SKIP=0 TOTAL=3
2022-06-13 19:55:10.604970 (MainThread): Flushing usage events
2022-06-16 15:16:36.429083 (MainThread): Running with dbt=0.19.0
2022-06-16 15:16:36.834056 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:16:36.848080 (MainThread): Tracking: do not track
2022-06-16 15:16:39.304622 (MainThread): Got an acceptable cached parse result
2022-06-16 15:16:39.652151 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:16:42.267369 (MainThread): Flushing usage events
2022-06-16 15:16:42.268398 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_pit_customer' was properly closed.
2022-06-16 15:16:42.269285 (MainThread): Encountered an error:
2022-06-16 15:16:42.270487 (MainThread): Compilation Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  Model 'model.jaffle_shop_dbtvault.v_pit_customer' (models/marts/v_pit_customer.sql) depends on a node named 'sat_customer_crm scc' which was not found
2022-06-16 15:16:42.288753 (MainThread): Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/main.py", line 125, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/lib/python3.8/site-packages/dbt/main.py", line 203, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/lib/python3.8/site-packages/dbt/main.py", line 256, in run_from_args
    results = task.run()
  File "/usr/local/lib/python3.8/site-packages/dbt/task/runnable.py", line 406, in run
    self._runtime_initialize()
  File "/usr/local/lib/python3.8/site-packages/dbt/task/runnable.py", line 122, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/lib/python3.8/site-packages/dbt/task/runnable.py", line 79, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/lib/python3.8/site-packages/dbt/task/runnable.py", line 66, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 854, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 436, in load_all
    manifest = loader.create_manifest()
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 414, in create_manifest
    self.process_manifest(manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 380, in process_manifest
    process_refs(manifest, project_name)
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 750, in process_refs
    _process_refs_for_node(manifest, current_project, node)
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 732, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 475, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/usr/local/lib/python3.8/site-packages/dbt/exceptions.py", line 566, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/site-packages/dbt/exceptions.py", line 435, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  Model 'model.jaffle_shop_dbtvault.v_pit_customer' (models/marts/v_pit_customer.sql) depends on a node named 'sat_customer_crm scc' which was not found

2022-06-16 15:19:29.097789 (MainThread): Running with dbt=0.19.0
2022-06-16 15:19:29.483935 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:19:29.494771 (MainThread): Tracking: do not track
2022-06-16 15:19:31.322391 (MainThread): Got an acceptable cached parse result
2022-06-16 15:19:31.580144 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:19:34.456118 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:19:34.461263 (MainThread): 
2022-06-16 15:19:34.463430 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:19:34.473408 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:19:34.500132 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:19:34.501074 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:19:34.501828 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:19:34.614818 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.11 seconds
2022-06-16 15:19:34.621164 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:19:34.679239 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:19:34.701582 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:19:34.702635 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:19:34.703572 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:19:34.745442 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.04 seconds
2022-06-16 15:19:34.746718 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:19:34.748035 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:19:34.780651 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.03 seconds
2022-06-16 15:19:34.819835 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:19:34.821649 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:19:34.901634 (MainThread): Using postgres connection "master".
2022-06-16 15:19:34.902837 (MainThread): On master: BEGIN
2022-06-16 15:19:34.903675 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:19:34.954700 (MainThread): SQL status: BEGIN in 0.05 seconds
2022-06-16 15:19:34.955994 (MainThread): Using postgres connection "master".
2022-06-16 15:19:34.956995 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:19:35.051940 (MainThread): SQL status: SELECT 6 in 0.09 seconds
2022-06-16 15:19:35.068262 (MainThread): On master: ROLLBACK
2022-06-16 15:19:35.069850 (MainThread): Using postgres connection "master".
2022-06-16 15:19:35.070617 (MainThread): On master: BEGIN
2022-06-16 15:19:35.072266 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:19:35.073158 (MainThread): On master: COMMIT
2022-06-16 15:19:35.073995 (MainThread): Using postgres connection "master".
2022-06-16 15:19:35.074596 (MainThread): On master: COMMIT
2022-06-16 15:19:35.075780 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:19:35.076901 (MainThread): On master: Close
2022-06-16 15:19:35.078388 (MainThread): 15:19:35 | Concurrency: 1 threads (target='dev')
2022-06-16 15:19:35.079465 (MainThread): 15:19:35 | 
2022-06-16 15:19:35.092323 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:19:35.095120 (Thread-1): 15:19:35 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:19:35.096431 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:19:35.097455 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:19:35.137281 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:19:35.166514 (Thread-1): finished collecting timing info
2022-06-16 15:19:35.248012 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:19:35.249251 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:19:35.250490 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:19:35.274809 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-06-16 15:19:35.281781 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:19:35.282957 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:19:35.284798 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:19:35.300000 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:19:35.326890 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:19:35.327727 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:19:35.329271 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:19:35.330229 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:19:35.330914 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select t.*, coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from--, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_order_details"
 ) t
),
cust_details_periods as (
	select t.sat_customer_details.*, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email,
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:19:35.332954 (Thread-1): Postgres error: syntax error at or near "from"
LINE 23:   from all_periods ap
           ^

2022-06-16 15:19:35.333815 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:19:35.335212 (Thread-1): finished collecting timing info
2022-06-16 15:19:35.336428 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:19:35.337812 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  syntax error at or near "from"
  LINE 23:   from all_periods ap
             ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: syntax error at or near "from"
LINE 23:   from all_periods ap
           ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  syntax error at or near "from"
  LINE 23:   from all_periods ap
             ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:19:35.356131 (Thread-1): 15:19:35 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.26s]
2022-06-16 15:19:35.357253 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:19:35.358118 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:19:35.363488 (Thread-1): 15:19:35 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:19:35.365304 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:19:35.366366 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:19:35.384099 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:19:35.412381 (Thread-1): finished collecting timing info
2022-06-16 15:19:35.434872 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:19:35.436173 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:19:35.437199 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:19:35.464277 (Thread-1): SQL status: DROP VIEW in 0.03 seconds
2022-06-16 15:19:35.475016 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:19:35.476157 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:19:35.478062 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:19:35.483160 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:19:35.511510 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:19:35.512700 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:19:35.514774 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:19:35.516015 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:19:35.517035 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:19:35.569932 (Thread-1): SQL status: CREATE VIEW in 0.05 seconds
2022-06-16 15:19:35.600322 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:19:35.601686 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:19:35.606494 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:19:35.617044 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:19:35.618420 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:19:35.620525 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:19:35.642291 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:19:35.643781 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:19:35.644715 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:19:35.652560 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-06-16 15:19:35.665695 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:19:35.666989 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:19:35.680011 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:19:35.688403 (Thread-1): finished collecting timing info
2022-06-16 15:19:35.690328 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:19:35.696771 (Thread-1): 15:19:35 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.33s]
2022-06-16 15:19:35.698147 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:19:35.703672 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:19:35.705400 (MainThread): Using postgres connection "master".
2022-06-16 15:19:35.706730 (MainThread): On master: BEGIN
2022-06-16 15:19:35.708203 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:19:35.723104 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:19:35.724545 (MainThread): On master: COMMIT
2022-06-16 15:19:35.725615 (MainThread): Using postgres connection "master".
2022-06-16 15:19:35.726698 (MainThread): On master: COMMIT
2022-06-16 15:19:35.728359 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:19:35.729527 (MainThread): On master: Close
2022-06-16 15:19:35.731332 (MainThread): 15:19:35 | 
2022-06-16 15:19:35.732634 (MainThread): 15:19:35 | Finished running 2 view models in 1.27s.
2022-06-16 15:19:35.734008 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:19:35.735620 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:19:36.051764 (MainThread): 
2022-06-16 15:19:36.053193 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:19:36.054435 (MainThread): 
2022-06-16 15:19:36.056192 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:19:36.058088 (MainThread):   syntax error at or near "from"
2022-06-16 15:19:36.060030 (MainThread):   LINE 23:   from all_periods ap
2022-06-16 15:19:36.061472 (MainThread):              ^
2022-06-16 15:19:36.063775 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:19:36.066436 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:19:36.068472 (MainThread): Flushing usage events
2022-06-16 15:20:32.828888 (MainThread): Running with dbt=0.19.0
2022-06-16 15:20:33.122425 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:20:33.131991 (MainThread): Tracking: do not track
2022-06-16 15:20:34.236646 (MainThread): Got an acceptable cached parse result
2022-06-16 15:20:34.525486 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:20:36.978268 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:20:36.984008 (MainThread): 
2022-06-16 15:20:36.986970 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:20:36.998379 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:20:37.035581 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:20:37.036793 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:20:37.037757 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:20:37.117905 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.08 seconds
2022-06-16 15:20:37.126743 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:20:37.178062 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:20:37.200595 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:20:37.201968 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:20:37.203505 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:20:37.224665 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-06-16 15:20:37.225815 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:20:37.226777 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:20:37.237373 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:20:37.275749 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:20:37.277412 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:20:37.331466 (MainThread): Using postgres connection "master".
2022-06-16 15:20:37.332583 (MainThread): On master: BEGIN
2022-06-16 15:20:37.333302 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:20:37.384483 (MainThread): SQL status: BEGIN in 0.05 seconds
2022-06-16 15:20:37.385717 (MainThread): Using postgres connection "master".
2022-06-16 15:20:37.386723 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:20:37.451590 (MainThread): SQL status: SELECT 6 in 0.06 seconds
2022-06-16 15:20:37.468027 (MainThread): On master: ROLLBACK
2022-06-16 15:20:37.469398 (MainThread): Using postgres connection "master".
2022-06-16 15:20:37.470102 (MainThread): On master: BEGIN
2022-06-16 15:20:37.472093 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:20:37.473021 (MainThread): On master: COMMIT
2022-06-16 15:20:37.473707 (MainThread): Using postgres connection "master".
2022-06-16 15:20:37.474319 (MainThread): On master: COMMIT
2022-06-16 15:20:37.475377 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:20:37.476065 (MainThread): On master: Close
2022-06-16 15:20:37.477242 (MainThread): 15:20:37 | Concurrency: 1 threads (target='dev')
2022-06-16 15:20:37.478123 (MainThread): 15:20:37 | 
2022-06-16 15:20:37.490711 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:20:37.496408 (Thread-1): 15:20:37 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:20:37.498258 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:20:37.499181 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:20:37.561065 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:20:37.586006 (Thread-1): finished collecting timing info
2022-06-16 15:20:37.668644 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:20:37.669740 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:20:37.670633 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:20:37.683537 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:20:37.689914 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:20:37.690898 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:20:37.692281 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:20:37.701046 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:20:37.721811 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:20:37.723094 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:20:37.724948 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:20:37.725818 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:20:37.726425 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select t.*, coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from--, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_order_details"
 ) t
),
cust_details_periods as (
	select t.sat_customer_details.*, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:20:37.733150 (Thread-1): Postgres error: column "customer_pk" does not exist
LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                      ^

2022-06-16 15:20:37.734393 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:20:37.736851 (Thread-1): finished collecting timing info
2022-06-16 15:20:37.739007 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:20:37.741000 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  column "customer_pk" does not exist
  LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                        ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "customer_pk" does not exist
LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                      ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  column "customer_pk" does not exist
  LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                        ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:20:37.749911 (Thread-1): 15:20:37 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.25s]
2022-06-16 15:20:37.751181 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:20:37.752300 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:20:37.757312 (Thread-1): 15:20:37 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:20:37.760064 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:20:37.761293 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:20:37.789653 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:20:37.815017 (Thread-1): finished collecting timing info
2022-06-16 15:20:37.842611 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:20:37.843863 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:20:37.845195 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:20:37.861914 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-06-16 15:20:37.868452 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:20:37.869463 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:20:37.872090 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:20:37.878023 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:20:37.906902 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:20:37.908050 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:20:37.909680 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:20:37.910820 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:20:37.911561 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:20:37.917930 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-16 15:20:37.954512 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:20:37.955609 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:20:37.957452 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:20:37.969071 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:20:37.970228 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:20:37.972676 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:20:37.998380 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:20:37.999461 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:20:38.000196 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:20:38.003583 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:20:38.011872 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:20:38.012823 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:20:38.018566 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:20:38.027704 (Thread-1): finished collecting timing info
2022-06-16 15:20:38.030480 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:20:38.035133 (Thread-1): 15:20:38 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.27s]
2022-06-16 15:20:38.036153 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:20:38.041303 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:20:38.042285 (MainThread): Using postgres connection "master".
2022-06-16 15:20:38.043031 (MainThread): On master: BEGIN
2022-06-16 15:20:38.043757 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:20:38.055740 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:20:38.056830 (MainThread): On master: COMMIT
2022-06-16 15:20:38.057676 (MainThread): Using postgres connection "master".
2022-06-16 15:20:38.058394 (MainThread): On master: COMMIT
2022-06-16 15:20:38.059657 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:20:38.060523 (MainThread): On master: Close
2022-06-16 15:20:38.061810 (MainThread): 15:20:38 | 
2022-06-16 15:20:38.062550 (MainThread): 15:20:38 | Finished running 2 view models in 1.08s.
2022-06-16 15:20:38.063466 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:20:38.064676 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:20:38.333715 (MainThread): 
2022-06-16 15:20:38.334833 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:20:38.335829 (MainThread): 
2022-06-16 15:20:38.336875 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:20:38.337881 (MainThread):   column "customer_pk" does not exist
2022-06-16 15:20:38.338849 (MainThread):   LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
2022-06-16 15:20:38.339883 (MainThread):                         ^
2022-06-16 15:20:38.340781 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:20:38.341674 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:20:38.342740 (MainThread): Flushing usage events
2022-06-16 15:21:24.383597 (MainThread): Running with dbt=0.19.0
2022-06-16 15:21:24.798786 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:21:24.817850 (MainThread): Tracking: do not track
2022-06-16 15:21:26.626740 (MainThread): Got an acceptable cached parse result
2022-06-16 15:21:26.956936 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:21:30.109722 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:21:30.114076 (MainThread): 
2022-06-16 15:21:30.116293 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:21:30.148200 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:21:30.181071 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:21:30.182058 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:21:30.183228 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:21:30.202719 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.02 seconds
2022-06-16 15:21:30.209260 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:21:30.252242 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:21:30.276690 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:21:30.277809 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:21:30.279006 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:21:30.302590 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.02 seconds
2022-06-16 15:21:30.303527 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:21:30.304438 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:21:30.313647 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:21:30.349410 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:21:30.350577 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:21:30.417921 (MainThread): Using postgres connection "master".
2022-06-16 15:21:30.419022 (MainThread): On master: BEGIN
2022-06-16 15:21:30.420179 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:21:30.431814 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:21:30.432805 (MainThread): Using postgres connection "master".
2022-06-16 15:21:30.433712 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:21:30.501215 (MainThread): SQL status: SELECT 6 in 0.07 seconds
2022-06-16 15:21:30.519313 (MainThread): On master: ROLLBACK
2022-06-16 15:21:30.520687 (MainThread): Using postgres connection "master".
2022-06-16 15:21:30.521573 (MainThread): On master: BEGIN
2022-06-16 15:21:30.523324 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:21:30.524125 (MainThread): On master: COMMIT
2022-06-16 15:21:30.525164 (MainThread): Using postgres connection "master".
2022-06-16 15:21:30.526072 (MainThread): On master: COMMIT
2022-06-16 15:21:30.527063 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:21:30.528050 (MainThread): On master: Close
2022-06-16 15:21:30.529736 (MainThread): 15:21:30 | Concurrency: 1 threads (target='dev')
2022-06-16 15:21:30.531054 (MainThread): 15:21:30 | 
2022-06-16 15:21:30.540734 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:21:30.546666 (Thread-1): 15:21:30 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:21:30.548317 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:21:30.549514 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:21:30.604615 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:21:30.626147 (Thread-1): finished collecting timing info
2022-06-16 15:21:30.727124 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:21:30.728092 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:21:30.728648 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:21:30.743303 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:21:30.750643 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:21:30.751315 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:21:30.752324 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:21:30.762136 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:21:30.776967 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:21:30.777705 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:21:30.779380 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:21:30.780550 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:21:30.781303 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select t.*, coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from--, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_order_details"   )
 ) t
),
cust_details_periods as (
	select t.sat_customer_details.*, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:21:30.783775 (Thread-1): Postgres error: subquery in FROM must have an alias
LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
              ^
HINT:  For example, FROM (SELECT ...) [AS] foo.

2022-06-16 15:21:30.784567 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:21:30.785624 (Thread-1): finished collecting timing info
2022-06-16 15:21:30.786578 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:21:30.787730 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  subquery in FROM must have an alias
  LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.SyntaxError: subquery in FROM must have an alias
LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
              ^
HINT:  For example, FROM (SELECT ...) [AS] foo.


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  subquery in FROM must have an alias
  LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                ^
  HINT:  For example, FROM (SELECT ...) [AS] foo.
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:21:30.792764 (Thread-1): 15:21:30 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.24s]
2022-06-16 15:21:30.793568 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:21:30.794753 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:21:30.798933 (Thread-1): 15:21:30 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:21:30.800030 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:21:30.800702 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:21:30.833746 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:21:30.854118 (Thread-1): finished collecting timing info
2022-06-16 15:21:30.874855 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:21:30.875586 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:21:30.876109 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:21:30.885033 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:21:30.892030 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:21:30.892695 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:21:30.893755 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:21:30.898263 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:21:30.920363 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:21:30.921192 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:21:30.923128 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:21:30.924094 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:21:30.924830 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:21:30.929581 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-06-16 15:21:30.950734 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:21:30.951427 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:21:30.952696 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:21:30.960075 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:21:30.960890 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:21:30.962497 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:21:30.976826 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:21:30.977710 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:21:30.978272 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:21:30.982071 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:21:30.992583 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:21:30.993512 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:21:30.997288 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:21:31.003667 (Thread-1): finished collecting timing info
2022-06-16 15:21:31.004958 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:21:31.008777 (Thread-1): 15:21:30 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.21s]
2022-06-16 15:21:31.009857 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:21:31.015101 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:21:31.016262 (MainThread): Using postgres connection "master".
2022-06-16 15:21:31.017042 (MainThread): On master: BEGIN
2022-06-16 15:21:31.018509 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:21:31.032399 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:21:31.033285 (MainThread): On master: COMMIT
2022-06-16 15:21:31.033930 (MainThread): Using postgres connection "master".
2022-06-16 15:21:31.034591 (MainThread): On master: COMMIT
2022-06-16 15:21:31.035924 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:21:31.036878 (MainThread): On master: Close
2022-06-16 15:21:31.038943 (MainThread): 15:21:31 | 
2022-06-16 15:21:31.040340 (MainThread): 15:21:31 | Finished running 2 view models in 0.92s.
2022-06-16 15:21:31.041598 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:21:31.042786 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:21:31.265524 (MainThread): 
2022-06-16 15:21:31.266623 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:21:31.267937 (MainThread): 
2022-06-16 15:21:31.269207 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:21:31.270406 (MainThread):   subquery in FROM must have an alias
2022-06-16 15:21:31.271597 (MainThread):   LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
2022-06-16 15:21:31.273004 (MainThread):                 ^
2022-06-16 15:21:31.274054 (MainThread):   HINT:  For example, FROM (SELECT ...) [AS] foo.
2022-06-16 15:21:31.275253 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:21:31.276364 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:21:31.277923 (MainThread): Flushing usage events
2022-06-16 15:22:09.345330 (MainThread): Running with dbt=0.19.0
2022-06-16 15:22:09.696399 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:22:09.706221 (MainThread): Tracking: do not track
2022-06-16 15:22:11.187134 (MainThread): Got an acceptable cached parse result
2022-06-16 15:22:11.427426 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:22:14.311494 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:22:14.316998 (MainThread): 
2022-06-16 15:22:14.319665 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:22:14.333744 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:22:14.371071 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:22:14.372180 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:22:14.373386 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:22:14.428227 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.05 seconds
2022-06-16 15:22:14.438257 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:22:14.499054 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:22:14.521848 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:22:14.523143 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:22:14.524064 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:22:14.537421 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:22:14.538709 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:22:14.539599 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:22:14.545914 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:22:14.584548 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:22:14.586497 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:22:14.662175 (MainThread): Using postgres connection "master".
2022-06-16 15:22:14.663369 (MainThread): On master: BEGIN
2022-06-16 15:22:14.664273 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:22:14.678228 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:22:14.679552 (MainThread): Using postgres connection "master".
2022-06-16 15:22:14.680516 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:22:14.761254 (MainThread): SQL status: SELECT 6 in 0.08 seconds
2022-06-16 15:22:14.783618 (MainThread): On master: ROLLBACK
2022-06-16 15:22:14.785091 (MainThread): Using postgres connection "master".
2022-06-16 15:22:14.785998 (MainThread): On master: BEGIN
2022-06-16 15:22:14.787370 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:22:14.788272 (MainThread): On master: COMMIT
2022-06-16 15:22:14.789024 (MainThread): Using postgres connection "master".
2022-06-16 15:22:14.789702 (MainThread): On master: COMMIT
2022-06-16 15:22:14.790837 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:22:14.791645 (MainThread): On master: Close
2022-06-16 15:22:14.792881 (MainThread): 15:22:14 | Concurrency: 1 threads (target='dev')
2022-06-16 15:22:14.793929 (MainThread): 15:22:14 | 
2022-06-16 15:22:14.834170 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:22:14.836871 (Thread-1): 15:22:14 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:22:14.838353 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:22:14.839254 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:22:14.911284 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:22:14.930840 (Thread-1): finished collecting timing info
2022-06-16 15:22:15.031126 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:22:15.032377 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:22:15.033340 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:22:15.046987 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:22:15.059229 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:22:15.060367 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:22:15.062171 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:22:15.079845 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:22:15.102802 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:22:15.103668 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:22:15.105116 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:22:15.106114 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:22:15.106916 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select t.*, coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from--, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_order_details"   ) t
),
cust_details_periods as (
	select t.sat_customer_details.*, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:22:15.108820 (Thread-1): Postgres error: column "customer_pk" does not exist
LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                      ^

2022-06-16 15:22:15.109791 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:22:15.111089 (Thread-1): finished collecting timing info
2022-06-16 15:22:15.112314 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:22:15.113743 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  column "customer_pk" does not exist
  LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                        ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column "customer_pk" does not exist
LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                      ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  column "customer_pk" does not exist
  LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
                        ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:22:15.118783 (Thread-1): 15:22:15 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.28s]
2022-06-16 15:22:15.119620 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:22:15.120372 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:22:15.123000 (Thread-1): 15:22:15 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:22:15.124326 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:22:15.125069 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:22:15.143673 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:22:15.165630 (Thread-1): finished collecting timing info
2022-06-16 15:22:15.195173 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:22:15.196437 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:22:15.197389 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:22:15.246368 (Thread-1): SQL status: DROP VIEW in 0.05 seconds
2022-06-16 15:22:15.257890 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:22:15.259274 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:22:15.261379 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:22:15.266034 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:22:15.297335 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:22:15.298801 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:22:15.300958 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:22:15.302203 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:22:15.303323 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:22:15.314573 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-16 15:22:15.348247 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:22:15.349402 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:22:15.351666 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:22:15.362073 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:22:15.363330 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:22:15.365700 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:22:15.388556 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:22:15.389907 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:22:15.390961 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:22:15.395376 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:22:15.409095 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:22:15.410338 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:22:15.415300 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:22:15.423744 (Thread-1): finished collecting timing info
2022-06-16 15:22:15.425768 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:22:15.431799 (Thread-1): 15:22:15 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.30s]
2022-06-16 15:22:15.433199 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:22:15.438176 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:22:15.439408 (MainThread): Using postgres connection "master".
2022-06-16 15:22:15.440494 (MainThread): On master: BEGIN
2022-06-16 15:22:15.441534 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:22:15.455634 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:22:15.456903 (MainThread): On master: COMMIT
2022-06-16 15:22:15.457898 (MainThread): Using postgres connection "master".
2022-06-16 15:22:15.458895 (MainThread): On master: COMMIT
2022-06-16 15:22:15.460455 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:22:15.461663 (MainThread): On master: Close
2022-06-16 15:22:15.463597 (MainThread): 15:22:15 | 
2022-06-16 15:22:15.464877 (MainThread): 15:22:15 | Finished running 2 view models in 1.14s.
2022-06-16 15:22:15.466199 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:22:15.467835 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:22:15.792116 (MainThread): 
2022-06-16 15:22:15.793537 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:22:15.794907 (MainThread): 
2022-06-16 15:22:15.796905 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:22:15.799656 (MainThread):   column "customer_pk" does not exist
2022-06-16 15:22:15.802013 (MainThread):   LINE 8:  from (select customer_pk, effective_from--, customer_hashdi...
2022-06-16 15:22:15.803704 (MainThread):                         ^
2022-06-16 15:22:15.805449 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:22:15.808882 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:22:15.812396 (MainThread): Flushing usage events
2022-06-16 15:22:54.960624 (MainThread): Running with dbt=0.19.0
2022-06-16 15:22:55.250604 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:22:55.260756 (MainThread): Tracking: do not track
2022-06-16 15:22:56.380203 (MainThread): Got an acceptable cached parse result
2022-06-16 15:22:56.627384 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:22:59.305284 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:22:59.308271 (MainThread): 
2022-06-16 15:22:59.309997 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:22:59.325070 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:22:59.366373 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:22:59.367669 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:22:59.368704 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:22:59.383224 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.01 seconds
2022-06-16 15:22:59.388696 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:22:59.451357 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:22:59.475481 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:22:59.505801 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:22:59.506983 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:22:59.520786 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:22:59.522148 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:22:59.523086 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:22:59.529831 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:22:59.567478 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:22:59.569352 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:22:59.644919 (MainThread): Using postgres connection "master".
2022-06-16 15:22:59.646230 (MainThread): On master: BEGIN
2022-06-16 15:22:59.647406 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:22:59.660043 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:22:59.661376 (MainThread): Using postgres connection "master".
2022-06-16 15:22:59.662433 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:22:59.744468 (MainThread): SQL status: SELECT 6 in 0.08 seconds
2022-06-16 15:22:59.767953 (MainThread): On master: ROLLBACK
2022-06-16 15:22:59.769801 (MainThread): Using postgres connection "master".
2022-06-16 15:22:59.770917 (MainThread): On master: BEGIN
2022-06-16 15:22:59.773418 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:22:59.774651 (MainThread): On master: COMMIT
2022-06-16 15:22:59.775665 (MainThread): Using postgres connection "master".
2022-06-16 15:22:59.776578 (MainThread): On master: COMMIT
2022-06-16 15:22:59.778220 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:22:59.779603 (MainThread): On master: Close
2022-06-16 15:22:59.781366 (MainThread): 15:22:59 | Concurrency: 1 threads (target='dev')
2022-06-16 15:22:59.782623 (MainThread): 15:22:59 | 
2022-06-16 15:22:59.827786 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:22:59.832005 (Thread-1): 15:22:59 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:22:59.834452 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:22:59.836137 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:22:59.905973 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:22:59.930890 (Thread-1): finished collecting timing info
2022-06-16 15:22:59.983497 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:22:59.984569 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:22:59.985361 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:23:00.033571 (Thread-1): SQL status: DROP VIEW in 0.05 seconds
2022-06-16 15:23:00.043944 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:23:00.045144 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:23:00.046884 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:23:00.062009 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:23:00.089352 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:23:00.090439 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:23:00.092368 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:23:00.093591 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:23:00.094460 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select t.*, coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from--, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"   ) t
),
cust_details_periods as (
	select t.sat_customer_details.*, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:23:00.098388 (Thread-1): Postgres error: missing FROM-clause entry for table "sat_customer_details"
LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                 ^

2022-06-16 15:23:00.099440 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:23:00.100854 (Thread-1): finished collecting timing info
2022-06-16 15:23:00.102310 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:23:00.103962 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  missing FROM-clause entry for table "sat_customer_details"
  LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                   ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: missing FROM-clause entry for table "sat_customer_details"
LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                 ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  missing FROM-clause entry for table "sat_customer_details"
  LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                   ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:23:00.113054 (Thread-1): 15:23:00 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.28s]
2022-06-16 15:23:00.114168 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:23:00.115029 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:23:00.120191 (Thread-1): 15:23:00 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:23:00.122436 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:23:00.124165 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:23:00.155493 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:23:00.181014 (Thread-1): finished collecting timing info
2022-06-16 15:23:00.206939 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:23:00.208343 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:23:00.209261 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:23:00.221513 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:23:00.231425 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:23:00.232590 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:23:00.234315 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:23:00.238794 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:23:00.299417 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:23:00.300433 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:23:00.302131 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:23:00.303231 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:23:00.304446 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:23:00.319638 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-16 15:23:00.349543 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:23:00.350753 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:23:00.353781 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:23:00.363895 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:23:00.365196 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:23:00.367482 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:23:00.389363 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:23:00.390684 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:23:00.391647 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:23:00.395712 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:23:00.409166 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:23:00.410352 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:23:00.415737 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:23:00.423860 (Thread-1): finished collecting timing info
2022-06-16 15:23:00.425688 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:23:00.431442 (Thread-1): 15:23:00 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.31s]
2022-06-16 15:23:00.432755 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:23:00.438707 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:23:00.439885 (MainThread): Using postgres connection "master".
2022-06-16 15:23:00.441585 (MainThread): On master: BEGIN
2022-06-16 15:23:00.442853 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:23:00.455577 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:23:00.456990 (MainThread): On master: COMMIT
2022-06-16 15:23:00.458021 (MainThread): Using postgres connection "master".
2022-06-16 15:23:00.459014 (MainThread): On master: COMMIT
2022-06-16 15:23:00.461294 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:23:00.462539 (MainThread): On master: Close
2022-06-16 15:23:00.464436 (MainThread): 15:23:00 | 
2022-06-16 15:23:00.465763 (MainThread): 15:23:00 | Finished running 2 view models in 1.15s.
2022-06-16 15:23:00.467043 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:23:00.468440 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:23:00.706354 (MainThread): 
2022-06-16 15:23:00.707369 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:23:00.708693 (MainThread): 
2022-06-16 15:23:00.711640 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:23:00.713843 (MainThread):   missing FROM-clause entry for table "sat_customer_details"
2022-06-16 15:23:00.715475 (MainThread):   LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
2022-06-16 15:23:00.717978 (MainThread):                    ^
2022-06-16 15:23:00.719773 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:23:00.721988 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:23:00.723658 (MainThread): Flushing usage events
2022-06-16 15:24:04.335411 (MainThread): Running with dbt=0.19.0
2022-06-16 15:24:04.614628 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:24:04.622639 (MainThread): Tracking: do not track
2022-06-16 15:24:06.275026 (MainThread): Got an acceptable cached parse result
2022-06-16 15:24:06.524017 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:24:09.498367 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:24:09.501636 (MainThread): 
2022-06-16 15:24:09.503214 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:24:09.515580 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:24:09.546037 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:24:09.547070 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:24:09.547898 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:24:09.561377 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.01 seconds
2022-06-16 15:24:09.566058 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:24:09.619895 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:24:09.642837 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:24:09.644074 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:24:09.645030 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:24:09.694046 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.05 seconds
2022-06-16 15:24:09.695254 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:24:09.696400 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:24:09.703008 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:24:09.739689 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:24:09.741222 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:24:09.812422 (MainThread): Using postgres connection "master".
2022-06-16 15:24:09.813460 (MainThread): On master: BEGIN
2022-06-16 15:24:09.814468 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:24:09.828175 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:24:09.829182 (MainThread): Using postgres connection "master".
2022-06-16 15:24:09.830041 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:24:09.930240 (MainThread): SQL status: SELECT 6 in 0.10 seconds
2022-06-16 15:24:09.953810 (MainThread): On master: ROLLBACK
2022-06-16 15:24:09.955445 (MainThread): Using postgres connection "master".
2022-06-16 15:24:09.956432 (MainThread): On master: BEGIN
2022-06-16 15:24:09.958118 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:24:09.959122 (MainThread): On master: COMMIT
2022-06-16 15:24:09.960253 (MainThread): Using postgres connection "master".
2022-06-16 15:24:09.961284 (MainThread): On master: COMMIT
2022-06-16 15:24:09.962856 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:24:09.963738 (MainThread): On master: Close
2022-06-16 15:24:09.965537 (MainThread): 15:24:09 | Concurrency: 1 threads (target='dev')
2022-06-16 15:24:09.966716 (MainThread): 15:24:09 | 
2022-06-16 15:24:09.975312 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:24:09.978258 (Thread-1): 15:24:09 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:24:09.979889 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:24:09.981613 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:24:10.035328 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:24:10.051875 (Thread-1): finished collecting timing info
2022-06-16 15:24:10.126949 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:24:10.127844 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:24:10.128705 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:24:10.142323 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:24:10.150449 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:24:10.151180 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:24:10.152335 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:24:10.162361 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:24:10.176720 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:24:10.177494 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:24:10.179264 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:24:10.180478 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:24:10.181385 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select t.*, coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from --, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"   ) t
),
cust_details_periods as (
	select t.sat_customer_details.*, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:24:10.184096 (Thread-1): Postgres error: missing FROM-clause entry for table "sat_customer_details"
LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                 ^

2022-06-16 15:24:10.185038 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:24:10.186639 (Thread-1): finished collecting timing info
2022-06-16 15:24:10.188101 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:24:10.189542 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  missing FROM-clause entry for table "sat_customer_details"
  LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                   ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: missing FROM-clause entry for table "sat_customer_details"
LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                 ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  missing FROM-clause entry for table "sat_customer_details"
  LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                   ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:24:10.195365 (Thread-1): 15:24:10 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.21s]
2022-06-16 15:24:10.196514 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:24:10.197633 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:24:10.201207 (Thread-1): 15:24:10 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:24:10.202324 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:24:10.203022 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:24:10.219589 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:24:10.230105 (Thread-1): finished collecting timing info
2022-06-16 15:24:10.246013 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:24:10.246860 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:24:10.247433 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:24:10.260987 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:24:10.274329 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:24:10.275418 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:24:10.277164 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:24:10.281706 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:24:10.312113 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:24:10.313193 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:24:10.315059 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:24:10.316165 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:24:10.316965 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:24:10.361329 (Thread-1): SQL status: CREATE VIEW in 0.04 seconds
2022-06-16 15:24:10.390539 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:24:10.391750 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:24:10.394270 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:24:10.404944 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:24:10.406089 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:24:10.408442 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:24:10.431651 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:24:10.432987 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:24:10.433977 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:24:10.439234 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:24:10.452878 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:24:10.453997 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:24:10.459312 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:24:10.467920 (Thread-1): finished collecting timing info
2022-06-16 15:24:10.469737 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:24:10.474969 (Thread-1): 15:24:10 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.27s]
2022-06-16 15:24:10.476315 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:24:10.483236 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:24:10.484564 (MainThread): Using postgres connection "master".
2022-06-16 15:24:10.485636 (MainThread): On master: BEGIN
2022-06-16 15:24:10.486882 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:24:10.500168 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:24:10.501399 (MainThread): On master: COMMIT
2022-06-16 15:24:10.502582 (MainThread): Using postgres connection "master".
2022-06-16 15:24:10.503547 (MainThread): On master: COMMIT
2022-06-16 15:24:10.504904 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:24:10.506024 (MainThread): On master: Close
2022-06-16 15:24:10.507777 (MainThread): 15:24:10 | 
2022-06-16 15:24:10.508987 (MainThread): 15:24:10 | Finished running 2 view models in 1.00s.
2022-06-16 15:24:10.510761 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:24:10.512570 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:24:10.771625 (MainThread): 
2022-06-16 15:24:10.772938 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:24:10.774546 (MainThread): 
2022-06-16 15:24:10.776435 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:24:10.778156 (MainThread):   missing FROM-clause entry for table "sat_customer_details"
2022-06-16 15:24:10.779829 (MainThread):   LINE 12:  select t.sat_customer_details.*, --customer_pk,  customer_h...
2022-06-16 15:24:10.781414 (MainThread):                    ^
2022-06-16 15:24:10.782889 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:24:10.784216 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:24:10.785535 (MainThread): Flushing usage events
2022-06-16 15:25:55.309082 (MainThread): Running with dbt=0.19.0
2022-06-16 15:25:55.610980 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:25:55.620114 (MainThread): Tracking: do not track
2022-06-16 15:25:57.011982 (MainThread): Got an acceptable cached parse result
2022-06-16 15:25:57.315043 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:26:00.343342 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:26:00.348630 (MainThread): 
2022-06-16 15:26:00.351267 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:26:00.364872 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:26:00.401120 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:26:00.402339 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:26:00.403304 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:26:00.418660 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.02 seconds
2022-06-16 15:26:00.426845 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:26:00.479254 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:26:00.503071 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:26:00.504260 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:26:00.505282 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:26:00.516576 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:26:00.517675 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:26:00.518483 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:26:00.525945 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:26:00.560758 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:26:00.562580 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:26:00.632722 (MainThread): Using postgres connection "master".
2022-06-16 15:26:00.633780 (MainThread): On master: BEGIN
2022-06-16 15:26:00.634498 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:26:00.685230 (MainThread): SQL status: BEGIN in 0.05 seconds
2022-06-16 15:26:00.686586 (MainThread): Using postgres connection "master".
2022-06-16 15:26:00.687597 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:26:00.754688 (MainThread): SQL status: SELECT 6 in 0.07 seconds
2022-06-16 15:26:00.774806 (MainThread): On master: ROLLBACK
2022-06-16 15:26:00.776252 (MainThread): Using postgres connection "master".
2022-06-16 15:26:00.777213 (MainThread): On master: BEGIN
2022-06-16 15:26:00.779022 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:26:00.780094 (MainThread): On master: COMMIT
2022-06-16 15:26:00.780934 (MainThread): Using postgres connection "master".
2022-06-16 15:26:00.781781 (MainThread): On master: COMMIT
2022-06-16 15:26:00.783018 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:26:00.784106 (MainThread): On master: Close
2022-06-16 15:26:00.786040 (MainThread): 15:26:00 | Concurrency: 1 threads (target='dev')
2022-06-16 15:26:00.787508 (MainThread): 15:26:00 | 
2022-06-16 15:26:00.798951 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:26:00.804070 (Thread-1): 15:26:00 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:26:00.806573 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:26:00.808345 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:26:00.871978 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:26:00.898456 (Thread-1): finished collecting timing info
2022-06-16 15:26:00.976012 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:26:00.977363 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:26:00.978394 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:26:00.991966 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:26:01.003387 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:26:01.004558 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:26:01.006335 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:26:01.021194 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:26:01.048444 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:26:01.049456 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:26:01.051278 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:26:01.052501 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:26:01.053414 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select customer_pk, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from --, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"   ) t
),
cust_details_periods as (
	select t.sat_customer_details.*, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:26:01.056947 (Thread-1): Postgres error: missing FROM-clause entry for table "sat_customer_details"
LINE 13:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                 ^

2022-06-16 15:26:01.058163 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:26:01.059943 (Thread-1): finished collecting timing info
2022-06-16 15:26:01.061635 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:26:01.063274 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  missing FROM-clause entry for table "sat_customer_details"
  LINE 13:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                   ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: missing FROM-clause entry for table "sat_customer_details"
LINE 13:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                 ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  missing FROM-clause entry for table "sat_customer_details"
  LINE 13:  select t.sat_customer_details.*, --customer_pk,  customer_h...
                   ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:26:01.071795 (Thread-1): 15:26:01 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.26s]
2022-06-16 15:26:01.073109 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:26:01.074444 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:26:01.078994 (Thread-1): 15:26:01 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:26:01.080832 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:26:01.081913 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:26:01.113057 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:26:01.139297 (Thread-1): finished collecting timing info
2022-06-16 15:26:01.165790 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:26:01.167022 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:26:01.168118 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:26:01.180647 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:26:01.190596 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:26:01.191732 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:26:01.193466 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:26:01.198094 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:26:01.224087 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:26:01.225027 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:26:01.226536 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:26:01.227700 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:26:01.228931 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:26:01.270614 (Thread-1): SQL status: CREATE VIEW in 0.04 seconds
2022-06-16 15:26:01.301110 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:26:01.302391 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:26:01.304631 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:26:01.314897 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:26:01.316153 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:26:01.318563 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:26:01.341054 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:26:01.342377 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:26:01.343387 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:26:01.348656 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:26:01.362448 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:26:01.363798 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:26:01.369747 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:26:01.378297 (Thread-1): finished collecting timing info
2022-06-16 15:26:01.380188 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:26:01.385507 (Thread-1): 15:26:01 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.30s]
2022-06-16 15:26:01.386987 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:26:01.392836 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:26:01.394380 (MainThread): Using postgres connection "master".
2022-06-16 15:26:01.395873 (MainThread): On master: BEGIN
2022-06-16 15:26:01.397496 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:26:01.414280 (MainThread): SQL status: BEGIN in 0.02 seconds
2022-06-16 15:26:01.415628 (MainThread): On master: COMMIT
2022-06-16 15:26:01.417086 (MainThread): Using postgres connection "master".
2022-06-16 15:26:01.418647 (MainThread): On master: COMMIT
2022-06-16 15:26:01.421092 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:26:01.422371 (MainThread): On master: Close
2022-06-16 15:26:01.424518 (MainThread): 15:26:01 | 
2022-06-16 15:26:01.425930 (MainThread): 15:26:01 | Finished running 2 view models in 1.07s.
2022-06-16 15:26:01.427084 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:26:01.428875 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:26:01.713119 (MainThread): 
2022-06-16 15:26:01.714460 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:26:01.716057 (MainThread): 
2022-06-16 15:26:01.717673 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:26:01.719181 (MainThread):   missing FROM-clause entry for table "sat_customer_details"
2022-06-16 15:26:01.721235 (MainThread):   LINE 13:  select t.sat_customer_details.*, --customer_pk,  customer_h...
2022-06-16 15:26:01.722885 (MainThread):                    ^
2022-06-16 15:26:01.724986 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:26:01.726433 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:26:01.728219 (MainThread): Flushing usage events
2022-06-16 15:27:00.370726 (MainThread): Running with dbt=0.19.0
2022-06-16 15:27:00.671012 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:27:00.682670 (MainThread): Tracking: do not track
2022-06-16 15:27:02.156971 (MainThread): Got an acceptable cached parse result
2022-06-16 15:27:02.394616 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:27:05.059556 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:27:05.064559 (MainThread): 
2022-06-16 15:27:05.067127 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:27:05.081191 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:27:05.117008 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:27:05.118297 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:27:05.119384 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:27:05.166886 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.05 seconds
2022-06-16 15:27:05.174979 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:27:05.223944 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:27:05.243555 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:27:05.244431 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:27:05.245158 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:27:05.255683 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:27:05.256804 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:27:05.257607 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:27:05.262277 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.00 seconds
2022-06-16 15:27:05.286471 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:27:05.288004 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:27:05.335937 (MainThread): Using postgres connection "master".
2022-06-16 15:27:05.336936 (MainThread): On master: BEGIN
2022-06-16 15:27:05.337793 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:27:05.350753 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:27:05.351899 (MainThread): Using postgres connection "master".
2022-06-16 15:27:05.352978 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:27:05.414251 (MainThread): SQL status: SELECT 6 in 0.06 seconds
2022-06-16 15:27:05.427819 (MainThread): On master: ROLLBACK
2022-06-16 15:27:05.429456 (MainThread): Using postgres connection "master".
2022-06-16 15:27:05.430392 (MainThread): On master: BEGIN
2022-06-16 15:27:05.432100 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:27:05.433108 (MainThread): On master: COMMIT
2022-06-16 15:27:05.433976 (MainThread): Using postgres connection "master".
2022-06-16 15:27:05.434712 (MainThread): On master: COMMIT
2022-06-16 15:27:05.436457 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:27:05.437494 (MainThread): On master: Close
2022-06-16 15:27:05.438816 (MainThread): 15:27:05 | Concurrency: 1 threads (target='dev')
2022-06-16 15:27:05.440010 (MainThread): 15:27:05 | 
2022-06-16 15:27:05.451883 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:27:05.456375 (Thread-1): 15:27:05 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:27:05.458474 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:27:05.459622 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:27:05.532390 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:27:05.559549 (Thread-1): finished collecting timing info
2022-06-16 15:27:05.652618 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:27:05.653784 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:27:05.654766 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:27:05.704087 (Thread-1): SQL status: DROP VIEW in 0.05 seconds
2022-06-16 15:27:05.714281 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:27:05.715443 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:27:05.717438 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:27:05.732313 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:27:05.762589 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:27:05.763720 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:27:05.765661 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:27:05.766918 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:27:05.768157 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select customer_pk, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from --, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"   ) t
),
cust_details_periods as (
	select first_name, last_name, email, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:27:05.771865 (Thread-1): Postgres error: column cdp.customer_pk does not exist
LINE 25:    on cdp.customer_pk = ap.customer_pk
               ^
HINT:  Perhaps you meant to reference the column "ap.customer_pk".

2022-06-16 15:27:05.773170 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:27:05.774994 (Thread-1): finished collecting timing info
2022-06-16 15:27:05.776598 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:27:05.778419 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  column cdp.customer_pk does not exist
  LINE 25:    on cdp.customer_pk = ap.customer_pk
                 ^
  HINT:  Perhaps you meant to reference the column "ap.customer_pk".
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column cdp.customer_pk does not exist
LINE 25:    on cdp.customer_pk = ap.customer_pk
               ^
HINT:  Perhaps you meant to reference the column "ap.customer_pk".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  column cdp.customer_pk does not exist
  LINE 25:    on cdp.customer_pk = ap.customer_pk
                 ^
  HINT:  Perhaps you meant to reference the column "ap.customer_pk".
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:27:05.786635 (Thread-1): 15:27:05 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.33s]
2022-06-16 15:27:05.788073 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:27:05.789446 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:27:05.795586 (Thread-1): 15:27:05 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:27:05.798084 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:27:05.799373 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:27:05.827960 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:27:05.852688 (Thread-1): finished collecting timing info
2022-06-16 15:27:05.879310 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:27:05.880385 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:27:05.881305 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:27:05.893257 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:27:05.903272 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:27:05.904423 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:27:05.907206 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:27:05.911403 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:27:05.937494 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:27:05.939042 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:27:05.940861 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:27:05.941944 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:27:05.942826 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:27:05.949366 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-16 15:27:05.979488 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:27:05.980580 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:27:05.982567 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:27:05.993157 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:27:05.994562 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:27:05.996533 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:27:06.018285 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:27:06.019413 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:27:06.020551 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:27:06.024681 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:27:06.038817 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:27:06.039960 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:27:06.045001 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:27:06.053387 (Thread-1): finished collecting timing info
2022-06-16 15:27:06.055269 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:27:06.060431 (Thread-1): 15:27:06 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.26s]
2022-06-16 15:27:06.061778 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:27:06.067778 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:27:06.069248 (MainThread): Using postgres connection "master".
2022-06-16 15:27:06.070454 (MainThread): On master: BEGIN
2022-06-16 15:27:06.071425 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:27:06.085792 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:27:06.087122 (MainThread): On master: COMMIT
2022-06-16 15:27:06.088121 (MainThread): Using postgres connection "master".
2022-06-16 15:27:06.089039 (MainThread): On master: COMMIT
2022-06-16 15:27:06.090623 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:27:06.091859 (MainThread): On master: Close
2022-06-16 15:27:06.093765 (MainThread): 15:27:06 | 
2022-06-16 15:27:06.095120 (MainThread): 15:27:06 | Finished running 2 view models in 1.03s.
2022-06-16 15:27:06.096570 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:27:06.098886 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:27:06.353591 (MainThread): 
2022-06-16 15:27:06.355026 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:27:06.356403 (MainThread): 
2022-06-16 15:27:06.358095 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:27:06.359846 (MainThread):   column cdp.customer_pk does not exist
2022-06-16 15:27:06.361584 (MainThread):   LINE 25:    on cdp.customer_pk = ap.customer_pk
2022-06-16 15:27:06.363115 (MainThread):                  ^
2022-06-16 15:27:06.365745 (MainThread):   HINT:  Perhaps you meant to reference the column "ap.customer_pk".
2022-06-16 15:27:06.367183 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:27:06.368547 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:27:06.370372 (MainThread): Flushing usage events
2022-06-16 15:28:19.653223 (MainThread): Running with dbt=0.19.0
2022-06-16 15:28:19.902960 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:28:19.910379 (MainThread): Tracking: do not track
2022-06-16 15:28:21.509752 (MainThread): Got an acceptable cached parse result
2022-06-16 15:28:21.793056 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:28:24.718949 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:28:24.721972 (MainThread): 
2022-06-16 15:28:24.723947 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:28:24.766085 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:28:24.800231 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:28:24.801369 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:28:24.802260 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:28:24.818198 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.02 seconds
2022-06-16 15:28:24.826881 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:28:24.886659 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:28:24.908288 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:28:24.909314 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:28:24.910187 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:28:24.923254 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:28:24.924383 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:28:24.925253 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:28:24.931916 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:28:24.969853 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:28:24.971685 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:28:25.030374 (MainThread): Using postgres connection "master".
2022-06-16 15:28:25.031403 (MainThread): On master: BEGIN
2022-06-16 15:28:25.032161 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:28:25.082349 (MainThread): SQL status: BEGIN in 0.05 seconds
2022-06-16 15:28:25.083550 (MainThread): Using postgres connection "master".
2022-06-16 15:28:25.084456 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:28:25.149487 (MainThread): SQL status: SELECT 6 in 0.06 seconds
2022-06-16 15:28:25.167469 (MainThread): On master: ROLLBACK
2022-06-16 15:28:25.168891 (MainThread): Using postgres connection "master".
2022-06-16 15:28:25.169753 (MainThread): On master: BEGIN
2022-06-16 15:28:25.171535 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:28:25.172512 (MainThread): On master: COMMIT
2022-06-16 15:28:25.173298 (MainThread): Using postgres connection "master".
2022-06-16 15:28:25.174184 (MainThread): On master: COMMIT
2022-06-16 15:28:25.175342 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:28:25.176220 (MainThread): On master: Close
2022-06-16 15:28:25.177490 (MainThread): 15:28:25 | Concurrency: 1 threads (target='dev')
2022-06-16 15:28:25.178519 (MainThread): 15:28:25 | 
2022-06-16 15:28:25.188612 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:28:25.193675 (Thread-1): 15:28:25 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:28:25.195473 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:28:25.196813 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:28:25.239079 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:28:25.268065 (Thread-1): finished collecting timing info
2022-06-16 15:28:25.345039 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:28:25.345926 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:28:25.346575 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:28:25.357040 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:28:25.363327 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:28:25.364226 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:28:25.365539 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:28:25.375085 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:28:25.435727 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:28:25.436833 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:28:25.439161 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:28:25.440403 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:28:25.441498 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select customer_pk, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from --, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"   ) t
),
cust_details_periods as (
	select customer_pk, first_name, last_name, email, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:28:25.445539 (Thread-1): Postgres error: column cdp.effective_from does not exist
LINE 26:    and (cdp.effective_from between ap.effective_from and ap....
                 ^
HINT:  Perhaps you meant to reference the column "ap.effective_from".

2022-06-16 15:28:25.446838 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:28:25.448721 (Thread-1): finished collecting timing info
2022-06-16 15:28:25.450397 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:28:25.452139 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  column cdp.effective_from does not exist
  LINE 26:    and (cdp.effective_from between ap.effective_from and ap....
                   ^
  HINT:  Perhaps you meant to reference the column "ap.effective_from".
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedColumn: column cdp.effective_from does not exist
LINE 26:    and (cdp.effective_from between ap.effective_from and ap....
                 ^
HINT:  Perhaps you meant to reference the column "ap.effective_from".


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  column cdp.effective_from does not exist
  LINE 26:    and (cdp.effective_from between ap.effective_from and ap....
                   ^
  HINT:  Perhaps you meant to reference the column "ap.effective_from".
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:28:25.460697 (Thread-1): 15:28:25 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.26s]
2022-06-16 15:28:25.462138 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:28:25.463297 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:28:25.468958 (Thread-1): 15:28:25 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:28:25.471050 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:28:25.472536 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:28:25.501662 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:28:25.523783 (Thread-1): finished collecting timing info
2022-06-16 15:28:25.550475 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:28:25.551540 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:28:25.552368 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:28:25.565057 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:28:25.574854 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:28:25.576288 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:28:25.578597 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:28:25.583211 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:28:25.612026 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:28:25.613089 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:28:25.614995 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:28:25.616139 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:28:25.617107 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:28:25.661893 (Thread-1): SQL status: CREATE VIEW in 0.04 seconds
2022-06-16 15:28:25.692681 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:28:25.693968 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:28:25.696166 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:28:25.707464 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:28:25.708727 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:28:25.710631 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:28:25.724551 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:28:25.725638 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:28:25.726370 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:28:25.729803 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:28:25.738300 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:28:25.739082 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:28:25.743562 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:28:25.748758 (Thread-1): finished collecting timing info
2022-06-16 15:28:25.750044 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:28:25.753264 (Thread-1): 15:28:25 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.28s]
2022-06-16 15:28:25.754286 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:28:25.759524 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:28:25.760898 (MainThread): Using postgres connection "master".
2022-06-16 15:28:25.761887 (MainThread): On master: BEGIN
2022-06-16 15:28:25.762726 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:28:25.775714 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:28:25.776708 (MainThread): On master: COMMIT
2022-06-16 15:28:25.777562 (MainThread): Using postgres connection "master".
2022-06-16 15:28:25.778266 (MainThread): On master: COMMIT
2022-06-16 15:28:25.779602 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:28:25.780587 (MainThread): On master: Close
2022-06-16 15:28:25.782451 (MainThread): 15:28:25 | 
2022-06-16 15:28:25.783592 (MainThread): 15:28:25 | Finished running 2 view models in 1.06s.
2022-06-16 15:28:25.785092 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:28:25.786490 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:28:26.029628 (MainThread): 
2022-06-16 15:28:26.030530 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:28:26.031486 (MainThread): 
2022-06-16 15:28:26.032810 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:28:26.034034 (MainThread):   column cdp.effective_from does not exist
2022-06-16 15:28:26.035102 (MainThread):   LINE 26:    and (cdp.effective_from between ap.effective_from and ap....
2022-06-16 15:28:26.036383 (MainThread):                    ^
2022-06-16 15:28:26.037615 (MainThread):   HINT:  Perhaps you meant to reference the column "ap.effective_from".
2022-06-16 15:28:26.038807 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:28:26.040409 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:28:26.041431 (MainThread): Flushing usage events
2022-06-16 15:29:14.250760 (MainThread): Running with dbt=0.19.0
2022-06-16 15:29:14.544209 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:29:14.552440 (MainThread): Tracking: do not track
2022-06-16 15:29:16.141462 (MainThread): Got an acceptable cached parse result
2022-06-16 15:29:16.399219 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:19.264352 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:29:19.267692 (MainThread): 
2022-06-16 15:29:19.269179 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:29:19.277984 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:29:19.300805 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:29:19.301574 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:29:19.302192 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:29:19.358632 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.06 seconds
2022-06-16 15:29:19.366053 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:29:19.413519 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:29:19.432904 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:29:19.433956 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:29:19.434907 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:29:19.447645 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:29:19.448789 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:29:19.449704 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:29:19.457777 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:29:19.493737 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:29:19.495183 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:29:19.565342 (MainThread): Using postgres connection "master".
2022-06-16 15:29:19.566504 (MainThread): On master: BEGIN
2022-06-16 15:29:19.567350 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:29:19.580249 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:29:19.581290 (MainThread): Using postgres connection "master".
2022-06-16 15:29:19.582052 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:29:19.645845 (MainThread): SQL status: SELECT 6 in 0.06 seconds
2022-06-16 15:29:19.669032 (MainThread): On master: ROLLBACK
2022-06-16 15:29:19.671048 (MainThread): Using postgres connection "master".
2022-06-16 15:29:19.672128 (MainThread): On master: BEGIN
2022-06-16 15:29:19.674267 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:29:19.675421 (MainThread): On master: COMMIT
2022-06-16 15:29:19.676348 (MainThread): Using postgres connection "master".
2022-06-16 15:29:19.677388 (MainThread): On master: COMMIT
2022-06-16 15:29:19.678999 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:29:19.680243 (MainThread): On master: Close
2022-06-16 15:29:19.681936 (MainThread): 15:29:19 | Concurrency: 1 threads (target='dev')
2022-06-16 15:29:19.683145 (MainThread): 15:29:19 | 
2022-06-16 15:29:19.694545 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:29:19.699153 (Thread-1): 15:29:19 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:29:19.701178 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:19.702423 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:29:19.766107 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:29:19.790038 (Thread-1): finished collecting timing info
2022-06-16 15:29:19.866348 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:19.867487 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:29:19.868219 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:29:19.878565 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:29:19.884892 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:19.885853 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:29:19.887244 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:29:19.903629 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:29:19.927840 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:19.929136 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:29:19.931418 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:29:19.933055 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:19.934605 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select customer_pk, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from --, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"   ) t
),
cust_details_periods as (
	select customer_pk, first_name, last_name, email,  effective_from,--customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
--		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:29:19.992958 (Thread-1): SQL status: CREATE VIEW in 0.06 seconds
2022-06-16 15:29:20.009524 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:20.010691 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
alter table "postgres"."dbt"."v_pit_customer" rename to "v_pit_customer__dbt_backup"
2022-06-16 15:29:20.014141 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:29:20.020378 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:20.021576 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
alter table "postgres"."dbt"."v_pit_customer__dbt_tmp" rename to "v_pit_customer"
2022-06-16 15:29:20.025314 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:29:20.038547 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-16 15:29:20.039618 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:20.040386 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-16 15:29:20.045571 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:29:20.053885 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:29:20.054954 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:29:20.061126 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:29:20.066701 (Thread-1): finished collecting timing info
2022-06-16 15:29:20.067970 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:29:20.071534 (Thread-1): 15:29:20 | 1 of 2 OK created view model dbt.v_pit_customer...................... [CREATE VIEW in 0.37s]
2022-06-16 15:29:20.072804 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:29:20.074139 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:29:20.078008 (Thread-1): 15:29:20 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:29:20.081676 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:29:20.083528 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:29:20.112078 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:29:20.138620 (Thread-1): finished collecting timing info
2022-06-16 15:29:20.171484 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:29:20.173060 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:29:20.174074 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:29:20.185735 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:29:20.192201 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:29:20.193213 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:29:20.194787 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:29:20.199393 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:29:20.222349 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:29:20.223169 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:29:20.224498 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:29:20.225392 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:29:20.226407 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:29:20.230442 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-06-16 15:29:20.240146 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:29:20.241213 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:29:20.242956 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:29:20.249203 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:29:20.250140 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:29:20.251936 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:29:20.254390 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:29:20.255330 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:29:20.256133 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:29:20.259180 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:29:20.265805 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:29:20.266797 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:29:20.272642 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:29:20.278887 (Thread-1): finished collecting timing info
2022-06-16 15:29:20.280060 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:29:20.285865 (Thread-1): 15:29:20 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.20s]
2022-06-16 15:29:20.287047 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:29:20.297688 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:29:20.298970 (MainThread): Using postgres connection "master".
2022-06-16 15:29:20.299692 (MainThread): On master: BEGIN
2022-06-16 15:29:20.300215 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:29:20.308717 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:29:20.309831 (MainThread): On master: COMMIT
2022-06-16 15:29:20.310457 (MainThread): Using postgres connection "master".
2022-06-16 15:29:20.311120 (MainThread): On master: COMMIT
2022-06-16 15:29:20.312255 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:29:20.313057 (MainThread): On master: Close
2022-06-16 15:29:20.314835 (MainThread): 15:29:20 | 
2022-06-16 15:29:20.315745 (MainThread): 15:29:20 | Finished running 2 view models in 1.05s.
2022-06-16 15:29:20.316526 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:29:20.317539 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:29:20.562491 (MainThread): 
2022-06-16 15:29:20.563420 (MainThread): Completed successfully
2022-06-16 15:29:20.564825 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-16 15:29:20.566420 (MainThread): Flushing usage events
2022-06-16 15:33:41.510166 (MainThread): Running with dbt=0.19.0
2022-06-16 15:33:41.792080 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:33:41.799082 (MainThread): Tracking: do not track
2022-06-16 15:33:43.356911 (MainThread): Got an acceptable cached parse result
2022-06-16 15:33:43.651768 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:33:45.379856 (MainThread): Flushing usage events
2022-06-16 15:33:45.381008 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_pit_customer' was properly closed.
2022-06-16 15:33:45.381881 (MainThread): Encountered an error:
2022-06-16 15:33:45.382896 (MainThread): Compilation Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  Model 'model.jaffle_shop_dbtvault.v_pit_customer' (models/marts/v_pit_customer.sql) depends on a node named 'sat_customer_crm scc' which was not found
2022-06-16 15:33:45.389346 (MainThread): Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/main.py", line 125, in main
    results, succeeded = handle_and_check(args)
  File "/usr/local/lib/python3.8/site-packages/dbt/main.py", line 203, in handle_and_check
    task, res = run_from_args(parsed)
  File "/usr/local/lib/python3.8/site-packages/dbt/main.py", line 256, in run_from_args
    results = task.run()
  File "/usr/local/lib/python3.8/site-packages/dbt/task/runnable.py", line 406, in run
    self._runtime_initialize()
  File "/usr/local/lib/python3.8/site-packages/dbt/task/runnable.py", line 122, in _runtime_initialize
    super()._runtime_initialize()
  File "/usr/local/lib/python3.8/site-packages/dbt/task/runnable.py", line 79, in _runtime_initialize
    self.load_manifest()
  File "/usr/local/lib/python3.8/site-packages/dbt/task/runnable.py", line 66, in load_manifest
    self.manifest = get_full_manifest(self.config)
  File "/usr/local/lib/python3.8/site-packages/dbt/perf_utils.py", line 28, in get_full_manifest
    return load_manifest(
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 854, in load_manifest
    return ManifestLoader.load_all(config, macro_manifest, macro_hook)
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 436, in load_all
    manifest = loader.create_manifest()
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 414, in create_manifest
    self.process_manifest(manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 380, in process_manifest
    process_refs(manifest, project_name)
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 750, in process_refs
    _process_refs_for_node(manifest, current_project, node)
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 732, in _process_refs_for_node
    invalid_ref_fail_unless_test(
  File "/usr/local/lib/python3.8/site-packages/dbt/parser/manifest.py", line 475, in invalid_ref_fail_unless_test
    ref_target_not_found(
  File "/usr/local/lib/python3.8/site-packages/dbt/exceptions.py", line 566, in ref_target_not_found
    raise_compiler_error(msg, model)
  File "/usr/local/lib/python3.8/site-packages/dbt/exceptions.py", line 435, in raise_compiler_error
    raise CompilationException(msg, node)
dbt.exceptions.CompilationException: Compilation Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  Model 'model.jaffle_shop_dbtvault.v_pit_customer' (models/marts/v_pit_customer.sql) depends on a node named 'sat_customer_crm scc' which was not found

2022-06-16 15:40:20.501154 (MainThread): Running with dbt=0.19.0
2022-06-16 15:40:20.817212 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:40:20.822483 (MainThread): Tracking: do not track
2022-06-16 15:40:22.403675 (MainThread): Got an acceptable cached parse result
2022-06-16 15:40:22.694274 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:40:25.514042 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:40:25.517131 (MainThread): 
2022-06-16 15:40:25.518969 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:40:25.526922 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:40:25.565890 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:40:25.567111 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:40:25.568530 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:40:25.585889 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.02 seconds
2022-06-16 15:40:25.593615 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:40:25.652992 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:40:25.675435 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:40:25.676911 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:40:25.678043 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:40:25.690393 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:40:25.691853 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:40:25.692993 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:40:25.699829 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:40:25.734048 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:40:25.735725 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:40:25.794304 (MainThread): Using postgres connection "master".
2022-06-16 15:40:25.795165 (MainThread): On master: BEGIN
2022-06-16 15:40:25.795838 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:40:25.808293 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:40:25.809158 (MainThread): Using postgres connection "master".
2022-06-16 15:40:25.809820 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:40:25.882020 (MainThread): SQL status: SELECT 6 in 0.07 seconds
2022-06-16 15:40:25.905382 (MainThread): On master: ROLLBACK
2022-06-16 15:40:25.907341 (MainThread): Using postgres connection "master".
2022-06-16 15:40:25.908202 (MainThread): On master: BEGIN
2022-06-16 15:40:25.910305 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:40:25.911485 (MainThread): On master: COMMIT
2022-06-16 15:40:25.912355 (MainThread): Using postgres connection "master".
2022-06-16 15:40:25.913173 (MainThread): On master: COMMIT
2022-06-16 15:40:25.914773 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:40:25.915859 (MainThread): On master: Close
2022-06-16 15:40:25.917515 (MainThread): 15:40:25 | Concurrency: 1 threads (target='dev')
2022-06-16 15:40:25.918781 (MainThread): 15:40:25 | 
2022-06-16 15:40:25.928980 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:40:25.934025 (Thread-1): 15:40:25 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:40:25.935897 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:40:25.937354 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:40:26.004375 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:40:26.026171 (Thread-1): finished collecting timing info
2022-06-16 15:40:26.091744 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:40:26.093004 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:40:26.093946 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:40:26.141222 (Thread-1): SQL status: DROP VIEW in 0.05 seconds
2022-06-16 15:40:26.151423 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:40:26.152880 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:40:26.154896 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:40:26.170095 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:40:26.198171 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:40:26.199237 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:40:26.201008 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:40:26.202268 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:40:26.203202 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select customer_pk, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from--, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"
	  			union
	  	  select customer_pk, effective_from--, customer_hashdiff, record_source
	  	  		from "postgres"."dbt"."sat_customer_crm"   ) t
),
cust_details_periods as (
	select customer_pk, first_name, last_name, email,  effective_from, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
cust_crm_periods as (
	select customer_pk, ccp.country, ccp.age,  effective_from, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_crm" t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email,
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
		left join cust_crm_periods ccp
			on ccp.customer_pk = ap.customer_pk
			and (ccp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or ccp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:40:26.206776 (Thread-1): Postgres error: missing FROM-clause entry for table "ccp"
LINE 21:  select customer_pk, ccp.country, ccp.age,  effective_from, ...
                              ^

2022-06-16 15:40:26.207950 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: ROLLBACK
2022-06-16 15:40:26.209727 (Thread-1): finished collecting timing info
2022-06-16 15:40:26.211274 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:40:26.212956 (Thread-1): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  missing FROM-clause entry for table "ccp"
  LINE 21:  select customer_pk, ccp.country, ccp.age,  effective_from, ...
                                ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 47, in exception_handler
    yield
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 80, in add_query
    cursor.execute(sql, bindings)
psycopg2.errors.UndefinedTable: missing FROM-clause entry for table "ccp"
LINE 21:  select customer_pk, ccp.country, ccp.age,  effective_from, ...
                              ^


The above exception was the direct cause of the following exception:

Traceback (most recent call last):
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 344, in safe_run
    result = self.compile_and_execute(manifest, ctx)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 287, in compile_and_execute
    result = self.run(ctx.node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/base.py", line 389, in run
    return self.execute(compiled_node, manifest)
  File "/usr/local/lib/python3.8/site-packages/dbt/task/run.py", line 247, in execute
    result = MacroGenerator(materialization_macro, context)()
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 61, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 327, in __call__
    return self.call_macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/clients/jinja.py", line 257, in call_macro
    return macro(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 675, in __call__
    return self._invoke(arguments, autoescape)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 679, in _invoke
    rv = self._func(*arguments)
  File "<template>", line 41, in macro
  File "/usr/local/lib/python3.8/site-packages/jinja2/sandbox.py", line 462, in call
    return __context.call(__obj, *args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/jinja2/runtime.py", line 290, in call
    return __obj(*args, **kwargs)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/base/impl.py", line 227, in execute
    return self.connections.execute(
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 124, in execute
    _, cursor = self.add_query(sql, auto_begin)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/sql/connections.py", line 87, in add_query
    return connection, cursor
  File "/usr/local/lib/python3.8/contextlib.py", line 131, in __exit__
    self.gen.throw(type, value, traceback)
  File "/usr/local/lib/python3.8/site-packages/dbt/adapters/postgres/connections.py", line 58, in exception_handler
    raise dbt.exceptions.DatabaseException(str(e).strip()) from e
dbt.exceptions.DatabaseException: Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
  missing FROM-clause entry for table "ccp"
  LINE 21:  select customer_pk, ccp.country, ccp.age,  effective_from, ...
                                ^
  compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:40:26.220906 (Thread-1): 15:40:26 | 1 of 2 ERROR creating view model dbt.v_pit_customer.................. [ERROR in 0.28s]
2022-06-16 15:40:26.222491 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:40:26.223827 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:40:26.229602 (Thread-1): 15:40:26 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:40:26.231790 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:40:26.233387 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:40:26.261244 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:40:26.287420 (Thread-1): finished collecting timing info
2022-06-16 15:40:26.313500 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:40:26.314673 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:40:26.315623 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:40:26.327247 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:40:26.336693 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:40:26.337951 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:40:26.340013 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:40:26.344057 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:40:26.370732 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:40:26.371806 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:40:26.373581 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:40:26.374622 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:40:26.375551 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:40:26.410042 (Thread-1): SQL status: CREATE VIEW in 0.03 seconds
2022-06-16 15:40:26.440458 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:40:26.441725 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:40:26.444203 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:40:26.452566 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:40:26.453464 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:40:26.455230 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:40:26.468472 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:40:26.469460 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:40:26.470147 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:40:26.478563 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-06-16 15:40:26.486694 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:40:26.487702 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:40:26.492313 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:40:26.497861 (Thread-1): finished collecting timing info
2022-06-16 15:40:26.499149 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:40:26.502429 (Thread-1): 15:40:26 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.27s]
2022-06-16 15:40:26.503453 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:40:26.509049 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:40:26.510425 (MainThread): Using postgres connection "master".
2022-06-16 15:40:26.511519 (MainThread): On master: BEGIN
2022-06-16 15:40:26.512359 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:40:26.525468 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:40:26.526252 (MainThread): On master: COMMIT
2022-06-16 15:40:26.526983 (MainThread): Using postgres connection "master".
2022-06-16 15:40:26.527934 (MainThread): On master: COMMIT
2022-06-16 15:40:26.529363 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:40:26.530383 (MainThread): On master: Close
2022-06-16 15:40:26.532130 (MainThread): 15:40:26 | 
2022-06-16 15:40:26.533165 (MainThread): 15:40:26 | Finished running 2 view models in 1.01s.
2022-06-16 15:40:26.534220 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:40:26.535914 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:40:26.851450 (MainThread): 
2022-06-16 15:40:26.852475 (MainThread): Completed with 1 error and 0 warnings:
2022-06-16 15:40:26.853154 (MainThread): 
2022-06-16 15:40:26.854770 (MainThread): Database Error in model v_pit_customer (models/marts/v_pit_customer.sql)
2022-06-16 15:40:26.856789 (MainThread):   missing FROM-clause entry for table "ccp"
2022-06-16 15:40:26.858172 (MainThread):   LINE 21:  select customer_pk, ccp.country, ccp.age,  effective_from, ...
2022-06-16 15:40:26.859438 (MainThread):                                 ^
2022-06-16 15:40:26.860648 (MainThread):   compiled SQL at target/run/jaffle_shop_dbtvault/models/marts/v_pit_customer.sql
2022-06-16 15:40:26.862032 (MainThread): 
Done. PASS=1 WARN=0 ERROR=1 SKIP=0 TOTAL=2
2022-06-16 15:40:26.864532 (MainThread): Flushing usage events
2022-06-16 15:40:57.141354 (MainThread): Running with dbt=0.19.0
2022-06-16 15:40:57.438787 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:40:57.448437 (MainThread): Tracking: do not track
2022-06-16 15:40:58.988052 (MainThread): Got an acceptable cached parse result
2022-06-16 15:40:59.331643 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:02.277898 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:41:02.283949 (MainThread): 
2022-06-16 15:41:02.285641 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:41:02.296598 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:41:02.318422 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:41:02.319500 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:41:02.320776 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:41:02.337888 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.02 seconds
2022-06-16 15:41:02.345860 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:41:02.400840 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:41:02.426424 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:41:02.427535 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:41:02.428424 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:41:02.439958 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:41:02.440840 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:41:02.441564 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:41:02.448637 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:41:02.483436 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:41:02.484910 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:41:02.528561 (MainThread): Using postgres connection "master".
2022-06-16 15:41:02.529522 (MainThread): On master: BEGIN
2022-06-16 15:41:02.530273 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:41:02.579759 (MainThread): SQL status: BEGIN in 0.05 seconds
2022-06-16 15:41:02.580969 (MainThread): Using postgres connection "master".
2022-06-16 15:41:02.581860 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:41:02.663240 (MainThread): SQL status: SELECT 6 in 0.08 seconds
2022-06-16 15:41:02.688886 (MainThread): On master: ROLLBACK
2022-06-16 15:41:02.690579 (MainThread): Using postgres connection "master".
2022-06-16 15:41:02.691524 (MainThread): On master: BEGIN
2022-06-16 15:41:02.693580 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:41:02.694763 (MainThread): On master: COMMIT
2022-06-16 15:41:02.695678 (MainThread): Using postgres connection "master".
2022-06-16 15:41:02.696509 (MainThread): On master: COMMIT
2022-06-16 15:41:02.698221 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:41:02.699439 (MainThread): On master: Close
2022-06-16 15:41:02.701323 (MainThread): 15:41:02 | Concurrency: 1 threads (target='dev')
2022-06-16 15:41:02.702605 (MainThread): 15:41:02 | 
2022-06-16 15:41:02.750362 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:41:02.754384 (Thread-1): 15:41:02 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:41:02.756152 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:02.757356 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:41:02.834999 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:41:02.855906 (Thread-1): finished collecting timing info
2022-06-16 15:41:02.924284 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:02.925440 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:41:02.926240 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:41:02.937594 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:41:02.948606 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:02.949796 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:41:02.951520 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:41:02.968106 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:41:02.991754 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:02.992552 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:41:02.993962 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:41:02.994963 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:02.995851 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select customer_pk, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from--, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"
	  			union
	  	  select customer_pk, effective_from--, customer_hashdiff, record_source
	  	  		from "postgres"."dbt"."sat_customer_crm"   ) t
),
cust_details_periods as (
	select customer_pk, first_name, last_name, email,  effective_from, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
cust_crm_periods as (
	select customer_pk, country, age, effective_from, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_crm" t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email,
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
		left join cust_crm_periods ccp
			on ccp.customer_pk = ap.customer_pk
			and (ccp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or ccp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
  );

2022-06-16 15:41:03.043338 (Thread-1): SQL status: CREATE VIEW in 0.05 seconds
2022-06-16 15:41:03.058742 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:03.059936 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
alter table "postgres"."dbt"."v_pit_customer" rename to "v_pit_customer__dbt_backup"
2022-06-16 15:41:03.061795 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:41:03.068015 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:03.068913 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
alter table "postgres"."dbt"."v_pit_customer__dbt_tmp" rename to "v_pit_customer"
2022-06-16 15:41:03.071115 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:41:03.084297 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-16 15:41:03.085380 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:03.086272 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-16 15:41:03.090917 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:41:03.099041 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:41:03.100204 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:41:03.105821 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:41:03.111371 (Thread-1): finished collecting timing info
2022-06-16 15:41:03.112705 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:41:03.116135 (Thread-1): 15:41:03 | 1 of 2 OK created view model dbt.v_pit_customer...................... [CREATE VIEW in 0.36s]
2022-06-16 15:41:03.117361 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:41:03.118667 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:41:03.125210 (Thread-1): 15:41:03 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:41:03.128309 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:41:03.129479 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:41:03.161611 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:41:03.182326 (Thread-1): finished collecting timing info
2022-06-16 15:41:03.208585 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:41:03.209734 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:41:03.210522 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:41:03.223128 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:41:03.232982 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:41:03.234263 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:41:03.235930 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:41:03.240110 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:41:03.266455 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:41:03.267534 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:41:03.269224 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:41:03.270123 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:41:03.270778 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:41:03.276993 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-16 15:41:03.291343 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:41:03.292429 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:41:03.294770 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:41:03.304441 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:41:03.305574 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:41:03.307760 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:41:03.311808 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:41:03.312831 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:41:03.313690 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:41:03.318011 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:41:03.326350 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:41:03.327523 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:41:03.332248 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:41:03.340356 (Thread-1): finished collecting timing info
2022-06-16 15:41:03.341895 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:41:03.347088 (Thread-1): 15:41:03 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.22s]
2022-06-16 15:41:03.348426 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:41:03.354735 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:41:03.356546 (MainThread): Using postgres connection "master".
2022-06-16 15:41:03.358014 (MainThread): On master: BEGIN
2022-06-16 15:41:03.359411 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:41:03.372002 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:41:03.373305 (MainThread): On master: COMMIT
2022-06-16 15:41:03.374342 (MainThread): Using postgres connection "master".
2022-06-16 15:41:03.375271 (MainThread): On master: COMMIT
2022-06-16 15:41:03.376814 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:41:03.377957 (MainThread): On master: Close
2022-06-16 15:41:03.379962 (MainThread): 15:41:03 | 
2022-06-16 15:41:03.381182 (MainThread): 15:41:03 | Finished running 2 view models in 1.09s.
2022-06-16 15:41:03.382602 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:41:03.384284 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:41:03.665365 (MainThread): 
2022-06-16 15:41:03.666301 (MainThread): Completed successfully
2022-06-16 15:41:03.667513 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-16 15:41:03.669189 (MainThread): Flushing usage events
2022-06-16 15:42:16.143159 (MainThread): Running with dbt=0.19.0
2022-06-16 15:42:16.465894 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 15:42:16.485145 (MainThread): Tracking: do not track
2022-06-16 15:42:18.283768 (MainThread): Got an acceptable cached parse result
2022-06-16 15:42:18.563533 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.102390 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 15:42:21.106092 (MainThread): 
2022-06-16 15:42:21.107616 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:42:21.115344 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 15:42:21.142653 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 15:42:21.143559 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 15:42:21.144084 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 15:42:21.156093 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.01 seconds
2022-06-16 15:42:21.161124 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 15:42:21.212576 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 15:42:21.238198 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:42:21.239358 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 15:42:21.240242 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 15:42:21.253269 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:42:21.254392 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 15:42:21.255229 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 15:42:21.262302 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.01 seconds
2022-06-16 15:42:21.300790 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 15:42:21.302464 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 15:42:21.374167 (MainThread): Using postgres connection "master".
2022-06-16 15:42:21.375589 (MainThread): On master: BEGIN
2022-06-16 15:42:21.376615 (MainThread): Opening a new connection, currently in state init
2022-06-16 15:42:21.389412 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:42:21.390641 (MainThread): Using postgres connection "master".
2022-06-16 15:42:21.391442 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 15:42:21.461782 (MainThread): SQL status: SELECT 7 in 0.07 seconds
2022-06-16 15:42:21.480146 (MainThread): On master: ROLLBACK
2022-06-16 15:42:21.481479 (MainThread): Using postgres connection "master".
2022-06-16 15:42:21.482311 (MainThread): On master: BEGIN
2022-06-16 15:42:21.483616 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:42:21.484454 (MainThread): On master: COMMIT
2022-06-16 15:42:21.485226 (MainThread): Using postgres connection "master".
2022-06-16 15:42:21.485919 (MainThread): On master: COMMIT
2022-06-16 15:42:21.487066 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:42:21.487868 (MainThread): On master: Close
2022-06-16 15:42:21.489268 (MainThread): 15:42:21 | Concurrency: 1 threads (target='dev')
2022-06-16 15:42:21.490312 (MainThread): 15:42:21 | 
2022-06-16 15:42:21.533499 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:42:21.536282 (Thread-1): 15:42:21 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 15:42:21.538273 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.539511 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:42:21.586953 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:42:21.613701 (Thread-1): finished collecting timing info
2022-06-16 15:42:21.669094 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.670091 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 15:42:21.670854 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:42:21.679725 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:42:21.690854 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.691824 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:42:21.693137 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:42:21.709011 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 15:42:21.730661 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.731696 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 15:42:21.733664 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:42:21.734929 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.736083 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select customer_pk, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
	from (select customer_pk, effective_from--, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"
	  			union
	  	  select customer_pk, effective_from--, customer_hashdiff, record_source
	  	  		from "postgres"."dbt"."sat_customer_crm"   ) t
),
cust_details_periods as (
	select customer_pk, first_name, last_name, email,  effective_from, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
cust_crm_periods as (
	select customer_pk, country, age, effective_from, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') effective_to
			from "postgres"."dbt"."sat_customer_crm" t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email,
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or cdp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
		left join cust_crm_periods ccp
			on ccp.customer_pk = ap.customer_pk
			and (ccp.effective_from between ap.effective_from and ap.effective_to - interval '1 microseconds'
				or ccp.effective_to between ap.effective_from + interval '1 microseconds' and ap.effective_to
				)
)

select * from pit_table
--where customer_pk = 'ec8956637a99787bd197eacd77acce5e'
  );

2022-06-16 15:42:21.742591 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-16 15:42:21.770542 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.771820 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
alter table "postgres"."dbt"."v_pit_customer" rename to "v_pit_customer__dbt_backup"
2022-06-16 15:42:21.774714 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:42:21.786680 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.787941 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
alter table "postgres"."dbt"."v_pit_customer__dbt_tmp" rename to "v_pit_customer"
2022-06-16 15:42:21.790554 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:42:21.812203 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-16 15:42:21.813511 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.814477 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-16 15:42:21.818436 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:42:21.831791 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 15:42:21.833067 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 15:42:21.839670 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:42:21.848318 (Thread-1): finished collecting timing info
2022-06-16 15:42:21.849932 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 15:42:21.855474 (Thread-1): 15:42:21 | 1 of 2 OK created view model dbt.v_pit_customer...................... [CREATE VIEW in 0.31s]
2022-06-16 15:42:21.856834 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 15:42:21.858427 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:42:21.864372 (Thread-1): 15:42:21 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 15:42:21.867020 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:42:21.868336 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:42:21.899739 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:42:21.924742 (Thread-1): finished collecting timing info
2022-06-16 15:42:21.951156 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:42:21.952315 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 15:42:21.953174 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 15:42:21.964947 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 15:42:21.974563 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:42:21.975647 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:42:21.977341 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:42:21.981338 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 15:42:22.006986 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:42:22.008005 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 15:42:22.009650 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 15:42:22.010624 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:42:22.011452 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 15:42:22.016766 (Thread-1): SQL status: CREATE VIEW in 0.00 seconds
2022-06-16 15:42:22.030687 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:42:22.032037 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 15:42:22.034116 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:42:22.044019 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:42:22.045378 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 15:42:22.047271 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 15:42:22.051103 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:42:22.052178 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:42:22.053027 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 15:42:22.093268 (Thread-1): SQL status: COMMIT in 0.04 seconds
2022-06-16 15:42:22.101786 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 15:42:22.103140 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 15:42:22.108562 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 15:42:22.117206 (Thread-1): finished collecting timing info
2022-06-16 15:42:22.118914 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 15:42:22.124233 (Thread-1): 15:42:22 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.25s]
2022-06-16 15:42:22.125687 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 15:42:22.132167 (MainThread): Acquiring new postgres connection "master".
2022-06-16 15:42:22.133261 (MainThread): Using postgres connection "master".
2022-06-16 15:42:22.134150 (MainThread): On master: BEGIN
2022-06-16 15:42:22.135085 (MainThread): Opening a new connection, currently in state closed
2022-06-16 15:42:22.148466 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 15:42:22.149615 (MainThread): On master: COMMIT
2022-06-16 15:42:22.150454 (MainThread): Using postgres connection "master".
2022-06-16 15:42:22.151244 (MainThread): On master: COMMIT
2022-06-16 15:42:22.152656 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 15:42:22.153723 (MainThread): On master: Close
2022-06-16 15:42:22.155424 (MainThread): 15:42:22 | 
2022-06-16 15:42:22.156562 (MainThread): 15:42:22 | Finished running 2 view models in 1.05s.
2022-06-16 15:42:22.158009 (MainThread): Connection 'master' was properly closed.
2022-06-16 15:42:22.159536 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 15:42:22.425246 (MainThread): 
2022-06-16 15:42:22.426250 (MainThread): Completed successfully
2022-06-16 15:42:22.427014 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-16 15:42:22.429273 (MainThread): Flushing usage events
2022-06-16 17:51:54.624287 (MainThread): Running with dbt=0.19.0
2022-06-16 17:51:55.203615 (MainThread): running dbt with arguments Namespace(cls=<class 'dbt.task.run.RunTask'>, debug=False, defer=None, exclude=None, fail_fast=False, full_refresh=False, log_cache_events=False, log_format='default', models=['tag:marts'], partial_parse=None, profile=None, profiles_dir='.', project_dir=None, record_timing_info=None, rpc_method='run', selector_name=None, single_threaded=False, state=None, strict=False, target=None, test_new_parser=False, threads=None, use_cache=True, use_colors=None, vars='{}', version_check=True, warn_error=False, which='run', write_json=True)
2022-06-16 17:51:55.211481 (MainThread): Tracking: do not track
2022-06-16 17:51:57.995307 (MainThread): Got an acceptable cached parse result
2022-06-16 17:51:58.326949 (MainThread): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:01.878544 (MainThread): Found 11 models, 0 tests, 0 snapshots, 0 analyses, 367 macros, 0 operations, 3 seed files, 3 sources, 0 exposures
2022-06-16 17:52:01.883327 (MainThread): 
2022-06-16 17:52:01.886287 (MainThread): Acquiring new postgres connection "master".
2022-06-16 17:52:01.901728 (ThreadPoolExecutor-0_0): Acquiring new postgres connection "list_postgres".
2022-06-16 17:52:01.953978 (ThreadPoolExecutor-0_0): Using postgres connection "list_postgres".
2022-06-16 17:52:01.956298 (ThreadPoolExecutor-0_0): On list_postgres: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres"} */

    select distinct nspname from pg_namespace
  
2022-06-16 17:52:01.958526 (ThreadPoolExecutor-0_0): Opening a new connection, currently in state init
2022-06-16 17:52:02.078276 (ThreadPoolExecutor-0_0): SQL status: SELECT 11 in 0.12 seconds
2022-06-16 17:52:02.088578 (ThreadPoolExecutor-0_0): On list_postgres: Close
2022-06-16 17:52:02.152308 (ThreadPoolExecutor-1_0): Acquiring new postgres connection "list_postgres_dbt".
2022-06-16 17:52:02.166546 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 17:52:02.167546 (ThreadPoolExecutor-1_0): On list_postgres_dbt: BEGIN
2022-06-16 17:52:02.168273 (ThreadPoolExecutor-1_0): Opening a new connection, currently in state closed
2022-06-16 17:52:02.210533 (ThreadPoolExecutor-1_0): SQL status: BEGIN in 0.04 seconds
2022-06-16 17:52:02.211807 (ThreadPoolExecutor-1_0): Using postgres connection "list_postgres_dbt".
2022-06-16 17:52:02.213058 (ThreadPoolExecutor-1_0): On list_postgres_dbt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "list_postgres_dbt"} */
select
      'postgres' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'dbt'
    union all
    select
      'postgres' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'dbt'
  
2022-06-16 17:52:02.263024 (ThreadPoolExecutor-1_0): SQL status: SELECT 15 in 0.05 seconds
2022-06-16 17:52:02.310534 (ThreadPoolExecutor-1_0): On list_postgres_dbt: ROLLBACK
2022-06-16 17:52:02.312368 (ThreadPoolExecutor-1_0): On list_postgres_dbt: Close
2022-06-16 17:52:02.357416 (MainThread): Using postgres connection "master".
2022-06-16 17:52:02.358365 (MainThread): On master: BEGIN
2022-06-16 17:52:02.359163 (MainThread): Opening a new connection, currently in state init
2022-06-16 17:52:02.406613 (MainThread): SQL status: BEGIN in 0.05 seconds
2022-06-16 17:52:02.407760 (MainThread): Using postgres connection "master".
2022-06-16 17:52:02.408654 (MainThread): On master: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
2022-06-16 17:52:02.484260 (MainThread): SQL status: SELECT 7 in 0.07 seconds
2022-06-16 17:52:02.500418 (MainThread): On master: ROLLBACK
2022-06-16 17:52:02.502066 (MainThread): Using postgres connection "master".
2022-06-16 17:52:02.503107 (MainThread): On master: BEGIN
2022-06-16 17:52:02.505137 (MainThread): SQL status: BEGIN in 0.00 seconds
2022-06-16 17:52:02.506157 (MainThread): On master: COMMIT
2022-06-16 17:52:02.506764 (MainThread): Using postgres connection "master".
2022-06-16 17:52:02.507380 (MainThread): On master: COMMIT
2022-06-16 17:52:02.508331 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 17:52:02.509083 (MainThread): On master: Close
2022-06-16 17:52:02.510384 (MainThread): 17:52:02 | Concurrency: 1 threads (target='dev')
2022-06-16 17:52:02.511263 (MainThread): 17:52:02 | 
2022-06-16 17:52:02.530245 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 17:52:02.533408 (Thread-1): 17:52:02 | 1 of 2 START view model dbt.v_pit_customer........................... [RUN]
2022-06-16 17:52:02.535782 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:02.537153 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 17:52:02.612026 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 17:52:02.627872 (Thread-1): finished collecting timing info
2022-06-16 17:52:02.716771 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:02.717629 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_tmp" cascade
2022-06-16 17:52:02.718882 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 17:52:02.736486 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-06-16 17:52:02.754535 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:02.755737 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 17:52:02.758061 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 17:52:02.778402 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_pit_customer"
2022-06-16 17:52:02.806819 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:02.808141 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: BEGIN
2022-06-16 17:52:02.810631 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 17:52:02.811952 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:02.813118 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */

  create view "postgres"."dbt"."v_pit_customer__dbt_tmp" as (
    

with all_periods as (
	select customer_pk, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') - interval '1 microseconds' effective_to
	from (select customer_pk, effective_from--, customer_hashdiff, record_source
				from "postgres"."dbt"."sat_customer_details"
	  			union
	  	  select customer_pk, effective_from--, customer_hashdiff, record_source
	  	  		from "postgres"."dbt"."sat_customer_crm"   ) t
),
cust_details_periods as (
	select customer_pk, first_name, last_name, email,  effective_from, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') - interval '1 microseconds' effective_to
			from "postgres"."dbt"."sat_customer_details"  t
),
cust_crm_periods as (
	select customer_pk, country, age, effective_from, --customer_pk,  customer_hashdiff, effective_from,
	coalesce(lead(effective_from) over(PARTITION by customer_pk order by effective_from), '9999-01-31 00:00:00') - interval '1 microseconds' effective_to
			from "postgres"."dbt"."sat_customer_crm" t
),
pit_table as (
		select ap.*,
		cdp.first_name, cdp.last_name, cdp.email,
		--cdp.customer_hashdiff details_hashdiff, cdp.effective_from cd_effective_from, cdp.effective_to cd_effective_to,
		ccp.country, ccp.age
    	--ccp.customer_hashdiff crm_hashdiff, ccp.effective_from crm_effective_from, ccp.effective_to crm_effective_to
		from all_periods ap
		left join cust_details_periods cdp
			on cdp.customer_pk = ap.customer_pk
			and (cdp.effective_from between ap.effective_from and ap.effective_to
				or cdp.effective_to between ap.effective_from and ap.effective_to
				)
		left join cust_crm_periods ccp
			on ccp.customer_pk = ap.customer_pk
			and (ccp.effective_from between ap.effective_from and ap.effective_to
				or ccp.effective_to between ap.effective_from and ap.effective_to
				)
)

select * from pit_table
--where customer_pk = 'ec8956637a99787bd197eacd77acce5e'
  );

2022-06-16 17:52:02.856749 (Thread-1): SQL status: CREATE VIEW in 0.04 seconds
2022-06-16 17:52:02.878782 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:02.879597 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
alter table "postgres"."dbt"."v_pit_customer" rename to "v_pit_customer__dbt_backup"
2022-06-16 17:52:02.882757 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 17:52:02.891303 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:02.892840 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
alter table "postgres"."dbt"."v_pit_customer__dbt_tmp" rename to "v_pit_customer"
2022-06-16 17:52:02.896225 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 17:52:02.914962 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-16 17:52:02.916033 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:02.916938 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: COMMIT
2022-06-16 17:52:02.922930 (Thread-1): SQL status: COMMIT in 0.01 seconds
2022-06-16 17:52:02.934091 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_pit_customer".
2022-06-16 17:52:02.934931 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_pit_customer"} */
drop view if exists "postgres"."dbt"."v_pit_customer__dbt_backup" cascade
2022-06-16 17:52:02.943785 (Thread-1): SQL status: DROP VIEW in 0.01 seconds
2022-06-16 17:52:02.950739 (Thread-1): finished collecting timing info
2022-06-16 17:52:02.952547 (Thread-1): On model.jaffle_shop_dbtvault.v_pit_customer: Close
2022-06-16 17:52:02.959172 (Thread-1): 17:52:02 | 1 of 2 OK created view model dbt.v_pit_customer...................... [CREATE VIEW in 0.42s]
2022-06-16 17:52:02.960621 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_pit_customer
2022-06-16 17:52:02.962331 (Thread-1): Began running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 17:52:02.967085 (Thread-1): 17:52:02 | 2 of 2 START view model dbt.v_week_order_cnt......................... [RUN]
2022-06-16 17:52:02.969156 (Thread-1): Acquiring new postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 17:52:02.970675 (Thread-1): Compiling model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 17:52:02.995224 (Thread-1): Writing injected SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 17:52:03.022070 (Thread-1): finished collecting timing info
2022-06-16 17:52:03.053420 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 17:52:03.054733 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_tmp" cascade
2022-06-16 17:52:03.056063 (Thread-1): Opening a new connection, currently in state closed
2022-06-16 17:52:03.073877 (Thread-1): SQL status: DROP VIEW in 0.02 seconds
2022-06-16 17:52:03.082389 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 17:52:03.083669 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 17:52:03.085391 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 17:52:03.089404 (Thread-1): Writing runtime SQL for node "model.jaffle_shop_dbtvault.v_week_order_cnt"
2022-06-16 17:52:03.109030 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 17:52:03.110195 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: BEGIN
2022-06-16 17:52:03.112018 (Thread-1): SQL status: BEGIN in 0.00 seconds
2022-06-16 17:52:03.112924 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 17:52:03.113750 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */

  create view "postgres"."dbt"."v_week_order_cnt__dbt_tmp" as (
    

select date_trunc('week', order_date) order_week, status, count(1)
from "postgres"."dbt"."sat_order_details" sod
group by  date_trunc('week', order_date), status
order by 1 desc
  );

2022-06-16 17:52:03.124486 (Thread-1): SQL status: CREATE VIEW in 0.01 seconds
2022-06-16 17:52:03.135952 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 17:52:03.136904 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt" rename to "v_week_order_cnt__dbt_backup"
2022-06-16 17:52:03.139017 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 17:52:03.149434 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 17:52:03.150182 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
alter table "postgres"."dbt"."v_week_order_cnt__dbt_tmp" rename to "v_week_order_cnt"
2022-06-16 17:52:03.151719 (Thread-1): SQL status: ALTER TABLE in 0.00 seconds
2022-06-16 17:52:03.155026 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 17:52:03.156216 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 17:52:03.156784 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: COMMIT
2022-06-16 17:52:03.160257 (Thread-1): SQL status: COMMIT in 0.00 seconds
2022-06-16 17:52:03.166146 (Thread-1): Using postgres connection "model.jaffle_shop_dbtvault.v_week_order_cnt".
2022-06-16 17:52:03.166928 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: /* {"app": "dbt", "dbt_version": "0.19.0", "profile_name": "jaffle_shop", "target_name": "dev", "node_id": "model.jaffle_shop_dbtvault.v_week_order_cnt"} */
drop view if exists "postgres"."dbt"."v_week_order_cnt__dbt_backup" cascade
2022-06-16 17:52:03.170361 (Thread-1): SQL status: DROP VIEW in 0.00 seconds
2022-06-16 17:52:03.177335 (Thread-1): finished collecting timing info
2022-06-16 17:52:03.179174 (Thread-1): On model.jaffle_shop_dbtvault.v_week_order_cnt: Close
2022-06-16 17:52:03.186418 (Thread-1): 17:52:03 | 2 of 2 OK created view model dbt.v_week_order_cnt.................... [CREATE VIEW in 0.21s]
2022-06-16 17:52:03.187965 (Thread-1): Finished running node model.jaffle_shop_dbtvault.v_week_order_cnt
2022-06-16 17:52:03.194078 (MainThread): Acquiring new postgres connection "master".
2022-06-16 17:52:03.195349 (MainThread): Using postgres connection "master".
2022-06-16 17:52:03.196576 (MainThread): On master: BEGIN
2022-06-16 17:52:03.198128 (MainThread): Opening a new connection, currently in state closed
2022-06-16 17:52:03.212665 (MainThread): SQL status: BEGIN in 0.01 seconds
2022-06-16 17:52:03.213844 (MainThread): On master: COMMIT
2022-06-16 17:52:03.215147 (MainThread): Using postgres connection "master".
2022-06-16 17:52:03.216454 (MainThread): On master: COMMIT
2022-06-16 17:52:03.218325 (MainThread): SQL status: COMMIT in 0.00 seconds
2022-06-16 17:52:03.219763 (MainThread): On master: Close
2022-06-16 17:52:03.222418 (MainThread): 17:52:03 | 
2022-06-16 17:52:03.223715 (MainThread): 17:52:03 | Finished running 2 view models in 1.34s.
2022-06-16 17:52:03.225276 (MainThread): Connection 'master' was properly closed.
2022-06-16 17:52:03.226303 (MainThread): Connection 'model.jaffle_shop_dbtvault.v_week_order_cnt' was properly closed.
2022-06-16 17:52:03.559238 (MainThread): 
2022-06-16 17:52:03.559990 (MainThread): Completed successfully
2022-06-16 17:52:03.561082 (MainThread): 
Done. PASS=2 WARN=0 ERROR=0 SKIP=0 TOTAL=2
2022-06-16 17:52:03.562885 (MainThread): Flushing usage events
